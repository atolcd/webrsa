var Prototype={Version:"1.6.1",Browser:function(){var e=navigator.userAgent,t="[object Opera]"==Object.prototype.toString.call(window.opera);return{IE:!!window.attachEvent&&!t,Opera:t,WebKit:-1<e.indexOf("AppleWebKit/"),Gecko:-1<e.indexOf("Gecko")&&-1===e.indexOf("KHTML"),MobileSafari:/Apple.*Mobile.*Safari/.test(e)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var e=window.Element||window.HTMLElement;return!(!e||!e.prototype)}(),SpecificElementExtensions:function(){if(void 0!==window.HTMLDivElement)return!0;var e=document.createElement("div"),t=document.createElement("form"),n=!1;return e.__proto__&&e.__proto__!==t.__proto__&&(n=!0),e=t=null,n}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(e){return e}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);var Abstract={},Try={these:function(){for(var e,t=0,n=arguments.length;t<n;t++){var i=arguments[t];try{e=i();break}catch(e){}}return e}},Class=function(){function r(){}return{create:function(){var e=null,t=$A(arguments);function n(){this.initialize.apply(this,arguments)}Object.isFunction(t[0])&&(e=t.shift()),Object.extend(n,Class.Methods),n.superclass=e,n.subclasses=[],e&&(r.prototype=e.prototype,n.prototype=new r,e.subclasses.push(n));for(var i=0;i<t.length;i++)n.addMethods(t[i]);return n.prototype.initialize||(n.prototype.initialize=Prototype.emptyFunction),n.prototype.constructor=n},Methods:{addMethods:function(e){var t=this.superclass&&this.superclass.prototype,n=Object.keys(e);Object.keys({toString:!0}).length||(e.toString!=Object.prototype.toString&&n.push("toString"),e.valueOf!=Object.prototype.valueOf&&n.push("valueOf"));for(var i=0,r=n.length;i<r;i++){var a=n[i],o=e[a];if(t&&Object.isFunction(o)&&"$super"==o.argumentNames().first()){var s=o;(o=function(e){return function(){return t[e].apply(this,arguments)}}(a).wrap(s)).valueOf=s.valueOf.bind(s),o.toString=s.toString.bind(s)}this.prototype[a]=o}return this}}}}();!function(){var t=Object.prototype.toString;function n(e,t){for(var n in t)e[n]=t[n];return e}function a(e){return!(!e||1!=e.nodeType)}function o(e){return void 0===e}n(Object,{extend:n,inspect:function(e){try{return o(e)?"undefined":null===e?"null":e.inspect?e.inspect():String(e)}catch(e){if(e instanceof RangeError)return"...";throw e}},toJSON:function e(t){switch(typeof t){case"undefined":case"function":case"unknown":return;case"boolean":return t.toString()}if(null===t)return"null";if(t.toJSON)return t.toJSON();if(!a(t)){var n=[];for(var i in t){var r=e(t[i]);o(r)||n.push(i.toJSON()+": "+r)}return"{"+n.join(", ")+"}"}},toQueryString:function(e){return $H(e).toQueryString()},toHTML:function(e){return e&&e.toHTML?e.toHTML():String.interpret(e)},keys:function(e){var t=[];for(var n in e)t.push(n);return t},values:function(e){var t=[];for(var n in e)t.push(e[n]);return t},clone:function(e){return n({},e)},isElement:a,isArray:function(e){return"[object Array]"==t.call(e)},isHash:function(e){return e instanceof Hash},isFunction:function(e){return"function"==typeof e},isString:function(e){return"[object String]"==t.call(e)},isNumber:function(e){return"[object Number]"==t.call(e)},isUndefined:o})}(),Object.extend(Function.prototype,function(){var a=Array.prototype.slice;function o(e,t){for(var n=e.length,i=t.length;i--;)e[n+i]=t[i];return e}function r(e,t){return o(e=a.call(e,0),t)}return{argumentNames:function(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=e.length||e[0]?e:[]},bind:function(t){if(arguments.length<2&&Object.isUndefined(t))return this;var n=this,i=a.call(arguments,1);return function(){var e=r(i,arguments);return n.apply(t,e)}},bindAsEventListener:function(n){var i=this,r=a.call(arguments,1);return function(e){var t=o([e||window.event],r);return i.apply(n,t)}},curry:function(){if(!arguments.length)return this;var t=this,n=a.call(arguments,0);return function(){var e=r(n,arguments);return t.apply(this,e)}},delay:function(e){var t=this,n=a.call(arguments,1);return e*=1e3,window.setTimeout(function(){return t.apply(t,n)},e)},defer:function(){var e=o([.01],arguments);return this.delay.apply(this,e)},wrap:function(t){var n=this;return function(){var e=o([n.bind(this)],arguments);return t.apply(this,e)}},methodize:function(){if(this._methodized)return this._methodized;var t=this;return this._methodized=function(){var e=o([this],arguments);return t.apply(null,e)}}}}()),Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+'Z"'},RegExp.prototype.match=RegExp.prototype.test,RegExp.escape=function(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(e,t){this.callback=e,this.frequency=t,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),1e3*this.frequency)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(e){throw this.currentlyExecuting=!1,e}}});Object.extend(String,{interpret:function(e){return null==e?"":String(e)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}}),Object.extend(String.prototype,function(){function prepareReplacement(e){if(Object.isFunction(e))return e;var t=new Template(e);return function(e){return t.evaluate(e)}}function gsub(e,t){var n,i="",r=this;if(t=prepareReplacement(t),Object.isString(e)&&(e=RegExp.escape(e)),!e.length&&!e.source)return(t=t(""))+r.split("").join(t)+t;for(;0<r.length;)r=(n=r.match(e))?(i+=r.slice(0,n.index),i+=String.interpret(t(n)),r.slice(n.index+n[0].length)):(i+=r,"");return i}function sub(e,t,n){return t=prepareReplacement(t),n=Object.isUndefined(n)?1:n,this.gsub(e,function(e){return--n<0?e[0]:t(e)})}function scan(e,t){return this.gsub(e,t),String(this)}function truncate(e,t){return e=e||30,t=Object.isUndefined(t)?"...":t,this.length>e?this.slice(0,e-t.length)+t:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var e=new RegExp(Prototype.ScriptFragment,"img"),t=new RegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map(function(e){return(e.match(t)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(e){var t=this.strip().match(/([^?#]*)(#.*)?$/);return t?t[1].split(e||"&").inject({},function(e,t){if((t=t.split("="))[0]){var n=decodeURIComponent(t.shift()),i=1<t.length?t.join("="):t[0];null!=i&&(i=decodeURIComponent(i)),n in e?(Object.isArray(e[n])||(e[n]=[e[n]]),e[n].push(i)):e[n]=i}return e}):{}}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(e){return e<1?"":new Array(e+1).join(this)}function camelize(){var e=this.split("-"),t=e.length;if(1==t)return e[0];for(var n="-"==this.charAt(0)?e[0].charAt(0).toUpperCase()+e[0].substring(1):e[0],i=1;i<t;i++)n+=e[i].charAt(0).toUpperCase()+e[i].substring(1);return n}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(e){var t=this.replace(/[\x00-\x1f\\]/g,function(e){return e in String.specialChar?String.specialChar[e]:"\\u00"+e.charCodeAt().toPaddedString(2,16)});return e?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"}function toJSON(){return this.inspect(!0)}function unfilterJSON(e){return this.replace(e||Prototype.JSONFilter,"$1")}function isJSON(){var e=this;return!e.blank()&&(e=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""),/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(e))}function evalJSON(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON())return eval("("+json+")")}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function include(e){return-1<this.indexOf(e)}function startsWith(e){return 0===this.indexOf(e)}function endsWith(e){var t=this.length-e.length;return 0<=t&&this.lastIndexOf(e)===t}function empty(){return""==this}function blank(){return/^\s*$/.test(this)}function interpolate(e,t){return new Template(this,t).evaluate(e)}return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim?String.prototype.trim:strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,toJSON:toJSON,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate}}());var Template=Class.create({initialize:function(e,t){this.template=e.toString(),this.pattern=t||Template.Pattern},evaluate:function(a){return a&&Object.isFunction(a.toTemplateReplacements)&&(a=a.toTemplateReplacements()),this.template.gsub(this.pattern,function(e){if(null==a)return e[1]+"";var t=e[1]||"";if("\\"==t)return e[2];var n=a,i=e[3],r=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;if(null==(e=r.exec(i)))return t;for(;null!=e;){if(null==(n=n[e[1].startsWith("[")?e[2].replace(/\\\\]/g,"]"):e[1]])||""==e[3])break;i=i.substring("["==e[3]?e[1].length:e[0].length),e=r.exec(i)}return t+String.interpret(n)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={},Enumerable=function(){function e(n,i){n=n||Prototype.K;var r=!0;return this.each(function(e,t){if(!(r=r&&!!n.call(i,e,t)))throw $break}),r}function t(n,i){n=n||Prototype.K;var r=!1;return this.each(function(e,t){if(r=!!n.call(i,e,t))throw $break}),r}function n(n,i){n=n||Prototype.K;var r=[];return this.each(function(e,t){r.push(n.call(i,e,t))}),r}function i(n,i){var r;return this.each(function(e,t){if(n.call(i,e,t))throw r=e,$break}),r}function r(n,i){var r=[];return this.each(function(e,t){n.call(i,e,t)&&r.push(e)}),r}function a(t){if(Object.isFunction(this.indexOf)&&-1!=this.indexOf(t))return!0;var n=!1;return this.each(function(e){if(e==t)throw n=!0,$break}),n}function o(){return this.map()}return{each:function(t,n){var i=0;try{this._each(function(e){t.call(n,e,i++)})}catch(e){if(e!=$break)throw e}return this},eachSlice:function(e,t,n){var i=-e,r=[],a=this.toArray();if(e<1)return a;for(;(i+=e)<a.length;)r.push(a.slice(i,i+e));return r.collect(t,n)},all:e,every:e,any:t,some:t,collect:n,map:n,detect:i,findAll:r,select:r,filter:r,grep:function(n,i,r){i=i||Prototype.K;var a=[];return Object.isString(n)&&(n=new RegExp(RegExp.escape(n))),this.each(function(e,t){n.match(e)&&a.push(i.call(r,e,t))}),a},include:a,member:a,inGroupsOf:function(t,n){return n=Object.isUndefined(n)?null:n,this.eachSlice(t,function(e){for(;e.length<t;)e.push(n);return e})},inject:function(n,i,r){return this.each(function(e,t){n=i.call(r,n,e,t)}),n},invoke:function(t){var n=$A(arguments).slice(1);return this.map(function(e){return e[t].apply(e,n)})},max:function(n,i){var r;return n=n||Prototype.K,this.each(function(e,t){e=n.call(i,e,t),(null==r||r<=e)&&(r=e)}),r},min:function(n,i){var r;return n=n||Prototype.K,this.each(function(e,t){e=n.call(i,e,t),(null==r||e<r)&&(r=e)}),r},partition:function(n,i){n=n||Prototype.K;var r=[],a=[];return this.each(function(e,t){(n.call(i,e,t)?r:a).push(e)}),[r,a]},pluck:function(t){var n=[];return this.each(function(e){n.push(e[t])}),n},reject:function(n,i){var r=[];return this.each(function(e,t){n.call(i,e,t)||r.push(e)}),r},sortBy:function(n,i){return this.map(function(e,t){return{value:e,criteria:n.call(i,e,t)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;return n<i?-1:i<n?1:0}).pluck("value")},toArray:o,entries:o,zip:function(){var n=Prototype.K,e=$A(arguments);Object.isFunction(e.last())&&(n=e.pop());var i=[this].concat(e).map($A);return this.map(function(e,t){return n(i.pluck(t))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"},find:i}}();function $A(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();for(var t=e.length||0,n=new Array(t);t--;)n[t]=e[t];return n}function $w(e){return Object.isString(e)&&(e=e.strip())?e.split(/\s+/):[]}function $H(e){return new Hash(e)}Array.from=$A,function(){var e=Array.prototype,o=e.slice,t=e.forEach;function n(){return o.call(this,0)}t||(t=function(e){for(var t=0,n=this.length;t<n;t++)e(this[t])}),Object.extend(e,Enumerable),e._reverse||(e._reverse=e.reverse),Object.extend(e,{_each:t,clear:function(){return this.length=0,this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(e){return null!=e})},flatten:function(){return this.inject([],function(e,t){return Object.isArray(t)?e.concat(t.flatten()):(e.push(t),e)})},without:function(){var t=o.call(arguments,0);return this.select(function(e){return!t.include(e)})},reverse:function(e){return(!1!==e?this:this.toArray())._reverse()},uniq:function(i){return this.inject([],function(e,t,n){return 0!=n&&(i?e.last()==t:e.include(t))||e.push(t),e})},intersect:function(e){return this.uniq().findAll(function(t){return e.detect(function(e){return t===e})})},clone:n,toArray:n,size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var n=[];return this.each(function(e){var t=Object.toJSON(e);Object.isUndefined(t)||n.push(t)}),"["+n.join(", ")+"]"}}),function(){return 1!==[].concat(arguments)[0][0]}(1,2)&&(e.concat=function(){for(var e,t=o.call(this,0),n=0,i=arguments.length;n<i;n++)if(e=arguments[n],!Object.isArray(e)||"callee"in e)t.push(e);else for(var r=0,a=e.length;r<a;r++)t.push(e[r]);return t}),e.indexOf||(e.indexOf=function(e,t){t||(t=0);var n=this.length;for(t<0&&(t=n+t);t<n;t++)if(this[t]===e)return t;return-1}),e.lastIndexOf||(e.lastIndexOf=function(e,t){t=isNaN(t)?this.length:(t<0?this.length+t:t)+1;var n=this.slice(0,t).reverse().indexOf(e);return n<0?n:t-n-1})}();var Hash=Class.create(Enumerable,function(){function e(){return Object.clone(this._object)}function r(e,t){return Object.isUndefined(t)?e:e+"="+encodeURIComponent(String.interpret(t))}return{initialize:function(e){this._object=Object.isHash(e)?e.toObject():Object.clone(e)},_each:function(e){for(var t in this._object){var n=this._object[t],i=[t,n];i.key=t,i.value=n,e(i)}},set:function(e,t){return this._object[e]=t},get:function(e){if(this._object[e]!==Object.prototype[e])return this._object[e]},unset:function(e){var t=this._object[e];return delete this._object[e],t},toObject:e,toTemplateReplacements:e,keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(t){var e=this.detect(function(e){return e.value===t});return e&&e.key},merge:function(e){return this.clone().update(e)},update:function(e){return new Hash(e).inject(this,function(e,t){return e.set(t.key,t.value),e})},toQueryString:function(){return this.inject([],function(e,t){var n=encodeURIComponent(t.key),i=t.value;if(i&&"object"==typeof i){if(Object.isArray(i))return e.concat(i.map(r.curry(n)))}else e.push(r(n,i));return e}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(e){return e.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Object.toJSON(this.toObject())},clone:function(){return new Hash(this)}}}());function $R(e,t,n){return new ObjectRange(e,t,n)}Hash.from=$H,Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(e,t){return $R(0,this,!0).each(e,t),this},toPaddedString:function(e,t){var n=this.toString(t||10);return"0".times(e-n.length)+n},toJSON:function(){return isFinite(this)?this.toString():"null"},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)}});var ObjectRange=Class.create(Enumerable,{initialize:function(e,t,n){this.start=e,this.end=t,this.exclusive=n},_each:function(e){for(var t=this.start;this.include(t);)e(t),t=t.succ()},include:function(e){return!(e<this.start)&&(this.exclusive?e<this.end:e<=this.end)}}),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0};function $(e){if(1<arguments.length){for(var t=0,n=[],i=arguments.length;t<i;t++)n.push($(arguments[t]));return n}return Object.isString(e)&&(e=document.getElementById(e)),Element.extend(e)}if(Ajax.Responders={responders:[],_each:function(e){this.responders._each(e)},register:function(e){this.include(e)||this.responders.push(e)},unregister:function(e){this.responders=this.responders.without(e)},dispatch:function(t,n,i,r){this.each(function(e){if(Object.isFunction(e[t]))try{e[t].apply(e,[n,i,r])}catch(e){}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=Class.create({initialize:function(e){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0},Object.extend(this.options,e||{}),this.options.method=this.options.method.toLowerCase(),Object.isString(this.options.parameters)?this.options.parameters=this.options.parameters.toQueryParams():Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}}),Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function(e,t,n){e(n),this.transport=Ajax.getTransport(),this.request(t)},request:function(e){this.url=e,this.method=this.options.method;var t=Object.clone(this.options.parameters);["get","post"].include(this.method)||(t._method=this.method,this.method="post"),this.parameters=t,(t=Object.toQueryString(t))&&("get"==this.method?this.url+=(this.url.include("?")?"&":"?")+t:/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(t+="&_="));try{var n=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(n),Ajax.Responders.dispatch("onCreate",this,n),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders(),this.body="post"==this.method?this.options.postBody||t:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(e){this.dispatchException(e)}},onStateChange:function(){var e=this.transport.readyState;1<e&&(4!=e||!this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var t={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if("post"==this.method&&(t["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(t.Connection="close")),"object"==typeof this.options.requestHeaders){var e=this.options.requestHeaders;if(Object.isFunction(e.push))for(var n=0,i=e.length;n<i;n+=2)t[e[n]]=e[n+1];else $H(e).each(function(e){t[e.key]=e.value})}for(var r in t)this.transport.setRequestHeader(r,t[r])},success:function(){var e=this.getStatus();return!e||200<=e&&e<300},getStatus:function(){try{return this.transport.status||0}catch(e){return 0}},respondToReadyState:function(e){var t=Ajax.Request.Events[e],n=new Ajax.Response(this);if("Complete"==t){try{this._complete=!0,(this.options["on"+n.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(n,n.headerJSON)}catch(e){this.dispatchException(e)}var i=n.getHeader("Content-type");("force"==this.options.evalJS||this.options.evalJS&&this.isSameOrigin()&&i&&i.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+t]||Prototype.emptyFunction)(n,n.headerJSON),Ajax.Responders.dispatch("on"+t,this,n,n.headerJSON)}catch(e){this.dispatchException(e)}"Complete"==t&&(this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var e=this.url.match(/^\s*https?:\/\/[^\/]*/);return!e||e[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(e){try{return this.transport.getResponseHeader(e)||null}catch(e){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(e){(this.options.onException||Prototype.emptyFunction)(this,e),Ajax.Responders.dispatch("onException",this,e)}}),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Response=Class.create({initialize:function(e){this.request=e;var t=this.transport=e.transport,n=this.readyState=t.readyState;if((2<n&&!Prototype.Browser.IE||4==n)&&(this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(t.responseText),this.headerJSON=this._getHeaderJSON()),4==n){var i=t.responseXML;this.responseXML=Object.isUndefined(i)?null:i,this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(e){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(e){return null}},getResponseHeader:function(e){return this.transport.getResponseHeader(e)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var e=this.getHeader("X-JSON");if(!e)return null;e=decodeURIComponent(escape(e));try{return e.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(e){this.request.dispatchException(e)}},_getResponseJSON:function(){var e=this.request.options;if(!e.evalJSON||"force"!=e.evalJSON&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(e.sanitizeJSON||!this.request.isSameOrigin())}catch(e){this.request.dispatchException(e)}}}),Ajax.Updater=Class.create(Ajax.Request,{initialize:function(e,t,n,i){this.container={success:t.success||t,failure:t.failure||(t.success?null:t)};var r=(i=Object.clone(i)).onComplete;i.onComplete=function(e,t){this.updateContent(e.responseText),Object.isFunction(r)&&r(e,t)}.bind(this),e(n,i)},updateContent:function(e){var t=this.container[this.success()?"success":"failure"],n=this.options;if(n.evalScripts||(e=e.stripScripts()),t=$(t))if(n.insertion)if(Object.isString(n.insertion)){var i={};i[n.insertion]=e,t.insert(i)}else n.insertion(t,e);else t.update(e)}}),Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function(e,t,n,i){e(i),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=t,this.url=n,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(e){this.options.decay&&(this.decay=e.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=e.responseText),this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),Prototype.BrowserFeatures.XPath&&(document._getElementsByXPath=function(e,t){for(var n=[],i=document.evaluate(e,$(t)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),r=0,a=i.snapshotLength;r<a;r++)n.push(Element.extend(i.snapshotItem(r)));return n}),!window.Node)var Node={};Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),function(e){var i=function(){var e=document.createElement("form"),t=document.createElement("input"),n=document.documentElement;t.setAttribute("name","test"),e.appendChild(t),n.appendChild(e);var i=e.elements?void 0===e.elements.test:null;return n.removeChild(e),e=t=null,i}(),t=e.Element;e.Element=function(e,t){t=t||{},e=e.toLowerCase();var n=Element.cache;return i&&t.name?(e="<"+e+' name="'+t.name+'">',delete t.name,Element.writeAttribute(document.createElement(e),t)):(n[e]||(n[e]=Element.extend(document.createElement(e))),Element.writeAttribute(n[e].cloneNode(!1),t))},Object.extend(e.Element,t||{}),t&&(e.Element.prototype=t.prototype)}(this),Element.cache={},Element.idCounter=1,Element.Methods={visible:function(e){return"none"!=$(e).style.display},toggle:function(e){return e=$(e),Element[Element.visible(e)?"hide":"show"](e),e},hide:function(e){return(e=$(e)).style.display="none",e},show:function(e){return(e=$(e)).style.display="",e},remove:function(e){return(e=$(e)).parentNode.removeChild(e),e},update:function(){var e,t,i=(e=document.createElement("select"),t=!0,e.innerHTML='<option value="test">test</option>',e.options&&e.options[0]&&(t="OPTION"!==e.options[0].nodeName.toUpperCase()),e=null,t),r=function(){try{var e=document.createElement("table");if(e&&e.tBodies){e.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var t=void 0===e.tBodies[0];return e=null,t}}catch(e){return!0}}(),a=function(){var e=document.createElement("script"),t=!1;try{e.appendChild(document.createTextNode("")),t=!e.firstChild||e.firstChild&&3!==e.firstChild.nodeType}catch(e){t=!0}return e=null,t}();return function(t,e){if(t=$(t),e&&e.toElement&&(e=e.toElement()),Object.isElement(e))return t.update().insert(e);e=Object.toHTML(e);var n=t.tagName.toUpperCase();if("SCRIPT"===n&&a)return t.text=e,t;if(i||r)if(n in Element._insertionTranslations.tags){for(;t.firstChild;)t.removeChild(t.firstChild);Element._getContentFromAnonymousElement(n,e.stripScripts()).each(function(e){t.appendChild(e)})}else t.innerHTML=e.stripScripts();else t.innerHTML=e.stripScripts();return e.evalScripts.bind(e).defer(),t}}(),replace:function(e,t){if(e=$(e),t&&t.toElement)t=t.toElement();else if(!Object.isElement(t)){t=Object.toHTML(t);var n=e.ownerDocument.createRange();n.selectNode(e),t.evalScripts.bind(t).defer(),t=n.createContextualFragment(t.stripScripts())}return e.parentNode.replaceChild(t,e),e},insert:function(e,t){var n,i,r,a;for(var o in e=$(e),(Object.isString(t)||Object.isNumber(t)||Object.isElement(t)||t&&(t.toElement||t.toHTML))&&(t={bottom:t}),t)n=t[o],o=o.toLowerCase(),i=Element._insertionTranslations[o],n&&n.toElement&&(n=n.toElement()),Object.isElement(n)?i(e,n):(n=Object.toHTML(n),r=("before"==o||"after"==o?e.parentNode:e).tagName.toUpperCase(),a=Element._getContentFromAnonymousElement(r,n.stripScripts()),"top"!=o&&"after"!=o||a.reverse(),a.each(i.curry(e)),n.evalScripts.bind(n).defer());return e},wrap:function(e,t,n){return e=$(e),Object.isElement(t)?$(t).writeAttribute(n||{}):t=Object.isString(t)?new Element(t,n):new Element("div",t),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t},inspect:function(r){var a="<"+(r=$(r)).tagName.toLowerCase();return $H({id:"id",className:"class"}).each(function(e){var t=e.first(),n=e.last(),i=(r[t]||"").toString();i&&(a+=" "+n+"="+i.inspect(!0))}),a+">"},recursivelyCollect:function(e,t){e=$(e);for(var n=[];e=e[t];)1==e.nodeType&&n.push(Element.extend(e));return n},ancestors:function(e){return Element.recursivelyCollect(e,"parentNode")},descendants:function(e){return Element.select(e,"*")},firstDescendant:function(e){for(e=$(e).firstChild;e&&1!=e.nodeType;)e=e.nextSibling;return $(e)},immediateDescendants:function(e){if(!(e=$(e).firstChild))return[];for(;e&&1!=e.nodeType;)e=e.nextSibling;return e?[e].concat($(e).nextSiblings()):[]},previousSiblings:function(e){return Element.recursivelyCollect(e,"previousSibling")},nextSiblings:function(e){return Element.recursivelyCollect(e,"nextSibling")},siblings:function(e){return e=$(e),Element.previousSiblings(e).reverse().concat(Element.nextSiblings(e))},match:function(e,t){return Object.isString(t)&&(t=new Selector(t)),t.match($(e))},up:function(e,t,n){if(e=$(e),1==arguments.length)return $(e.parentNode);var i=Element.ancestors(e);return Object.isNumber(t)?i[t]:Selector.findElement(i,t,n)},down:function(e,t,n){return e=$(e),1==arguments.length?Element.firstDescendant(e):Object.isNumber(t)?Element.descendants(e)[t]:Element.select(e,t)[n||0]},previous:function(e,t,n){if(e=$(e),1==arguments.length)return $(Selector.handlers.previousElementSibling(e));var i=Element.previousSiblings(e);return Object.isNumber(t)?i[t]:Selector.findElement(i,t,n)},next:function(e,t,n){if(e=$(e),1==arguments.length)return $(Selector.handlers.nextElementSibling(e));var i=Element.nextSiblings(e);return Object.isNumber(t)?i[t]:Selector.findElement(i,t,n)},select:function(e){var t=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(e,t)},adjacent:function(e){var t=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(e.parentNode,t).without(e)},identify:function(e){e=$(e);var t=Element.readAttribute(e,"id");if(t)return t;for(;$(t="anonymous_element_"+Element.idCounter++););return Element.writeAttribute(e,"id",t),t},readAttribute:function(e,t){if(e=$(e),Prototype.Browser.IE){var n=Element._attributeTranslations.read;if(n.values[t])return n.values[t](e,t);if(n.names[t]&&(t=n.names[t]),t.include(":"))return e.attributes&&e.attributes[t]?e.attributes[t].value:null}return e.getAttribute(t)},writeAttribute:function(e,t,n){e=$(e);var i={},r=Element._attributeTranslations.write;for(var a in"object"==typeof t?i=t:i[t]=!!Object.isUndefined(n)||n,i)t=r.names[a]||a,n=i[a],r.values[a]&&(t=r.values[a](e,n)),!1===n||null===n?e.removeAttribute(t):!0===n?e.setAttribute(t,t):e.setAttribute(t,n);return e},getHeight:function(e){return Element.getDimensions(e).height},getWidth:function(e){return Element.getDimensions(e).width},classNames:function(e){return new Element.ClassNames(e)},hasClassName:function(e,t){if(e=$(e)){var n=e.className;return 0<n.length&&(n==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(n))}},addClassName:function(e,t){if(e=$(e))return Element.hasClassName(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClassName:function(e,t){if(e=$(e))return e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").strip(),e},toggleClassName:function(e,t){if(e=$(e))return Element[Element.hasClassName(e,t)?"removeClassName":"addClassName"](e,t)},cleanWhitespace:function(e){for(var t=(e=$(e)).firstChild;t;){var n=t.nextSibling;3!=t.nodeType||/\S/.test(t.nodeValue)||e.removeChild(t),t=n}return e},empty:function(e){return $(e).innerHTML.blank()},descendantOf:function(e,t){if(e=$(e),t=$(t),e.compareDocumentPosition)return 8==(8&e.compareDocumentPosition(t));if(t.contains)return t.contains(e)&&t!==e;for(;e=e.parentNode;)if(e==t)return!0;return!1},scrollTo:function(e){e=$(e);var t=Element.cumulativeOffset(e);return window.scrollTo(t[0],t[1]),e},getStyle:function(e,t){e=$(e),t="float"==t?"cssFloat":t.camelize();var n=e.style[t];if(!n||"auto"==n){var i=document.defaultView.getComputedStyle(e,null);n=i?i[t]:null}return"opacity"==t?n?parseFloat(n):1:"auto"==n?null:n},getOpacity:function(e){return $(e).getStyle("opacity")},setStyle:function(e,t){var n=(e=$(e)).style;if(Object.isString(t))return e.style.cssText+=";"+t,t.include("opacity")?e.setOpacity(t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var i in t)"opacity"==i?e.setOpacity(t[i]):n["float"==i||"cssFloat"==i?Object.isUndefined(n.styleFloat)?"cssFloat":"styleFloat":i]=t[i];return e},setOpacity:function(e,t){return(e=$(e)).style.opacity=1==t||""===t?"":t<1e-5?0:t,e},getDimensions:function(e){e=$(e);var t=Element.getStyle(e,"display");if("none"!=t&&null!=t)return{width:e.offsetWidth,height:e.offsetHeight};var n=e.style,i=n.visibility,r=n.position,a=n.display;n.visibility="hidden","fixed"!=r&&(n.position="absolute"),n.display="block";var o=e.clientWidth,s=e.clientHeight;return n.display=a,n.position=r,n.visibility=i,{width:o,height:s}},makePositioned:function(e){e=$(e);var t=Element.getStyle(e,"position");return"static"!=t&&t||(e._madePositioned=!0,e.style.position="relative",Prototype.Browser.Opera&&(e.style.top=0,e.style.left=0)),e},undoPositioned:function(e){return(e=$(e))._madePositioned&&(e._madePositioned=void 0,e.style.position=e.style.top=e.style.left=e.style.bottom=e.style.right=""),e},makeClipping:function(e){return(e=$(e))._overflow||(e._overflow=Element.getStyle(e,"overflow")||"auto","hidden"!==e._overflow&&(e.style.overflow="hidden")),e},undoClipping:function(e){return(e=$(e))._overflow&&(e.style.overflow="auto"==e._overflow?"":e._overflow,e._overflow=null),e},cumulativeOffset:function(e){for(var t=0,n=0;t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent;);return Element._returnOffset(n,t)},positionedOffset:function(e){var t=0,n=0;do{if(t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent){if("BODY"==e.tagName.toUpperCase())break;if("static"!==Element.getStyle(e,"position"))break}}while(e);return Element._returnOffset(n,t)},absolutize:function(e){if(e=$(e),"absolute"==Element.getStyle(e,"position"))return e;var t=Element.positionedOffset(e),n=t[1],i=t[0],r=e.clientWidth,a=e.clientHeight;return e._originalLeft=i-parseFloat(e.style.left||0),e._originalTop=n-parseFloat(e.style.top||0),e._originalWidth=e.style.width,e._originalHeight=e.style.height,e.style.position="absolute",e.style.top=n+"px",e.style.left=i+"px",e.style.width=r+"px",e.style.height=a+"px",e},relativize:function(e){if(e=$(e),"relative"==Element.getStyle(e,"position"))return e;e.style.position="relative";var t=parseFloat(e.style.top||0)-(e._originalTop||0),n=parseFloat(e.style.left||0)-(e._originalLeft||0);return e.style.top=t+"px",e.style.left=n+"px",e.style.height=e._originalHeight,e.style.width=e._originalWidth,e},cumulativeScrollOffset:function(e){for(var t=0,n=0;t+=e.scrollTop||0,n+=e.scrollLeft||0,e=e.parentNode;);return Element._returnOffset(n,t)},getOffsetParent:function(e){if(e.offsetParent)return $(e.offsetParent);if(e==document.body)return $(e);for(;(e=e.parentNode)&&e!=document.body;)if("static"!=Element.getStyle(e,"position"))return $(e);return $(document.body)},viewportOffset:function(e){var t=0,n=0,i=e;do{if(t+=i.offsetTop||0,n+=i.offsetLeft||0,i.offsetParent==document.body&&"absolute"==Element.getStyle(i,"position"))break}while(i=i.offsetParent);for(i=e;(!Prototype.Browser.Opera||i.tagName&&"BODY"==i.tagName.toUpperCase())&&(t-=i.scrollTop||0,n-=i.scrollLeft||0),i=i.parentNode;);return Element._returnOffset(n,t)},clonePosition:function(e,t){var n=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},arguments[2]||{});t=$(t);var i=Element.viewportOffset(t);e=$(e);var r=[0,0],a=null;return"absolute"==Element.getStyle(e,"position")&&(a=Element.getOffsetParent(e),r=Element.viewportOffset(a)),a==document.body&&(r[0]-=document.body.offsetLeft,r[1]-=document.body.offsetTop),n.setLeft&&(e.style.left=i[0]-r[0]+n.offsetLeft+"px"),n.setTop&&(e.style.top=i[1]-r[1]+n.offsetTop+"px"),n.setWidth&&(e.style.width=t.offsetWidth+"px"),n.setHeight&&(e.style.height=t.offsetHeight+"px"),e}},Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants}),Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}},Prototype.Browser.Opera?(Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(i,r,e){switch(e){case"left":case"top":case"right":case"bottom":if("static"===i(r,"position"))return null;case"height":case"width":if(!Element.visible(r))return null;var t=parseInt(i(r,e),10);return t!==r["offset"+e.capitalize()]?t+"px":("height"===e?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(t,function(e,t){var n=i(r,t);return null===n?e:e-parseInt(n,10)})+"px";default:return i(r,e)}}),Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(e,t,n){return"title"===n?t.title:e(t,n)})):Prototype.Browser.IE?(Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(e,t){t=$(t);try{t.offsetParent}catch(e){return $(document.body)}var n=t.getStyle("position");if("static"!==n)return e(t);t.setStyle({position:"relative"});var i=e(t);return t.setStyle({position:n}),i}),$w("positionedOffset viewportOffset").each(function(e){Element.Methods[e]=Element.Methods[e].wrap(function(e,t){t=$(t);try{t.offsetParent}catch(e){return Element._returnOffset(0,0)}var n=t.getStyle("position");if("static"!==n)return e(t);var i=t.getOffsetParent();i&&"fixed"===i.getStyle("position")&&i.setStyle({zoom:1}),t.setStyle({position:"relative"});var r=e(t);return t.setStyle({position:n}),r})}),Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(e,t){try{t.offsetParent}catch(e){return Element._returnOffset(0,0)}return e(t)}),Element.Methods.getStyle=function(e,t){e=$(e),t="float"==t||"cssFloat"==t?"styleFloat":t.camelize();var n=e.style[t];return!n&&e.currentStyle&&(n=e.currentStyle[t]),"opacity"==t?(n=(e.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))&&n[1]?parseFloat(n[1])/100:1:"auto"==n?"width"!=t&&"height"!=t||"none"==e.getStyle("display")?null:e["offset"+t.capitalize()]+"px":n},Element.Methods.setOpacity=function(e,t){function n(e){return e.replace(/alpha\([^\)]*\)/gi,"")}var i=(e=$(e)).currentStyle;(i&&!i.hasLayout||!i&&"normal"==e.style.zoom)&&(e.style.zoom=1);var r=e.getStyle("filter"),a=e.style;return 1==t||""===t?(r=n(r))?a.filter=r:a.removeAttribute("filter"):(t<1e-5&&(t=0),a.filter=n(r)+"alpha(opacity="+100*t+")"),e},Element._attributeTranslations=function(){var e="className",t="for",n=document.createElement("div");return n.setAttribute(e,"x"),"x"!==n.className&&(n.setAttribute("class","x"),"x"===n.className&&(e="class")),n=null,(n=document.createElement("label")).setAttribute(t,"x"),"x"!==n.htmlFor&&(n.setAttribute("htmlFor","x"),"x"===n.htmlFor&&(t="htmlFor")),n=null,{read:{names:{class:e,className:e,for:t,htmlFor:t},values:{_getAttr:function(e,t){return e.getAttribute(t)},_getAttr2:function(e,t){return e.getAttribute(t,2)},_getAttrNode:function(e,t){var n=e.getAttributeNode(t);return n?n.value:""},_getEv:function(){var e=document.createElement("div");e.onclick=Prototype.emptyFunction;var t,n=e.getAttribute("onclick");return-1<String(n).indexOf("{")?t=function(e,t){return(t=e.getAttribute(t))?(t=(t=(t=t.toString()).split("{")[1]).split("}")[0]).strip():null}:""===n&&(t=function(e,t){return(t=e.getAttribute(t))?t.strip():null}),e=null,t}(),_flag:function(e,t){return $(e).hasAttribute(t)?t:null},style:function(e){return e.style.cssText.toLowerCase()},title:function(e){return e.title}}}}}(),Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(e,t){e.checked=!!t},style:function(e,t){e.style.cssText=t||""}}},Element._attributeTranslations.has={},$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(e){Element._attributeTranslations.write.names[e.toLowerCase()]=e,Element._attributeTranslations.has[e.toLowerCase()]=e}),function(e){Object.extend(e,{href:e._getAttr2,src:e._getAttr2,type:e._getAttr,action:e._getAttrNode,disabled:e._flag,checked:e._flag,readonly:e._flag,multiple:e._flag,onload:e._getEv,onunload:e._getEv,onclick:e._getEv,ondblclick:e._getEv,onmousedown:e._getEv,onmouseup:e._getEv,onmouseover:e._getEv,onmousemove:e._getEv,onmouseout:e._getEv,onfocus:e._getEv,onblur:e._getEv,onkeypress:e._getEv,onkeydown:e._getEv,onkeyup:e._getEv,onsubmit:e._getEv,onreset:e._getEv,onselect:e._getEv,onchange:e._getEv})}(Element._attributeTranslations.read.values),Prototype.BrowserFeatures.ElementExtensions&&(Element.Methods.down=function(e,t,n){return e=$(e),1==arguments.length?e.firstDescendant():Object.isNumber(t)?function(e){for(var t,n=e.getElementsByTagName("*"),i=[],r=0;t=n[r];r++)"!"!==t.tagName&&i.push(t);return i}(e)[t]:Element.select(e,t)[n||0]})):Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)?Element.Methods.setOpacity=function(e,t){return(e=$(e)).style.opacity=1==t?.999999:""===t?"":t<1e-5?0:t,e}:Prototype.Browser.WebKit&&(Element.Methods.setOpacity=function(e,t){if((e=$(e)).style.opacity=1==t||""===t?"":t<1e-5?0:t,1==t)if("IMG"==e.tagName.toUpperCase()&&e.width)e.width++,e.width--;else try{var n=document.createTextNode(" ");e.appendChild(n),e.removeChild(n)}catch(e){}return e},Element.Methods.cumulativeOffset=function(e){var t=0,n=0;do{if(t+=e.offsetTop||0,n+=e.offsetLeft||0,e.offsetParent==document.body&&"absolute"==Element.getStyle(e,"position"))break;e=e.offsetParent}while(e);return Element._returnOffset(n,t)}),"outerHTML"in document.documentElement&&(Element.Methods.replace=function(e,t){if(e=$(e),t&&t.toElement&&(t=t.toElement()),Object.isElement(t))return e.parentNode.replaceChild(t,e),e;t=Object.toHTML(t);var n=e.parentNode,i=n.tagName.toUpperCase();if(Element._insertionTranslations.tags[i]){var r=e.next(),a=Element._getContentFromAnonymousElement(i,t.stripScripts());n.removeChild(e),r?a.each(function(e){n.insertBefore(e,r)}):a.each(function(e){n.appendChild(e)})}else e.outerHTML=t.stripScripts();return t.evalScripts.bind(t).defer(),e}),Element._returnOffset=function(e,t){var n=[e,t];return n.left=e,n.top=t,n},Element._getContentFromAnonymousElement=function(e,t){var n=new Element("div"),i=Element._insertionTranslations.tags[e];return i?(n.innerHTML=i[0]+t+i[1],i[2].times(function(){n=n.firstChild})):n.innerHTML=t,$A(n.childNodes)},Element._insertionTranslations={before:function(e,t){e.parentNode.insertBefore(t,e)},top:function(e,t){e.insertBefore(t,e.firstChild)},bottom:function(e,t){e.appendChild(t)},after:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}},function(){var e=Element._insertionTranslations.tags;Object.extend(e,{THEAD:e.TBODY,TFOOT:e.TBODY,TH:e.TD})}(),Element.Methods.Simulated={hasAttribute:function(e,t){t=Element._attributeTranslations.has[t]||t;var n=$(e).getAttributeNode(t);return!(!n||!n.specified)}},Element.Methods.ByTag={},Object.extend(Element,Element.Methods),function(e){!Prototype.BrowserFeatures.ElementExtensions&&e.__proto__&&(window.HTMLElement={},window.HTMLElement.prototype=e.__proto__,Prototype.BrowserFeatures.ElementExtensions=!0),e=null}(document.createElement("div")),Element.extend=function(){function i(e,t){for(var n in t){var i=t[n];!Object.isFunction(i)||n in e||(e[n]=i.methodize())}}var e=function(e){if(void 0!==window.Element){var t=window.Element.prototype;if(t){var n="_"+(Math.random()+"").slice(2),i=document.createElement(e),r=(t[n]="x")!==i[n];return delete t[n],i=null,r}}return!1}("object");if(Prototype.BrowserFeatures.SpecificElementExtensions)return e?function(e){if(e&&void 0===e._extendedByPrototype){var t=e.tagName;t&&/^(?:object|applet|embed)$/i.test(t)&&(i(e,Element.Methods),i(e,Element.Methods.Simulated),i(e,Element.Methods.ByTag[t.toUpperCase()]))}return e}:Prototype.K;var r={},a=Element.Methods.ByTag,t=Object.extend(function(e){if(!e||void 0!==e._extendedByPrototype||1!=e.nodeType||e==window)return e;var t=Object.clone(r),n=e.tagName.toUpperCase();return a[n]&&Object.extend(t,a[n]),i(e,t),e._extendedByPrototype=Prototype.emptyFunction,e},{refresh:function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(r,Element.Methods),Object.extend(r,Element.Methods.Simulated))}});return t.refresh(),t}(),Element.hasAttribute=function(e,t){return e.hasAttribute?e.hasAttribute(t):Element.Methods.Simulated.hasAttribute(e,t)},Element.addMethods=function(t){var e=Prototype.BrowserFeatures,n=Element.Methods.ByTag;if(t||(Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})),2==arguments.length){var i=t;t=arguments[1]}function r(e){e=e.toUpperCase(),Element.Methods.ByTag[e]||(Element.Methods.ByTag[e]={}),Object.extend(Element.Methods.ByTag[e],t)}function a(e,t,n){for(var i in n=n||!1,e){var r=e[i];Object.isFunction(r)&&(n&&i in t||(t[i]=r.methodize()))}}function o(e){var t,n={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(n[e]&&(t="HTML"+n[e]+"Element"),window[t])return window[t];if(t="HTML"+e+"Element",window[t])return window[t];if(t="HTML"+e.capitalize()+"Element",window[t])return window[t];var i=document.createElement(e),r=i.__proto__||i.constructor.prototype;return i=null,r}i?Object.isArray(i)?i.each(r):r(i):Object.extend(Element.Methods,t||{});var s=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(e.ElementExtensions&&(a(Element.Methods,s),a(Element.Methods.Simulated,s,!0)),e.SpecificElementExtensions)for(var l in Element.Methods.ByTag){var u=o(l);Object.isUndefined(u)||a(n[l],u.prototype)}Object.extend(Element,Element.Methods),delete Element.ByTag,Element.extend.refresh&&Element.extend.refresh(),Element.cache={}},document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}},function(t){var n,i=Prototype.Browser,r=document,a={};function e(e){return n||(n=i.WebKit&&!r.evaluate?document:i.Opera&&window.parseFloat(window.opera.version())<9.5?document.body:document.documentElement),a[e]="client"+e,t["get"+e]=function(){return n[a[e]]},t["get"+e]()}t.getWidth=e.curry("Width"),t.getHeight=e.curry("Height")}(document.viewport),Element.Storage={UID:1},Element.addMethods({getStorage:function(e){var t;if(e=$(e))return t=e===window?0:(void 0===e._prototypeUID&&(e._prototypeUID=[Element.Storage.UID++]),e._prototypeUID[0]),Element.Storage[t]||(Element.Storage[t]=$H()),Element.Storage[t]},store:function(e,t,n){if(e=$(e))return 2===arguments.length?Element.getStorage(e).update(t):Element.getStorage(e).set(t,n),e},retrieve:function(e,t,n){if(e=$(e)){var i=Element.getStorage(e),r=i.get(t);return Object.isUndefined(r)&&(i.set(t,n),r=n),r}},clone:function(e,t){if(e=$(e)){var n=e.cloneNode(t);if(n._prototypeUID=void 0,t)for(var i=Element.select(n,"*"),r=i.length;r--;)i[r]._prototypeUID=void 0;return Element.extend(n)}}});var Selector=Class.create({initialize:function(e){this.expression=e.strip(),this.shouldUseSelectorsAPI()?this.mode="selectorsAPI":this.shouldUseXPath()?(this.mode="xpath",this.compileXPathMatcher()):(this.mode="normal",this.compileMatcher())},shouldUseXPath:function(){var t=function(){var e=!1;if(document.evaluate&&window.XPathResult){var t=document.createElement("div");t.innerHTML="<ul><li></li></ul><div><ul><li></li></ul></div>";e=2!==document.evaluate(".//*[local-name()='ul' or local-name()='UL']//*[local-name()='li' or local-name()='LI']",t,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength,t=null}return e}();return function(){if(!Prototype.BrowserFeatures.XPath)return!1;var e=this.expression;return(!Prototype.Browser.WebKit||!e.include("-of-type")&&!e.include(":empty"))&&(!/(\[[\w-]*?:|:checked)/.test(e)&&!t)}}(),shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI)return!1;if(Selector.CASE_INSENSITIVE_CLASS_NAMES)return!1;Selector._div||(Selector._div=new Element("div"));try{Selector._div.querySelector(this.expression)}catch(e){return!1}return!0},compileMatcher:function(){var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m,len=ps.length,name;if(Selector._cache[e])this.matcher=Selector._cache[e];else{for(this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];e&&le!=e&&/\S/.test(e);){le=e;for(var i=0;i<len;i++)if(p=ps[i].re,name=ps[i].name,m=e.match(p)){this.matcher.push(Object.isFunction(c[name])?c[name](m):new Template(c[name]).evaluate(m)),e=e.replace(m[0],"");break}}this.matcher.push("return h.unique(n);\n}"),eval(this.matcher.join("\n")),Selector._cache[this.expression]=this.matcher}},compileXPathMatcher:function(){var e,t,n,i=this.expression,r=Selector.patterns,a=Selector.xpath,o=r.length;if(Selector._cache[i])this.xpath=Selector._cache[i];else{for(this.matcher=[".//*"];i&&e!=i&&/\S/.test(i);){e=i;for(var s=0;s<o;s++)if(n=r[s].name,t=i.match(r[s].re)){this.matcher.push(Object.isFunction(a[n])?a[n](t):new Template(a[n]).evaluate(t)),i=i.replace(t[0],"");break}}this.xpath=this.matcher.join(""),Selector._cache[this.expression]=this.xpath}},findElements:function(e){e=e||document;var t,n=this.expression;switch(this.mode){case"selectorsAPI":if(e!==document){var i=e.id,r=$(e).identify();n="#"+(r=r.replace(/([\.:])/g,"\\$1"))+" "+n}return t=$A(e.querySelectorAll(n)).map(Element.extend),e.id=i,t;case"xpath":return document._getElementsByXPath(this.xpath,e);default:return this.matcher(e)}},match:function(e){this.tokens=[];for(var t,n,i,r=this.expression,a=Selector.patterns,o=Selector.assertions,s=a.length;r&&t!==r&&/\S/.test(r);){t=r;for(var l=0;l<s;l++)if(n=a[l].re,u=a[l].name,i=r.match(n)){if(!o[u])return this.findElements(document).include(e);this.tokens.push([u,Object.clone(i)]),r=r.replace(i[0],"")}}var u,c,d,p=!0;for(l=0;d=this.tokens[l];l++)if(u=d[0],c=d[1],!Selector.assertions[u](e,c)){p=!1;break}return p},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}});function $$(){return Selector.findChildElements(document,$A(arguments))}Prototype.BrowserFeatures.SelectorsAPI&&"BackCompat"===document.compatMode&&(Selector.CASE_INSENSITIVE_CLASS_NAMES=function(){var e=document.createElement("div"),t=document.createElement("span");e.id="prototype_test_id",t.className="Test",e.appendChild(t);var n=null!==e.querySelector("#prototype_test_id .test");return e=t=null,n}()),Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(e){return"*"==e[1]?"":"[local-name()='"+e[1].toLowerCase()+"' or local-name()='"+e[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(e){return e[1]=e[1].toLowerCase(),new Template("[@#{1}]").evaluate(e)},attr:function(e){return e[1]=e[1].toLowerCase(),e[3]=e[5]||e[6],new Template(Selector.xpath.operators[e[2]]).evaluate(e)},pseudo:function(e){var t=Selector.xpath.pseudos[e[1]];return t?Object.isFunction(t)?t(e):new Template(Selector.xpath.pseudos[e[1]]).evaluate(e):""},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0)]",checked:"[@checked]",disabled:"[(@disabled) and (@type!='hidden')]",enabled:"[not(@disabled) and (@type!='hidden')]",not:function(e){for(var t,n,i,r=e[6],a=Selector.patterns,o=Selector.xpath,s=a.length,l=[];r&&t!=r&&/\S/.test(r);){t=r;for(var u=0;u<s;u++)if(i=a[u].name,e=r.match(a[u].re)){n=Object.isFunction(o[i])?o[i](e):new Template(o[i]).evaluate(e),l.push("("+n.substring(1,n.length-1)+")"),r=r.replace(e[0],"");break}}return"[not("+l.join(" and ")+")]"},"nth-child":function(e){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",e)},"nth-last-child":function(e){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",e)},"nth-of-type":function(e){return Selector.xpath.pseudos.nth("position() ",e)},"nth-last-of-type":function(e){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",e)},"first-of-type":function(e){return e[6]="1",Selector.xpath.pseudos["nth-of-type"](e)},"last-of-type":function(e){return e[6]="1",Selector.xpath.pseudos["nth-last-of-type"](e)},"only-of-type":function(e){var t=Selector.xpath.pseudos;return t["first-of-type"](e)+t["last-of-type"](e)},nth:function(e,t){var n,i=t[6];if("even"==i&&(i="2n+0"),"odd"==i&&(i="2n+1"),n=i.match(/^(\d+)$/))return"["+e+"= "+n[1]+"]";if(n=i.match(/^(-?\d*)?n(([+-])(\d+))?/)){"-"==n[1]&&(n[1]=-1);var r=n[1]?Number(n[1]):1,a=n[2]?Number(n[2]):0;return new Template("[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]").evaluate({fragment:e,a:r,b:a})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(e){return e[3]=e[5]||e[6],new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(e)},pseudo:function(e){return e[6]&&(e[6]=e[6].replace(/"/g,'\\"')),new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(e)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:[{name:"laterSibling",re:/^\s*~\s*/},{name:"child",re:/^\s*>\s*/},{name:"adjacent",re:/^\s*\+\s*/},{name:"descendant",re:/^\s/},{name:"tagName",re:/^\s*(\*|[\w\-]+)(\b|$)?/},{name:"id",re:/^#([\w\-\*]+)(\b|$)/},{name:"className",re:/^\.([\w\-\*]+)(\b|$)/},{name:"pseudo",re:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/},{name:"attrPresence",re:/^\[((?:[\w-]+:)?[\w-]+)\]/},{name:"attr",re:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/}],assertions:{tagName:function(e,t){return t[1].toUpperCase()==e.tagName.toUpperCase()},className:function(e,t){return Element.hasClassName(e,t[1])},id:function(e,t){return e.id===t[1]},attrPresence:function(e,t){return Element.hasAttribute(e,t[1])},attr:function(e,t){var n=Element.readAttribute(e,t[1]);return n&&Selector.operators[t[2]](n,t[5]||t[6])}},handlers:{concat:function(e,t){for(var n,i=0;n=t[i];i++)e.push(n);return e},mark:function(e){for(var t,n=Prototype.emptyFunction,i=0;t=e[i];i++)t._countedByPrototype=n;return e},unmark:function(){var e,t,n;return(t=document.createElement("div"),e=(t[n="_countedByPrototype"]="x")===t.getAttribute(n),t=null,e)?function(e){for(var t,n=0;t=e[n];n++)t.removeAttribute("_countedByPrototype");return e}:function(e){for(var t,n=0;t=e[n];n++)t._countedByPrototype=void 0;return e}}(),index:function(e,t,n){if(e._countedByPrototype=Prototype.emptyFunction,t)for(var i=(o=e.childNodes).length-1,r=1;0<=i;i--){var a=o[i];1!=a.nodeType||n&&!a._countedByPrototype||(a.nodeIndex=r++)}else{i=0,r=1;for(var o=e.childNodes;a=o[i];i++)1!=a.nodeType||n&&!a._countedByPrototype||(a.nodeIndex=r++)}},unique:function(e){if(0==e.length)return e;for(var t,n=[],i=0,r=e.length;i<r;i++)void 0===(t=e[i])._countedByPrototype&&(t._countedByPrototype=Prototype.emptyFunction,n.push(Element.extend(t)));return Selector.handlers.unmark(n)},descendant:function(e){for(var t,n=Selector.handlers,i=0,r=[];t=e[i];i++)n.concat(r,t.getElementsByTagName("*"));return r},child:function(e){Selector.handlers;for(var t,n=0,i=[];t=e[n];n++)for(var r,a=0;r=t.childNodes[a];a++)1==r.nodeType&&"!"!=r.tagName&&i.push(r);return i},adjacent:function(e){for(var t,n=0,i=[];t=e[n];n++){var r=this.nextElementSibling(t);r&&i.push(r)}return i},laterSibling:function(e){for(var t,n=Selector.handlers,i=0,r=[];t=e[i];i++)n.concat(r,Element.nextSiblings(t));return r},nextElementSibling:function(e){for(;e=e.nextSibling;)if(1==e.nodeType)return e;return null},previousElementSibling:function(e){for(;e=e.previousSibling;)if(1==e.nodeType)return e;return null},tagName:function(e,t,n,i){var r=n.toUpperCase(),a=[],o=Selector.handlers;if(e){if(i){if("descendant"==i){for(var s=0;l=e[s];s++)o.concat(a,l.getElementsByTagName(n));return a}if(e=this[i](e),"*"==n)return e}var l;for(s=0;l=e[s];s++)l.tagName.toUpperCase()===r&&a.push(l);return a}return t.getElementsByTagName(n)},id:function(e,t,n,i){var r=$(n),a=Selector.handlers;if(t==document){if(!r)return[];if(!e)return[r]}else if(!t.sourceIndex||t.sourceIndex<1){e=t.getElementsByTagName("*");for(var o=0;l=e[o];o++)if(l.id===n)return[l]}if(e){if(i)if("child"==i){for(var s=0;l=e[s];s++)if(r.parentNode==l)return[r]}else if("descendant"==i){for(s=0;l=e[s];s++)if(Element.descendantOf(r,l))return[r]}else if("adjacent"==i){for(s=0;l=e[s];s++)if(Selector.handlers.previousElementSibling(r)==l)return[r]}else e=a[i](e);var l;for(s=0;l=e[s];s++)if(l==r)return[r];return[]}return r&&Element.descendantOf(r,t)?[r]:[]},className:function(e,t,n,i){return e&&i&&(e=this[i](e)),Selector.handlers.byClassName(e,t,n)},byClassName:function(e,t,n){e||(e=Selector.handlers.descendant([t]));for(var i,r,a=" "+n+" ",o=0,s=[];i=e[o];o++)0!=(r=i.className).length&&(r==n||(" "+r+" ").include(a))&&s.push(i);return s},attrPresence:function(e,t,n,i){e||(e=t.getElementsByTagName("*")),e&&i&&(e=this[i](e));for(var r,a=[],o=0;r=e[o];o++)Element.hasAttribute(r,n)&&a.push(r);return a},attr:function(e,t,n,i,r,a){e||(e=t.getElementsByTagName("*")),e&&a&&(e=this[a](e));for(var o,s=Selector.operators[r],l=[],u=0;o=e[u];u++){var c=Element.readAttribute(o,n);null!==c&&(s(c,i)&&l.push(o))}return l},pseudo:function(e,t,n,i,r){return e&&r&&(e=this[r](e)),e||(e=i.getElementsByTagName("*")),Selector.pseudos[t](e,n,i)}},pseudos:{"first-child":function(e,t,n){for(var i,r=0,a=[];i=e[r];r++)Selector.handlers.previousElementSibling(i)||a.push(i);return a},"last-child":function(e,t,n){for(var i,r=0,a=[];i=e[r];r++)Selector.handlers.nextElementSibling(i)||a.push(i);return a},"only-child":function(e,t,n){for(var i,r=Selector.handlers,a=0,o=[];i=e[a];a++)r.previousElementSibling(i)||r.nextElementSibling(i)||o.push(i);return o},"nth-child":function(e,t,n){return Selector.pseudos.nth(e,t,n)},"nth-last-child":function(e,t,n){return Selector.pseudos.nth(e,t,n,!0)},"nth-of-type":function(e,t,n){return Selector.pseudos.nth(e,t,n,!1,!0)},"nth-last-of-type":function(e,t,n){return Selector.pseudos.nth(e,t,n,!0,!0)},"first-of-type":function(e,t,n){return Selector.pseudos.nth(e,"1",n,!1,!0)},"last-of-type":function(e,t,n){return Selector.pseudos.nth(e,"1",n,!0,!0)},"only-of-type":function(e,t,n){var i=Selector.pseudos;return i["last-of-type"](i["first-of-type"](e,t,n),t,n)},getIndices:function(n,i,e){return 0==n?0<i?[i]:[]:$R(1,e).inject([],function(e,t){return 0==(t-i)%n&&0<=(t-i)/n&&e.push(t),e})},nth:function(e,t,n,i,r){if(0==e.length)return[];"even"==t&&(t="2n+0"),"odd"==t&&(t="2n+1");var a,o=Selector.handlers,s=[],l=[];o.mark(e);for(var u=0;c=e[u];u++)c.parentNode._countedByPrototype||(o.index(c.parentNode,i,r),l.push(c.parentNode));if(t.match(/^\d+$/)){t=Number(t);for(u=0;c=e[u];u++)c.nodeIndex==t&&s.push(c)}else if(a=t.match(/^(-?\d*)?n(([+-])(\d+))?/)){"-"==a[1]&&(a[1]=-1);for(var c,d=a[1]?Number(a[1]):1,p=a[2]?Number(a[2]):0,f=Selector.pseudos.getIndices(d,p,e.length),h=(u=0,f.length);c=e[u];u++)for(var m=0;m<h;m++)c.nodeIndex==f[m]&&s.push(c)}return o.unmark(e),o.unmark(l),s},empty:function(e,t,n){for(var i,r=0,a=[];i=e[r];r++)"!"==i.tagName||i.firstChild||a.push(i);return a},not:function(e,t,n){var i=Selector.handlers,r=new Selector(t).findElements(n);i.mark(r);for(var a,o=0,s=[];a=e[o];o++)a._countedByPrototype||s.push(a);return i.unmark(r),s},enabled:function(e,t,n){for(var i,r=0,a=[];i=e[r];r++)i.disabled||i.type&&"hidden"===i.type||a.push(i);return a},disabled:function(e,t,n){for(var i,r=0,a=[];i=e[r];r++)i.disabled&&a.push(i);return a},checked:function(e,t,n){for(var i,r=0,a=[];i=e[r];r++)i.checked&&a.push(i);return a}},operators:{"=":function(e,t){return e==t},"!=":function(e,t){return e!=t},"^=":function(e,t){return e==t||e&&e.startsWith(t)},"$=":function(e,t){return e==t||e&&e.endsWith(t)},"*=":function(e,t){return e==t||e&&e.include(t)},"~=":function(e,t){return(" "+e+" ").include(" "+t+" ")},"|=":function(e,t){return("-"+(e||"").toUpperCase()+"-").include("-"+(t||"").toUpperCase()+"-")}},split:function(e){var t=[];return e.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(e){t.push(e[1].strip())}),t},matchElements:function(e,t){var n=$$(t),i=Selector.handlers;i.mark(n);for(var r,a=0,o=[];r=e[a];a++)r._countedByPrototype&&o.push(r);return i.unmark(n),o},findElement:function(e,t,n){return Object.isNumber(t)&&(n=t,t=!1),Selector.matchElements(e,t||"*")[n||0]},findChildElements:function(e,t){t=Selector.split(t.join(","));for(var n,i=[],r=Selector.handlers,a=0,o=t.length;a<o;a++)n=new Selector(t[a].strip()),r.concat(i,n.findElements(e));return 1<o?r.unique(i):i}}),Prototype.Browser.IE&&Object.extend(Selector.handlers,{concat:function(e,t){for(var n,i=0;n=t[i];i++)"!"!==n.tagName&&e.push(n);return e}});var Form={reset:function(e){return(e=$(e)).reset(),e},serializeElements:function(e,t){"object"!=typeof t?t={hash:!!t}:Object.isUndefined(t.hash)&&(t.hash=!0);var n,i,r=!1,a=t.submit,o=e.inject({},function(e,t){return!t.disabled&&t.name&&(n=t.name,null==(i=$(t).getValue())||"file"==t.type||"submit"==t.type&&(r||!1===a||a&&n!=a||!(r=!0))||(n in e?(Object.isArray(e[n])||(e[n]=[e[n]]),e[n].push(i)):e[n]=i)),e});return t.hash?o:Object.toQueryString(o)}};Form.Methods={serialize:function(e,t){return Form.serializeElements(Form.getElements(e),t)},getElements:function(e){for(var t,n=$(e).getElementsByTagName("*"),i=[],r=Form.Element.Serializers,a=0;t=n[a];a++)i.push(t);return i.inject([],function(e,t){return r[t.tagName.toLowerCase()]&&e.push(Element.extend(t)),e})},getInputs:function(e,t,n){var i=(e=$(e)).getElementsByTagName("input");if(!t&&!n)return $A(i).map(Element.extend);for(var r=0,a=[],o=i.length;r<o;r++){var s=i[r];t&&s.type!=t||n&&s.name!=n||a.push(Element.extend(s))}return a},disable:function(e){return e=$(e),Form.getElements(e).invoke("disable"),e},enable:function(e){return e=$(e),Form.getElements(e).invoke("enable"),e},findFirstElement:function(e){var t=$(e).getElements().findAll(function(e){return"hidden"!=e.type&&!e.disabled}),n=t.findAll(function(e){return e.hasAttribute("tabIndex")&&0<=e.tabIndex}).sortBy(function(e){return e.tabIndex}).first();return n||t.find(function(e){return/^(?:input|select|textarea)$/i.test(e.tagName)})},focusFirstElement:function(e){return(e=$(e)).findFirstElement().activate(),e},request:function(e,t){e=$(e);var n=(t=Object.clone(t||{})).parameters,i=e.readAttribute("action")||"";return i.blank()&&(i=window.location.href),t.parameters=e.serialize(!0),n&&(Object.isString(n)&&(n=n.toQueryParams()),Object.extend(t.parameters,n)),e.hasAttribute("method")&&!t.method&&(t.method=e.method),new Ajax.Request(i,t)}},Form.Element={focus:function(e){return $(e).focus(),e},select:function(e){return $(e).select(),e}},Form.Element.Methods={serialize:function(e){if(!(e=$(e)).disabled&&e.name){var t=e.getValue();if(null!=t){var n={};return n[e.name]=t,Object.toQueryString(n)}}return""},getValue:function(e){var t=(e=$(e)).tagName.toLowerCase();return Form.Element.Serializers[t](e)},setValue:function(e,t){var n=(e=$(e)).tagName.toLowerCase();return Form.Element.Serializers[n](e,t),e},clear:function(e){return $(e).value="",e},present:function(e){return""!=$(e).value},activate:function(e){e=$(e);try{e.focus(),!e.select||"input"==e.tagName.toLowerCase()&&/^(?:button|reset|submit)$/i.test(e.type)||e.select()}catch(e){}return e},disable:function(e){return(e=$(e)).disabled=!0,e},enable:function(e){return(e=$(e)).disabled=!1,e}};var Field=Form.Element,$F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(e,t){switch(e.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(e,t);default:return Form.Element.Serializers.textarea(e,t)}},inputSelector:function(e,t){if(Object.isUndefined(t))return e.checked?e.value:null;e.checked=!!t},textarea:function(e,t){if(Object.isUndefined(t))return e.value;e.value=t},select:function(e,t){if(Object.isUndefined(t))return this["select-one"==e.type?"selectOne":"selectMany"](e);for(var n,i,r=!Object.isArray(t),a=0,o=e.length;a<o;a++)if(n=e.options[a],i=this.optionValue(n),r){if(i==t)return void(n.selected=!0)}else n.selected=t.include(i)},selectOne:function(e){var t=e.selectedIndex;return 0<=t?this.optionValue(e.options[t]):null},selectMany:function(e){var t=e.length;if(!t)return null;for(var n=0,i=[];n<t;n++){var r=e.options[n];r.selected&&i.push(this.optionValue(r))}return i},optionValue:function(e){return Element.extend(e).hasAttribute("value")?e.value:e.text}},Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function(e,t,n,i){e(i,n),this.element=$(t),this.lastValue=this.getValue()},execute:function(){var e=this.getValue();(Object.isString(this.lastValue)&&Object.isString(e)?this.lastValue!=e:String(this.lastValue)!=String(e))&&(this.callback(this.element,e),this.lastValue=e)}}),Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=Class.create({initialize:function(e,t){this.element=$(e),this.callback=t,this.lastValue=this.getValue(),"form"==this.element.tagName.toLowerCase()?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var e=this.getValue();this.lastValue!=e&&(this.callback(this.element,e),this.lastValue=e)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(e){if(e.type)switch(e.type.toLowerCase()){case"checkbox":case"radio":Event.observe(e,"click",this.onElementEvent.bind(this));break;default:Event.observe(e,"change",this.onElementEvent.bind(this))}}}),Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}}),function(){var t,o={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},e=document.documentElement,s="onmouseenter"in e&&"onmouseleave"in e;if(Prototype.Browser.IE){var n={0:1,1:4,2:2};t=function(e,t){return e.button===n[t]}}else t=Prototype.Browser.WebKit?function(e,t){switch(t){case 0:return 1==e.which&&!e.metaKey;case 1:return 1==e.which&&e.metaKey;default:return!1}}:function(e,t){return e.which?e.which===t+1:e.button===t};function i(e){var t=document.documentElement,n=document.body||{scrollLeft:0};return e.pageX||e.clientX+(t.scrollLeft||n.scrollLeft)-(t.clientLeft||0)}function r(e){var t=document.documentElement,n=document.body||{scrollTop:0};return e.pageY||e.clientY+(t.scrollTop||n.scrollTop)-(t.clientTop||0)}o.Methods={isLeftClick:function(e){return t(e,0)},isMiddleClick:function(e){return t(e,1)},isRightClick:function(e){return t(e,2)},element:function(e){var t=(e=o.extend(e)).target,n=e.type,i=e.currentTarget;return i&&i.tagName&&("load"===n||"error"===n||"click"===n&&"input"===i.tagName.toLowerCase()&&"radio"===i.type)&&(t=i),t.nodeType==Node.TEXT_NODE&&(t=t.parentNode),Element.extend(t)},findElement:function(e,t){var n=o.element(e);if(!t)return n;var i=[n].concat(n.ancestors());return Selector.findElement(i,t,0)},pointer:function(e){return{x:i(e),y:r(e)}},pointerX:i,pointerY:r,stop:function(e){o.extend(e),e.preventDefault(),e.stopPropagation(),e.stopped=!0}};var a=Object.keys(o.Methods).inject({},function(e,t){return e[t]=o.Methods[t].methodize(),e});if(Prototype.Browser.IE){Object.extend(a,{stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}}),o.extend=function(e,t){if(!e)return!1;if(e._extendedByPrototype)return e;e._extendedByPrototype=Prototype.emptyFunction;var n=o.pointer(e);return Object.extend(e,{target:e.srcElement||t,relatedTarget:function(e){var t;switch(e.type){case"mouseover":t=e.fromElement;break;case"mouseout":t=e.toElement;break;default:return null}return Element.extend(t)}(e),pageX:n.x,pageY:n.y}),Object.extend(e,a)}}else o.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(o.prototype,a),o.extend=Prototype.K;var l=[];Prototype.Browser.IE&&window.attachEvent("onunload",function(){for(var e=0,t=l.length;e<t;e++)o.stopObserving(l[e]),l[e]=null}),Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,!1);var u=Prototype.K;function c(e,t,n){var i=function(n,t,i){var e=Element.retrieve(n,"prototype_event_registry");Object.isUndefined(e)&&(l.push(n),e=Element.retrieve(n,"prototype_event_registry",$H()));var r,a=e.get(t);return Object.isUndefined(a)&&(a=[],e.set(t,a)),!a.pluck("handler").include(i)&&(t.include(":")?r=function(e){return!Object.isUndefined(e.eventName)&&e.eventName===t&&(o.extend(e,n),void i.call(n,e))}:s||"mouseenter"!==t&&"mouseleave"!==t?r=function(e){o.extend(e,n),i.call(n,e)}:"mouseenter"!==t&&"mouseleave"!==t||(r=function(e){o.extend(e,n);for(var t=e.relatedTarget;t&&t!==n;)try{t=t.parentNode}catch(e){t=n}t!==n&&i.call(n,e)}),r.handler=i,a.push(r),r)}(e=$(e),t,n);if(!i)return e;if(t.include(":"))e.addEventListener?e.addEventListener("dataavailable",i,!1):(e.attachEvent("ondataavailable",i),e.attachEvent("onfilterchange",i));else{var r=u(t);e.addEventListener?e.addEventListener(r,i,!1):e.attachEvent("on"+r,i)}return e}function d(n,t,i){n=$(n);var e=Element.retrieve(n,"prototype_event_registry");if(Object.isUndefined(e))return n;if(t&&!i){var r=e.get(t);return Object.isUndefined(r)||r.each(function(e){Element.stopObserving(n,t,e.handler)}),n}if(!t)return e.each(function(e){var t=e.key;e.value.each(function(e){Element.stopObserving(n,t,e.handler)})}),n;if(r=e.get(t)){var a=r.find(function(e){return e.handler===i});if(!a)return n;var o=u(t);return t.include(":")?n.removeEventListener?n.removeEventListener("dataavailable",a,!1):(n.detachEvent("ondataavailable",a),n.detachEvent("onfilterchange",a)):n.removeEventListener?n.removeEventListener(o,a,!1):n.detachEvent("on"+o,a),e.set(t,r.without(a)),n}}function p(e,t,n,i){var r;return e=$(e),Object.isUndefined(i)&&(i=!0),e==document&&document.createEvent&&!e.dispatchEvent&&(e=document.documentElement),document.createEvent?(r=document.createEvent("HTMLEvents")).initEvent("dataavailable",!0,!0):(r=document.createEventObject()).eventType=i?"ondataavailable":"onfilterchange",r.eventName=t,r.memo=n||{},document.createEvent?e.dispatchEvent(r):e.fireEvent(r.eventType,r),o.extend(r)}s||(u=function(e){var t={mouseenter:"mouseover",mouseleave:"mouseout"};return e in t?t[e]:e}),Object.extend(o,o.Methods),Object.extend(o,{fire:p,observe:c,stopObserving:d}),Element.addMethods({fire:p,observe:c,stopObserving:d}),Object.extend(document,{fire:p.methodize(),observe:c.methodize(),stopObserving:d.methodize(),loaded:!1}),window.Event?Object.extend(window.Event,o):window.Event=o}(),function(){var n;function i(){document.loaded||(n&&window.clearTimeout(n),document.loaded=!0,document.fire("dom:loaded"))}document.addEventListener?document.addEventListener("DOMContentLoaded",i,!1):(document.observe("readystatechange",function e(){"complete"===document.readyState&&(document.stopObserving("readystatechange",e),i())}),window==top&&(n=function t(){try{document.documentElement.doScroll("left")}catch(e){return void(n=t.defer())}i()}.defer())),Event.observe(window,"load",i)}(),Element.addMethods(),Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(e,t){return Element.insert(e,{before:t})},Top:function(e,t){return Element.insert(e,{top:t})},Bottom:function(e,t){return Element.insert(e,{bottom:t})},After:function(e,t){return Element.insert(e,{after:t})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(e,t,n){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(e,t,n):(this.xcomp=t,this.ycomp=n,this.offset=Element.cumulativeOffset(e),n>=this.offset[1]&&n<this.offset[1]+e.offsetHeight&&t>=this.offset[0]&&t<this.offset[0]+e.offsetWidth)},withinIncludingScrolloffsets:function(e,t,n){var i=Element.cumulativeScrollOffset(e);return this.xcomp=t+i[0]-this.deltaX,this.ycomp=n+i[1]-this.deltaY,this.offset=Element.cumulativeOffset(e),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+e.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+e.offsetWidth},overlap:function(e,t){return e?"vertical"==e?(this.offset[1]+t.offsetHeight-this.ycomp)/t.offsetHeight:"horizontal"==e?(this.offset[0]+t.offsetWidth-this.xcomp)/t.offsetWidth:void 0:0},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(e){return Position.prepare(),Element.absolutize(e)},relativize:function(e){return Position.prepare(),Element.relativize(e)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(e,t,n){return n=n||{},Element.clonePosition(t,e,n)}};document.getElementsByClassName||(document.getElementsByClassName=function(e){function i(e){return e.blank()?null:"[contains(concat(' ', @class, ' '), ' "+e+" ')]"}return Element.Methods.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(e,t){t=t.toString().strip();var n=/\s/.test(t)?$w(t).map(i).join(""):i(t);return n?document._getElementsByXPath(".//*"+n,e):[]}:function(e,t){t=t.toString().strip();var n=[],i=/\s/.test(t)?$w(t):null;if(!i&&!t)return n;var r=$(e).getElementsByTagName("*");t=" "+t+" ";for(var a,o,s=0;a=r[s];s++)a.className&&(o=" "+a.className+" ")&&(o.include(t)||i&&i.all(function(e){return!e.toString().blank()&&o.include(" "+e+" ")}))&&n.push(Element.extend(a));return n},function(e,t){return $(t||document.body).getElementsByClassName(e)}}()),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(e){this.element=$(e)},_each:function(e){this.element.className.split(/\s+/).select(function(e){return 0<e.length})._each(e)},set:function(e){this.element.className=e},add:function(e){this.include(e)||this.set($A(this).concat(e).join(" "))},remove:function(e){this.include(e)&&this.set($A(this).without(e).join(" "))},toString:function(){return $A(this).join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable);var WebrsaFormTags=["BUTTON","INPUT","OPTGROUP","OPTION","SELECT","TEXTAREA"],WebrsaFormMethods={enabled:function(e){return(e=$(e)).readAttribute("disabled"),void 0===e.readAttribute("disabled")||null===e.readAttribute("disabled")}};Element.addMethods(WebrsaFormTags,WebrsaFormMethods),Form.Element.Methods.disable=Form.Element.Methods.disable.wrap(function(e,t){if(-1===["option","optgroup"].indexOf(t.tagName.toLowerCase())){var n=$(t).up(["div.input","div.checkbox"]);n&&n.addClassName("disabled")}return e(t)}),Form.Element.Methods.enable=Form.Element.Methods.enable.wrap(function(e,t){if(-1===["option","optgroup"].indexOf(t.tagName.toLowerCase())){var n=$(t).up(["div.input","div.checkbox"]);n&&n.removeClassName("disabled")}return e(t)}),Object.extend(Form.Element,Form.Element.Methods),Element.addMethods(WebrsaFormTags,Form.Element.Methods),"undefined"==typeof Control&&(Control={});var $proc=function(e){return"function"==typeof e?e:function(){return e}},$value=function(e){return"function"==typeof e?e():e};Object.Event={extend:function(r){r._objectEventSetup=function(e){this._observers=this._observers||{},this._observers[e]=this._observers[e]||[]},r.observe=function(e,t){if("string"==typeof e&&void 0!==t)this._objectEventSetup(e),this._observers[e].include(t)||this._observers[e].push(t);else for(var n in e)this.observe(n,e[n])},r.stopObserving=function(e,t){this._objectEventSetup(e),e&&t?this._observers[e]=this._observers[e].without(t):e?this._observers[e]=[]:this._observers={}},r.observeOnce=function(e,t){var n=function(){t.apply(this,arguments),this.stopObserving(e,n)}.bind(this);this._objectEventSetup(e),this._observers[e].push(n)},r.notify=function(e){this._objectEventSetup(e);var t=[],n=$A(arguments).slice(1);try{for(var i=0;i<this._observers[e].length;++i)t.push(this._observers[e][i].apply(this._observers[e][i],n)||null)}catch(e){if(e==$break)return!1;throw e}return t},r.prototype&&(r.prototype._objectEventSetup=r._objectEventSetup,r.prototype.observe=r.observe,r.prototype.stopObserving=r.stopObserving,r.prototype.observeOnce=r.observeOnce,r.prototype.notify=function(e){r.notify&&((t=$A(arguments).slice(1)).unshift(this),t.unshift(e),r.notify.apply(r,t));this._objectEventSetup(e);var t=$A(arguments).slice(1),n=[];try{this.options&&this.options[e]&&"function"==typeof this.options[e]&&n.push(this.options[e].apply(this,t)||null);for(var i=0;i<this._observers[e].length;++i)n.push(this._observers[e][i].apply(this._observers[e][i],t)||null)}catch(e){if(e==$break)return!1;throw e}return n})}},Element.addMethods({observeOnce:function(e,t,n){var i=function(){n.apply(this,arguments),Element.stopObserving(e,t,i)};Element.observe(e,t,i)}}),function(){function e(e){var t,n;if(e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),t)return n=Event.extend(e).target,(n=Element.extend(n.nodeType===Node.TEXT_NODE?n.parentNode:n)).fire("mouse:wheel",{delta:t}).stopped?(Event.stop(e),!1):void 0}document.observe("mousewheel",e),document.observe("DOMMouseScroll",e)}();var IframeShim=Class.create({initialize:function(){this.element=new Element("iframe",{style:"position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none",src:"javascript:void(0);",frameborder:0}),$(document.body).insert(this.element)},hide:function(){return this.element.hide(),this},show:function(){return this.element.show(),this},positionUnder:function(e){var t=(e=$(e)).cumulativeOffset(),n=e.getDimensions();return this.element.setStyle({left:t[0]+"px",top:t[1]+"px",width:n.width+"px",height:n.height+"px",zIndex:e.getStyle("zIndex")-1}).show(),this},setBounds:function(e){for(prop in e)e[prop]+="px";return this.element.setStyle(e),this},destroy:function(){return this.element&&this.element.remove(),this}});if(void 0===Prototype)throw"Control.Tabs requires Prototype to be loaded.";if(void 0===Object.Event)throw"Control.Tabs requires Object.Event to be loaded.";Control.Tabs=Class.create({initialize:function(e,t){if(!$(e))throw"Control.Tabs could not find the element: "+e;this.activeContainer=!1,this.activeLink=!1,this.containers=$H({}),this.links=[],Control.Tabs.instances.push(this),this.options={beforeChange:Prototype.emptyFunction,afterChange:Prototype.emptyFunction,hover:!1,linkSelector:"li a",setClassOnContainer:!1,activeClassName:"active",defaultTab:"first",autoLinkExternal:!0,targetRegExp:/#(.+)$/,showFunction:Element.show,hideFunction:Element.hide},Object.extend(this.options,t||{}),(this.options.linkSelector,$(e).select(this.options.linkSelector)).findAll(function(e){return/^#/.exec((Prototype.Browser.WebKit?decodeURIComponent(e.href):e.href).replace(window.location.href.split("#")[0],""))}).each(function(e){this.addTab(e)}.bind(this)),this.containers.values().each(Element.hide),"first"==this.options.defaultTab?this.setActiveTab(this.links.first()):"last"==this.options.defaultTab?this.setActiveTab(this.links.last()):this.setActiveTab(this.options.defaultTab);var n=this.options.targetRegExp.exec(window.location);n&&n[1]&&n[1].split(",").each(function(t){this.setActiveTab(this.links.find(function(e){return e.key==t}))}.bind(this)),this.options.autoLinkExternal&&$A(document.getElementsByTagName("a")).each(function(e){if(!this.links.include(e)){var t=e.href.replace(window.location.href.split("#")[0],"");"#"==t.substring(0,1)&&this.containers.keys().include(t.substring(1))&&$(e).observe("click",function(e,t){this.setActiveTab(t.substring(1))}.bindAsEventListener(this,t))}}.bind(this))},addTab:function(e){this.links.push(e),e.key=e.getAttribute("href").replace(window.location.href.split("#")[0],"").split("#").last().replace(/#/,"");var t=$(e.key);if(!t)throw"Control.Tabs: #"+e.key+" was not found on the page.";this.containers.set(e.key,t),e[this.options.hover?"onmouseover":"onclick"]=function(e){return window.event&&Event.stop(window.event),this.setActiveTab(e),!1}.bind(this,e)},setActiveTab:function(t){if(t||void 0!==t)if("string"==typeof t)this.setActiveTab(this.links.find(function(e){return e.key==t}));else if("number"==typeof t)this.setActiveTab(this.links[t]);else{if(!1===this.notify("beforeChange",this.activeContainer,this.containers.get(t.key)))return;this.activeContainer&&this.options.hideFunction(this.activeContainer),this.links.each(function(e){(this.options.setClassOnContainer?$(e.parentNode):e).removeClassName(this.options.activeClassName)}.bind(this)),(this.options.setClassOnContainer?$(t.parentNode):t).addClassName(this.options.activeClassName),this.activeContainer=this.containers.get(t.key),this.activeLink=t,this.options.showFunction(this.containers.get(t.key)),this.notify("afterChange",this.containers.get(t.key))}},next:function(){this.links.each(function(e,t){if(this.activeLink==e&&this.links[t+1])throw this.setActiveTab(this.links[t+1]),$break}.bind(this))},previous:function(){this.links.each(function(e,t){if(this.activeLink==e&&this.links[t-1])throw this.setActiveTab(this.links[t-1]),$break}.bind(this))},first:function(){this.setActiveTab(this.links.first())},last:function(){this.setActiveTab(this.links.last())}}),Object.extend(Control.Tabs,{instances:[],findByTabId:function(t){return Control.Tabs.instances.find(function(e){return e.links.find(function(e){return e.key==t})})}}),Object.Event.extend(Control.Tabs);var Tooltip=Class.create();Tooltip.prototype={initialize:function(e,t){var n=Object.extend({default_css:!1,margin:"0px",padding:"5px",backgroundColor:"#d6d6fc",min_distance_x:5,min_distance_y:5,delta_x:0,delta_y:0,zindex:1e3},arguments[2]||{});this.element=$(e),this.options=n,$(t)?this.tool_tip=$(t):(this.tool_tip=$(document.createElement("div")),document.body.appendChild(this.tool_tip),this.tool_tip.addClassName("tooltip"),this.tool_tip.appendChild(document.createTextNode(t))),this.tool_tip.hide(),this.eventMouseOver=this.showTooltip.bindAsEventListener(this),this.eventMouseOut=this.hideTooltip.bindAsEventListener(this),this.eventMouseMove=this.moveTooltip.bindAsEventListener(this),this.registerEvents()},destroy:function(){Event.stopObserving(this.element,"mouseover",this.eventMouseOver),Event.stopObserving(this.element,"mouseout",this.eventMouseOut),Event.stopObserving(this.element,"mousemove",this.eventMouseMove)},registerEvents:function(){Event.observe(this.element,"mouseover",this.eventMouseOver),Event.observe(this.element,"mouseout",this.eventMouseOut),Event.observe(this.element,"mousemove",this.eventMouseMove)},moveTooltip:function(e){Event.stop(e);var t=Event.pointerX(e),n=Event.pointerY(e),i=Element.getDimensions(this.tool_tip),r=i.width,a=i.height;r+t>=this.getWindowWidth()-this.options.min_distance_x?(t-=r,t-=this.options.min_distance_x):t+=this.options.min_distance_x,a+n>=this.getWindowHeight()-this.options.min_distance_y?(n-=a,n-=this.options.min_distance_y):n+=this.options.min_distance_y,this.setStyles(t,n)},showTooltip:function(e){Event.stop(e),this.moveTooltip(e),new Element.show(this.tool_tip)},setStyles:function(e,t){Element.setStyle(this.tool_tip,{position:"absolute",top:t+this.options.delta_y+"px",left:e+this.options.delta_x+"px",zindex:this.options.zindex}),this.options.default_css&&Element.setStyle(this.tool_tip,{margin:this.options.margin,padding:this.options.padding,backgroundColor:this.options.backgroundColor,zindex:this.options.zindex})},hideTooltip:function(e){new Element.hide(this.tool_tip)},getWindowHeight:function(){return 0<navigator.appVersion.indexOf("MSIE")?document.body.clientHeight:window.innerHeight},getWindowWidth:function(){return 0<navigator.appVersion.indexOf("MSIE")?document.body.clientWidth:window.innerWidth}};var Webrsa=function(){"use strict";var e={fromCakeSelects:function(e){var t=null;try{(t=new Date(1970,0,1,0,0,0,0)).setDate(parseInt($F(e+"Day"),10)),t.setMonth(parseInt($F(e+"Month"),10)-1),t.setYear(parseInt($F(e+"Year"),10))}catch(e){console.log(e)}return t},fromText:function(e){var t,n=null;try{null!==(t=e.match(i.datetime()))&&((n=new Date(1970,0,1,0,0,0,0)).setDate(parseInt(t[1],10)),n.setMonth(parseInt(t[2],10)-1),n.setYear(parseInt(t[3],10)),void 0!==t[4]&&(n.setHours(parseInt(t[6],10)),n.setMinutes(parseInt(t[7],10)),void 0!==t[8]&&n.setSeconds(parseInt(t[9],10))))}catch(e){console.log(e)}return n}},i={datetime:function(){return/^([0-9]{1,2})\/([0-9]{1,2})\/([0-9]{2,4})( ( ){0,1}([0-9]{1,2}):([0-9]{1,2})(:([0-9]{1,2})){0,1}){0,1}$/}};return{Date:e,Regexps:i}}();function make_folded_forms(){$$("form.folded").each(function(e){$(e).hide()})}function make_treemenus(a,i,o){var s=a+"img/icons";$$(".treemenu li").each(function(e){if(e.down("ul")){if(i)var t=new Element("img",{src:s+"/bullet_toggle_plus2.png",alt:"tendre",width:"12px"});else t=new Element("img",{src:s+"/bullet_toggle_plus2.png",alt:"tendre"});var n=t.wrap("a",{href:"#",class:"toggler",onclick:"return false;"});$(n).observe("click",function(e){var t=$(this).up("li").down("ul");return t.toggle(),t.visible()?($(this).down("img").src=s+"/bullet_toggle_minus2.png",$(this).down("img").alt="Rduire"):($(this).down("img").src=s+"/bullet_toggle_plus2.png",$(this).down("img").alt="tendre"),!1}),$(e).down(1).insert({before:n}),$(e).down("ul").hide()}});var l=location.href.replace(a,"/").replace(new RegExp("^(https{0,1}://[^/]+/)"),"/").replace(/#$/,""),u=$$(".treemenu > ul")[0];$$(".treemenu a").each(function(e){var t=e.href.replace(a,"/").replace(new RegExp("^(https{0,1}://[^/]+/)"),"/");if(t==l||t==l.replace("/edit/","/view/")||t==l.replace("/add/","/view/")||t==l.replace("/add/","/index/")||null!==o&&t===o){$(e).addClassName("selected");var n=!1;e.ancestors().each(function(e){if(e==u)n=!0;else if(!n&&($(e).addClassName("selected"),e.show(),"LI"==e.tagName)){var t=e.down("a.toggler img");null!=t&&(t.src=s+"/bullet_toggle_minus2.png",t.alt="Rduire")}});try{var i=e.up("li");if(null!=i){var r=i.down("ul");null!=r&&r.show()}}catch(e){}}})}function expandableTreeMenuContent(e,t,n){$(e).up("ul").getElementsBySelector("li > a.toggler").each(function(e){"plus"==t?e.up("li").down("ul").show():e.up("li").down("ul").hide(),null!=e.down("img")&&(e.down("img").alt="plus"==t?(e.down("img").src=n+"/bullet_toggle_minus2.png","Rduire"):(e.down("img").src=n+"/bullet_toggle_plus2.png","tendre"))})}function treeMenuExpandsAll(e){var t=$("treemenuToggleLink"),n=e+"img/icons",i=$(t).down("img").src.replace(new RegExp("^.*(minus|plus).*"),"$1");$$(".treemenu > ul > li > a.toggler").each(function(e){"plus"==i?e.up("li").down("ul").show():e.up("li").down("ul").hide(),null!=e.down("img")&&(e.down("img").alt="plus"==i?(e.down("img").src=n+"/bullet_toggle_minus2.png","Rduire"):(e.down("img").src=n+"/bullet_toggle_plus2.png","tendre")),expandableTreeMenuContent(e,i,n)}),$(t).down("img").src="plus"==i?n+"/bullet_toggle_minus2.png":n+"/bullet_toggle_plus2.png"}function mkTooltipTables(){var u=new Array;$$("table.tooltips").each(function(n){var i=new Array,r=new Array,a=0,o=$(n).getElementsBySelector("thead tr"),s=0;$(o).each(function(e){s++,$(e).getElementsBySelector("th").each(function(e){if(s===o.length){var t=null!=$(e).readAttribute("colspan")?$(e).readAttribute("colspan"):1;if($(e).hasClassName("action"))for(var n=0;n<t;n++)i.push(a+n);else if($(e).hasClassName("input"))for(n=0;n<t;n++)r.push(a+n);a=parseInt(a)+parseInt(t)}$(e).hasClassName("innerTableHeader")&&$(e).addClassName("dynamic")})});var l=0;$(n).getElementsBySelector("tbody tr").each(function(e){if(null==$(e).up(".innerTableCell")){$(e).addClassName("dynamic");var t=0;$(e).childElements().each(function(e){i.include(t)||!1!==$(e).hasClassName("action")||r.include(t)||!1!==$(e).hasClassName("input")||u.push(new Tooltip($(e),"innerTable"+$(n).readAttribute("id")+l)),t++}),l++}})})}function disableFieldsOnCheckbox(e,t,i,r){r=void 0!==r&&r;var n=$(e),a=null!=$F(n);t.each(function(e){var t,n=$(e);null!=n&&(a!=i?(n.enable(),r&&n.show(),(t=n.up("div.input"))||n.up("div.checkbox"),t&&(t.removeClassName("disabled"),r&&t.show())):(n.disable(),r&&n.hide(),(t=n.up("div.input"))||n.up("div.checkbox"),t&&(t.addClassName("disabled"),r&&t.hide())))})}function observeDisableFieldsOnCheckbox(t,n,i,r){disableFieldsOnCheckbox(t,n,i,r=void 0!==r&&r),$($(t)).observe("click",function(e){disableFieldsOnCheckbox(t,n,i,r)})}function disableFieldsOnValue(e,t,n,i,r){r=void 0!==r&&r,"object"!=typeof n&&(n=[n]);var a=$(e),o=!1;n.each(function(e){$F(a)==e&&(o=!0)}),t.each(function(e){var t=$(e);null!=t&&(o==i?(t.disable(),(input=t.up("div.input"))?input.addClassName("disabled"):(input=t.up("div.checkbox"))&&input.addClassName("disabled"),r&&input.hide()):(t.enable(),(input=t.up("div.input"))?input.removeClassName("disabled"):(input=t.up("div.checkbox"))&&input.removeClassName("disabled"),r&&input.show()))})}function observeDisableFieldsOnValue(t,n,i,r,a){disableFieldsOnValue(t,n,i,r,a=void 0!==a&&a),$(t).observe("change",function(e){disableFieldsOnValue(t,n,i,r,a)})}function disableFieldsetOnValue(e,t,n,i,r){r=void 0!==r&&r,"object"!=typeof n&&(n=[n]);var a=$(e),o=!1;n.each(function(e){$F(a)==e&&(o=!0)});var s=$(t);o?(s.removeClassName("disabled"),r&&s.show(),$(s).getElementsBySelector("div.input","div.checkbox").each(function(e){e.removeClassName("disabled")}),$(s).getElementsBySelector("input","select","button","textarea").each(function(t){try{t.enable()}catch(e){t.disabled=!1}})):(s.addClassName("disabled"),r&&s.hide(),$(s).getElementsBySelector("div.input","div.checkbox").each(function(e){e.addClassName("disabled")}),$(s).getElementsBySelector("input","select","button","textarea").each(function(t){try{t.disable()}catch(e){t.disabled=!0}}))}function observeDisableFieldsetOnValue(t,n,i,r,a){disableFieldsetOnValue(t,n,i,r,a=void 0!==a&&a),$($(t)).observe("change",function(e){disableFieldsetOnValue(t,n,i,r,a)})}function disableFieldsetOnCheckbox(e,t,n,i){i=void 0!==i&&i;var r=$(e),a=null!=$F(r),o=$(t);a!=n?(o.removeClassName("disabled"),i&&o.show(),$(o).getElementsBySelector("div.input","div.checkbox").each(function(e){e.removeClassName("disabled")}),$(o).getElementsBySelector("input","select","button","textarea").each(function(t){try{t.enable()}catch(e){t.disabled=!1}})):(o.addClassName("disabled"),i&&o.hide(),$(o).getElementsBySelector("div.input","div.checkbox").each(function(e){e.addClassName("disabled")}),$(o).getElementsBySelector("input","select","button","textarea").each(function(t){try{t.disable()}catch(e){t.disabled=!0}}))}function observeDisableFieldsetOnCheckbox(t,n,i,r){disableFieldsetOnCheckbox(t,n,i,r=void 0!==r&&r),$($(t)).observe("click",function(e){disableFieldsetOnCheckbox(t,n,i,r)})}function disableFieldsOnBoolean(e,t,n,i){var r=!($F(e)==n==i);t.each(function(e){var t=$(e);r?(t.disable(),(input=t.up("div.input"))?input.addClassName("disabled"):(input=t.up("div.checkbox"))&&input.addClassName("disabled")):(t.enable(),(input=t.up("div.input"))?input.removeClassName("disabled"):(input=t.up("div.checkbox"))&&input.removeClassName("disabled"))})}function observeDisableFieldsOnBoolean(t,n,i,r){if("1"==i){disableFieldsOnBoolean(t+(a="0"),n,a,!r)}else{var a="1";disableFieldsOnBoolean(t+i,n,i,r)}$(t+i).observe("click",function(e){disableFieldsOnBoolean(t+i,n,i,r)}),$(t+a).observe("click",function(e){disableFieldsOnBoolean(t+a,n,a,!r)})}function setDateInterval(e,t,n,i){var r=new Date;r.setDate(1),r.setMonth($F(e+"Month")-1),r.setYear($F(e+"Year")),r.setDate(r.getDate()+31*n),r.setDate(1),i||r.setDate(r.getDate()-1);var a=r.getDate();$(t+"Day").value=a<10?"0"+a:a;var o=r.getMonth()+1;$(t+"Month").value=o<10?"0"+o:o,$(t+"Year").value=r.getFullYear()}function setDateInterval2(e,t,n,i){var r=new Date;r.setDate(1),r.setMonth($F(e+"Month")),r.setYear($F(e+"Year")),r.setDate(r.getDate()+31*n),r.setDate(1),i||r.setDate(r.getDate()-1);r.getDate();$(t+"Day").value=$(e+"Day").value;var a=r.getMonth()+1;$(t+"Month").value=a<10?"0"+a:a,$(t+"Year").value=r.getFullYear();var o=new Date;o.setDate(1),o.setMonth($(t+"Month").value),o.setYear($(t+"Year").value),o.setDate(o.getDate()-1),o.getDate()<$(t+"Day").value&&($(t+"Day").value=o.getDate())}function setDateIntervalCer(e,t,n,i){var r=new Date;r.setYear(parseInt($F(e+"Year"),10)),r.setMonth(parseInt($F(e+"Month"),10)-1),r.setDate(parseInt($F(e+"Day"),10)),r.setMonth(r.getMonth()+parseInt(n,10)),r.setDate(r.getDate()-1);var a=r.getDate();$(t+"Year").value=r.getFullYear();var o=r.getMonth()+1;$(t+"Month").value=o<10?"0"+o:o,$(t+"Day").value=a<10?"0"+a:a}function setNbDayInterval(e,t,n){var i=new Date;i.setDate(1),i.setMonth($F(e+"Month")-1),i.setYear($F(e+"Year")),i.setDate(i.getDate()+31*nMonths),i.setDate(1),firstDay||i.setDate(i.getDate()-1);var r=i.getDate();$(t+"Day").value=r<10?"0"+r:r;var a=i.getMonth()+1;$(t+"Month").value=a<10?"0"+a:a,$(t+"Year").value=i.getFullYear()}function disableFieldsOnRadioValue(e,t,n,i,r,a){"object"!=typeof i&&(i=[i]),a=void 0!==a&&a;var o=$(e).getInputs("radio",t),s=void 0;$(o).each(function(e){e.checked&&(s=e.value)});var l=!1;i.each(function(e){s==e!=r&&(l=!0)}),n.each(function(e){var t=$(e);l?(t.disable(),(input=t.up("div.input"))?input.addClassName("disabled"):(input=t.up("div.checkbox"))&&input.addClassName("disabled"),a&&input.hide()):(t.enable(),(input=t.up("div.input"))?input.removeClassName("disabled"):(input=t.up("div.checkbox"))&&input.removeClassName("disabled"),a&&input.show())})}function observeDisableFieldsOnRadioValue(t,n,i,r,a,o){disableFieldsOnRadioValue(t,n,i,r,a,o=void 0!==o&&o);$($(t).getInputs("radio",n)).each(function(e){$(e).observe("change",function(e){disableFieldsOnRadioValue(t,n,i,r,a,o)})})}function disableFieldsetOnRadioValue(e,t,n,i,r,a){"object"!=typeof i&&(i=[i]),a=void 0!==a&&a;var o=$(e).getInputs("radio",t),s=$(n);if(null!=s){var l=void 0;$(o).each(function(e){e.checked&&(l=e.value)});var u=!1;i.each(function(e){l==e!=r&&(u=!0)}),u!=r?(s.removeClassName("disabled"),a&&s.show(),$$("#"+s.id+" div.input, #"+s.id+" radio").each(function(e){e.removeClassName("disabled")}),$$("#"+s.id+" input, #"+s.id+" select, #"+s.id+" button, #"+s.id+" textarea").each(function(t){try{t.enable()}catch(e){t.disabled=!1}})):(s.addClassName("disabled"),a&&s.hide(),$$("#"+s.id+" div.input, #"+s.id+" radio").each(function(e){e.addClassName("disabled")}),$$("#"+s.id+" input, #"+s.id+" select, #"+s.id+" button, #"+s.id+" textarea").each(function(t){try{t.disable()}catch(e){t.disabled=!0}}))}}function observeDisableFieldsetOnRadioValue(t,n,i,r,a,o){disableFieldsetOnRadioValue(t,n,i,r,a,o=void 0!==o&&o);$($(t).getInputs("radio",n)).each(function(e){$(e).observe("change",function(e){disableFieldsetOnRadioValue(t,n,i,r,a,o)})})}function makeTabbed(e,t){var o=new Element("ul",{class:"ui-tabs-nav"});$$("#"+e+" h"+t+".title").each(function(e){var t=e.up(),n=$(e).readAttribute("class").replace(/title/,"tab"),i=new Element("a",{href:"#"+t.id}).update(e.innerHTML),r=$(e).readAttribute("title");null!==r&&""!==r&&$(i).writeAttribute("title",r);var a=new Element("li",{class:n}).update(i);o.appendChild(a),t.addClassName("tab"),e.addClassName("tab hidden")}),$(e).insert({before:o}),new Control.Tabs(o)}function make_treemenus_droits(e,l){var u=e+"img/icons";$$("#tableEditDroits tr.niveau0 td.label").each(function(e){if(e.up("tr").next("tr").hasClassName("niveau1")){for(var t=$(e).up("tr"),n=$(t).next("tr"),i=2,r="fermer";null!=n&&Element.hasClassName(n,"niveau1");){var a=$(n).getElementsBySelector("input[type=checkbox]");2==i?i=$F(a[0]):i!=$F(a[0])&&(r="ouvert"),n=$(n).next("tr")}if("fermer"==r){if(l)var o=new Element("img",{src:u+"/bullet_toggle_plus2.png",alt:"tendre",width:"12px"});else o=new Element("img",{src:u+"/bullet_toggle_plus2.png",alt:"tendre"});for(n=$(t).next("tr");null!=n&&Element.hasClassName(n,"niveau1");)n.hide(),n=$(n).next("tr")}else if(l)o=new Element("img",{src:u+"/bullet_toggle_minus2.png",alt:"Rduire",width:"12px"});else o=new Element("img",{src:u+"/bullet_toggle_minus2.png",alt:"Rduire"});var s=o.wrap("a",{href:"#",class:"toggler",onclick:"return false;"});$(s).observe("click",function(e){for(var t=$(this).up("td").up("tr").next("tr");null!=t&&Element.hasClassName(t,"niveau1");)t.toggle(),t.visible()?($(this).down("img").src=u+"/bullet_toggle_minus2.png",$(this).down("img").alt="Rduire"):($(this).down("img").src=u+"/bullet_toggle_plus2.png",$(this).down("img").alt="tendre"),t=$(t).next("tr")}),$(e).insert({top:s})}});$$("#tableEditDroits").each(function(n){if(l)var e=new Element("img",{src:u+"/bullet_toggle_plus2.png",alt:"tendre",width:"12px"});else e=new Element("img",{src:u+"/bullet_toggle_plus2.png",alt:"tendre"});var t=e.wrap("a",{href:"#",class:"toggler",onclick:"return false;"});$(t).observe("click",function(e){$$("#tableEditDroits tr.niveau0 td.label").each(function(e){if(e.up("tr").next("tr").hasClassName("niveau1"))for(var t=$(e).up("tr").next("tr");null!=t&&Element.hasClassName(t,"niveau1");)"tendre"==$(n).down("img").alt?($(e).down("img").src=u+"/bullet_toggle_minus2.png",$(e).down("img").alt="Rduire",t.show()):($(e).down("img").src=u+"/bullet_toggle_plus2.png",$(e).down("img").alt="tendre",t.hide()),t=$(t).next("tr")}),"tendre"==$(n).down("img").alt?($(n).down("img").src=u+"/bullet_toggle_minus2.png",$(n).down("img").alt="Rduire"):($(n).down("img").src=u+"/bullet_toggle_plus2.png",$(n).down("img").alt="tendre")}),$(n).insert({top:t})})}function OpenTree(i,e,t){var r=e+"img/icons";$$("#tableEditDroits tr.niveau0 td.label").each(function(e){if(e.up("tr").next("tr").hasClassName("niveau1")){var t=$(e).up("tr");if("open"==i){$(e).down("a").down("img").src=r+"/bullet_toggle_minus2.png",$(e).down("a").down("img").alt="Rduire";for(var n=$(t).next("tr");null!=n&&Element.hasClassName(n,"niveau1");)n.show(),n=$(n).next("tr")}else{$(e).down("a").down("img").src=r+"/bullet_toggle_plus2.png",$(e).down("a").down("img").alt="tendre";for(n=$(t).next("tr");null!=n&&Element.hasClassName(n,"niveau1");)n.hide(),n=$(n).next("tr")}}})}function printit(){if(window.print)window.print();else{document.body.insertAdjacentHTML("beforeEnd",'<object id="WebBrowser1" WIDTH=0 HEIGHT=0 CLASSID="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2"></object>'),WebBrowser1.ExecWB(6,2)}}function textareaCharCounter(e,t,n){$("counter-"+e)||$(e).insert({after:'<div id="counter-'+e+'"></div>'}),$F(e).length>=t?(n&&($(e).value=$F(e).substring(0,t)),$("counter-"+e).addClassName("charcount-limit"),$("counter-"+e).removeClassName("charcount-safe")):($("counter-"+e).removeClassName("charcount-limit"),$("counter-"+e).addClassName("charcount-safe")),$("counter-"+e).update($F(e).length+"/"+t)}function textareaMakeItCount(e,t,n){null==n&&(n=!0),$(e)&&(Event.observe($(e),"keyup",function(){textareaCharCounter(e,t,n)},!1),Event.observe($(e),"keydown",function(){textareaCharCounter(e,t,n)},!1),textareaCharCounter(e,t,n))}function fireEvent(e,t){if(document.createEventObject){var n=document.createEventObject();return e.fireEvent("on"+t,n)}return(n=document.createEvent("HTMLEvents")).initEvent(t,!0,!0),!e.dispatchEvent(n)}function in_array(e,t,n){var i=new RegExp("_"+e+"$");n=void 0!==n&&n;for(var r=0,a=t.length;r<a;r++)if(t[r]==e||n&&String(t[r]).match(i))return!0;return!1}function changeColspanViewInfosEps(e,t,n,i,r){in_array(t,r=void 0!==r?r:["reporte","annule","maintienref","refuse","suspensionnonrespect","suspensiondefaut"])&&($(e).writeAttribute("colspan",n),i.each(function(e){$(e).hide()}))}function changeColspanFormAnnuleReporteEps(e,t,n,i){if(null===$(e))throw e+" element not found!";"reporte"==$F(n)||"annule"==$F(n)?($(e).writeAttribute("colspan",t),i.each(function(e){$(e).disable().up(1).hide()})):($(e).writeAttribute("colspan",1),i.each(function(e){$(e).enable().up(1).show()}))}function toutCocher(e,t){return null==e&&(e='input[type="checkbox"]'),$$(e).each(function(e){1!=t?$(e).checked=!0:1!=$(e).checked&&$(e).simulate("click")}),!1}function toutDecocher(e,t){return null==e&&(e='input[type="checkbox"]'),$$(e).each(function(e){1!=t?$(e).checked=!1:0!=$(e).checked&&$(e).simulate("click")}),!1}function insertButtonsCocherDecocher(e,t){void 0!==(e=$(e))&&(null==t&&(t='input[type="checkbox"]'),e.insert({top:new Element("button",{type:"button",onclick:"return toutCocher( '"+t+"' );"}).update("Tout cocher").outerHTML+new Element("button",{type:"button",onclick:"return toutDecocher( '"+t+"' );"}).update("Tout dcocher").outerHTML}))}function enableAndShowFormPart(e){$(e).removeClassName("disabled"),$(e).show(),$(e).getElementsBySelector("div.input").each(function(e){$(e).removeClassName("disabled")}),$(e).getElementsBySelector("input","select","button","textarea","radio").each(function(t){try{t.enable()}catch(e){t.disabled=!1}})}function disableAndHideFormPart(e){$(e).addClassName("disabled"),$(e).hide(),$(e).getElementsBySelector("div.input").each(function(e){$(e).addClassName("disabled")}),$(e).getElementsBySelector("input","select","button","textarea","radio").each(function(t){try{t.disable()}catch(e){t.disabled=!0}})}function makeErrorTabs(){$$(".error").each(function(e){$(e).ancestors().each(function(e){$(e).hasClassName("tab")&&$$("a[href=#"+$(e).readAttribute("id")+"]").each(function(e){$(e).up("li").addClassName("error")})})})}function filterSelectOptionsFromRadioValue(e,t,n,i){var r=$(e).getInputs("radio",t),a=void 0;$(r).each(function(e){e.checked&&(a=e.value)});var o=i[a];$$("#"+n+" option").each(function(e){""!=e.value&&(in_array(e.value,o)?e.show():e.hide())});var s=$F(n);""==s||in_array(s,o)||($(n).value="")}function observeFilterSelectOptionsFromRadioValue(t,n,i,r){filterSelectOptionsFromRadioValue(t,n,i,r),$($(t).getInputs("radio",n)).each(function(e){$(e).observe("change",function(e){filterSelectOptionsFromRadioValue(t,n,i,r)})})}function radioValue(e,t){var n=$(e).getInputs("radio",t),i=void 0;return $(n).each(function(e){e.checked&&(i=e.value)}),i}function toutChoisir(e,t,n){return $(e).each(function(e){e.value==t&&(1!=n?$(e).writeAttribute("checked","checked"):$(e).simulate("click"))}),!1}function make_external_links(){$$("a.external").each(function(t){var n=$(t).onclick;$(t).onclick=function(){var e=!0;return null!==n&&(e=n()),!0===e&&window.open($(t).href,"_blank"),!1}})}function serializeTableRow(e){var t=$(e).up("form"),n=$(e).up("tr").id;return Form.serializeElements($(t).getElementsBySelector("#"+n+" input","#"+n+" select","#"+n+" textarea"))}function observeDisableFormOnSubmit(r,n){n=void 0!==n?n:null;var e=$(r).getElementsBySelector("*[type=submit]");void 0!==e&&$(e).each(function(i){"string"==typeof $(i).name&&0<$(i).name.length&&Event.observe($(i),"click",function(e){var t="data["+$(i).name+"]";$(r).select('input[name="'+t+'"]').each(function(e){$(e).remove()});var n=new Element("input",{type:"hidden",name:t,value:$(i).value});$(r).insert({top:n})})}),Event.observe(r,"submit",function(e){if(null!=n){var t=new Element("p",{class:"notice"}).update(n);$(r).insert({top:t})}$$("#"+r+" *[type=submit]","#"+r+" *[type=reset]").each(function(e){$(e).disabled=!0})})}function replaceUrlFragments(e,n,i){i=void 0===i?null:i+",",$$(e).each(function(e){var t=$(e).readAttribute("href");null!==i&&(n=n.replace(/^#/,"#"+i)),t=t.replace(/#.*$/,"")+n,$(e).writeAttribute("href",t)})}function observeOnclickUrlFragments(e,t,n){$$(e).each(function(e){$(e).observe("click",function(){replaceUrlFragments(t,$(e).readAttribute("href"),n)})})}function observeOnloadUrlFragments(t,n){document.observe("dom:loaded",function(){if(-1!==window.location.href.indexOf("#")){var e=window.location.href.replace(/^.*#/,"#").replace(/^.*,([^,]+$)/g,"#$1");replaceUrlFragments(t,e,n)}})}function nbJoursIntervalleDates(e,t){var n=e.getTime(),i=t.getTime()-n;return Math.round(i/864e5)}function updateFieldFromDatesInterval(e,t,n){var i=$F(e+"Day")&&$F(e+"Month")&&$F(e+"Year"),r=$F(t+"Day")&&$F(t+"Month")&&$F(t+"Year");if(i&&r){var a=nbJoursIntervalleDates(new Date($F(e+"Year"),$F(e+"Month"),$F(e+"Day")),new Date($F(t+"Year"),$F(t+"Month"),$F(t+"Day")));$(n).update(a)}}function updateDateFromDateDuree(e,t,n){$F(e+"Year")&&$F(e+"Month")&&$F(e+"Day")&&$F(t)&&setDateInterval(e,n,$F(t),!1)}function strtotime(e,t){if(!e)return null;var n;if("now"===(e=e.trim().replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase()))return null===t||isNaN(t)?(new Date).getTime()/1e3|0:0|t;if(!isNaN(parse=Date.parse(e)))return parse/1e3|0;if("now"===e)return(new Date).getTime()/1e3;if(!isNaN(n=Date.parse(e)))return n/1e3;var i=e.match(/^(\d{2,4})-(\d{2})-(\d{2})(?:\s(\d{1,2}):(\d{2})(?::\d{2})?)?(?:\.(\d+)?)?$/);if(i){var r=0<=i[1]&&i[1]<=69?+i[1]+2e3:i[1];return new Date(r,parseInt(i[2],10)-1,i[3],i[4]||0,i[5]||0,i[6]||0,i[7]||0)/1e3}var o=t?new Date(1e3*t):new Date,s={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},l={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"};function a(e){var t=e.split(" "),n=t[0],i=t[1].substring(0,3),r=/\d+/.test(n),a=("last"===n?-1:1)*("ago"===t[2]?-1:1);if(r&&(a*=parseInt(n,10)),l.hasOwnProperty(i))return o["set"+l[i]](o["get"+l[i]]()+a);if("wee"===i)return o.setDate(o.getDate()+7*a);if("next"===n||"last"===n)!function(e,t,n){var i=s[t];if(void 0!==i){var r=i-o.getDay();0===r?r=7*n:0<r&&"last"===e?r-=7:r<0&&"next"===e&&(r+=7),o.setDate(o.getDate()+r)}}(n,i,a);else if(!r)return!1;return!0}if(!(i=e.match(new RegExp("([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday)|(last|next)\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday))(\\sago)?","gi"))))return!1;for(var u=0,c=i.length;u<c;u++)if(!a(i[u]))return!1;return o.getTime()/1e3}function cake_data(t){t.fields;var n={};if(t.fields.each(function(e){void 0!==t.full&&t.full?n[$(e).name]={domId:$(e).id,name:$(e).name,type:$(e).type,value:$F(e)}:n[$(e).name]=$F(e)}),"object"==typeof t.values)for(domId in t.values){var e=t.values[domId];void 0!==t.full&&t.full?n[$(domId).name].value=e:n[$(domId).name]=e}return n}Ajax.AbortableUpdater=Class.create(Ajax.Updater,{initialize:function(e,t,n,i){var r=n;void 0===window.updaters&&(window.updaters=new Hash);var a=window.updaters.get(r);void 0!==a&&(a.transport.abort(),window.updaters.unset(r));var o=(i=Object.clone(i)).onComplete;i.onComplete=function(e,t){Object.isFunction(o)&&o(e,t),window.updaters.unset(r)}.bind(this),e(t,n,i),window.updaters.set(r,this)}}),Ajax.AbortableRequest=Class.create(Ajax.Request,{initialize:function(e,t,n){var i=t;void 0===window.requests&&(window.requests=new Hash);var r=window.requests.get(i);void 0!==r&&(r.transport.abort(),window.requests.unset(i));var a=(n=Object.clone(n)).onComplete;n.onComplete=function(e,t){Object.isFunction(a)&&a(e,t),window.requests.unset(i)}.bind(this),e(t,n),window.requests.set(i,this)}});var unobservedKeys=[Event.KEY_TAB,Event.KEY_RETURN,Event.KEY_ESC,Event.KEY_LEFT,Event.KEY_UP,Event.KEY_RIGHT,Event.KEY_DOWN,Event.KEY_HOME,Event.KEY_END,Event.KEY_PAGEUP,Event.KEY_PAGEDOWN,Event.KEY_INSERT,16,17,18,19,20,42,44,91,112,113,114,115,116,117,118,119,120,121,122,123,144,145];function ajax_action_on_success(e,i){var t=e.responseText.evalJSON(!0);if(t.success){for(path in t.fields)try{var r=t.fields[path];if("select"===$(r).type){if(void 0!==$(r).options){var a=new Element("select");$(a).insert({bottom:new Element("option",{value:""})});var n=$(r).options;$(n)!=[]&&$(n).each(function(e){var t=void 0===$(e).title?"":$(e).title,n=Element("option",{value:$(e).id,title:t}).update($(e).name);$(a).insert({bottom:n})}),$($(r).id).update($(a).innerHTML)}}else if("ajax_select"===$(r).type){var o=$(r).id+"AjaxSelect",s=$(o);if(s&&$(s).remove(),void 0!==$(r).options&&0<$($(r).options).length){var l=new Element("ul");$($(r).options).each(function(n){var e=new Element("a",{href:"#",onclick:"return false;"}).update(n.name);$(e).observe("click",function(e){$(o).remove();var t={"data[Event][type]":"click","data[id]":$(r).id,"data[name]":i["data[Target][name]"],"data[value]":$(n).id,"data[prefix]":$(r).prefix};return new Ajax.AbortableRequest(i.url,{method:"post",parameters:t,onSuccess:function(e){ajax_action_on_success(e,t)}}),!1}),$(l).insert({bottom:$(e).wrap("li")})}),$($(r).id).up("div").insert({after:$(l).wrap("div",{id:o,class:"ajax select"})})}}if(void 0!==$(r).value)if("checkbox"===$($(r).id).type)$($(r).id).checked!==!(null===$(r).value||""===$(r).value||"0"==$(r).value)&&$($($(r).id)).simulate("click");else $($(r).id).value=$(r).value,!0===$(r).simulate&&$($(r).id).simulate("change")}catch(e){console.log(e)}"object"==typeof t.events&&0<t.events.length&&$(t.events).each(function(e){Event.fire(document,e)})}}function ajax_action(e,t){var a=["keyup","keydown"],n=function(t,n){var i=cake_data(n);i["data[prefix]"]=n.prefix,i["data[Event][type]"]=$(t).type;var r=$(t).element();i["data[Target][domId]"]=$(r).id,i["data[Target][name]"]=$(r).name,new Ajax.AbortableRequest(n.url,{parameters:i,onSuccess:function(e){i.url=n.url,ajax_action_on_success(e,i),in_array($(t).type,a)&&!in_array(t.keyCode,unobservedKeys)&&(r.removeClassName("loading"),delete window.ajax_timeout_queue[t.type][r.id])}})};if(in_array(e.type,a)){if(!in_array(e.keyCode,unobservedKeys)){var i=$(e).element(),r=void 0===t.delay?500:t.delay,o=void 0===t.min?3:t.min;if(window.ajax_timeout_queue=void 0===window.ajax_timeout_queue?{}:window.ajax_timeout_queue,window.ajax_timeout_queue[e.type]=void 0===window.ajax_timeout_queue[e.type]?{}:window.ajax_timeout_queue[e.type],$F(i).length>=o)i.addClassName("loading"),void 0!==window.ajax_timeout_queue[e.type][i.id]&&(clearTimeout(window.ajax_timeout_queue[e.type][i.id]),delete window.ajax_timeout_queue[e.type][i.id]),window.ajax_timeout_queue[e.type][i.id]=setTimeout(function(){n(e,t)},r);else{void 0!==window.ajax_timeout_queue[e.type][i.id]&&(clearTimeout(window.ajax_timeout_queue[e.type][i.id]),delete window.ajax_timeout_queue[e.type][i.id]),i.removeClassName("loading");var s=$($(i).id+"AjaxSelect");s&&$(s).remove()}}}else n(e,t)}function truncateWithEllipsis(e,t,n){t=void 0!==t?t:100,n=void 0!==n?n:"...";var i=$(e).innerHTML;if(i.length>t){var r=i.substr(0,t-n.length)+n;$(e).update(r),$(e).writeAttribute("title",i)}}function cakeDateTimeSeparator(e,t){void 0===t&&(t="  ");try{var n=$(e+"Hour"),i=$(n).up("div.input").down("span.datetime_separator");void 0!==$(i)&&$(i).each(function(e){$(e).remove()});var r=new Element("span",{class:"datetime_separator"}).update(t);$(n).insert({before:r})}catch(e){console.log(e)}}function getCakeQueriesCount(){var t=0;return $$("table.cake-sql-log").each(function(e){t+=e.rows.length-1}),t}var Commission={myTriggerEvent:function(e,t){try{Element.getStorage(e).get("prototype_event_registry").get(t).each(function(e){e.handler()})}catch(e){console.log(e)}},preremplissageDecisionOrientation:function(n,i,r){var a=n+i+"Decisioncov";$(a).observe("change",function(e){var t=!1;$(r).each(function(e){!1===t&&$F(a)===e.value&&(t=!0,$(n+i+"TypeorientId").value=e.typeorient_id,Commission.myTriggerEvent(n+i+"TypeorientId","change"),$(n+i+"StructurereferenteId").value=e.typeorient_id+"_"+e.structurereferente_id,Commission.myTriggerEvent(n+i+"StructurereferenteId","change"),""!==e.referent_id?$(n+i+"ReferentId").value=e.structurereferente_id+"_"+e.referent_id:$(n+i+"ReferentId").value="",Commission.myTriggerEvent(n+i+"ReferentId","change"))}),!1===t&&($(n+i+"TypeorientId").value="",Commission.myTriggerEvent(n+i+"TypeorientId","change"),$(n+i+"StructurereferenteId").value="",Commission.myTriggerEvent(n+i+"StructurereferenteId","change"),$(n+i+"ReferentId").value="",Commission.myTriggerEvent(n+i+"ReferentId","change"))})}},Evidence=function(){"use strict";var r=function(e){return null==e||!1===e},a=function(e){var t=$$(e);return 1===t.length?t[0]:null},o=function(e,t){var n;(n=void 0===t?{}:t).class=void 0===n.class?"evidence":n.class,n.title=void 0!==n.title&&n.title,t=n,r(e)||(r(t.class)||$(e).addClassName(t.class),r(t.title)||($(e).addClassName("title"),"DIV"===$(e).tagName?$(e).down("label").title=t.title:"FIELDSET"===$(e).tagName?$(e).down("legend").title=t.title:$(e).title=t.title))};return{find:function(e){var t=a(e);if(null!==t)return t;0===(t=$$(e)).length?console.log("Le slecteur "+e+" ne retourne aucun lment"):(console.log("Le slecteur "+e+" retourne "+t.length+" lments:"),console.log(t))},setQuestionParams:function(e,t){var n,i=(n=a(e),r(n)?null:$(n).up("div.input, fieldset"));null!==i&&o(i,t)},setOptionParams:function(e,t){var n=a(e);null!==n&&("checkbox"===n.type?n=$(n).up("div.input.checkbox, div.checkbox"):"radio"===n.type&&(n=a("label[for="+n.id+"]")),o(n,t))}}}();function initSortableTables(e){e=void 0===e?"sortable":e,TableKit.options.rowEvenClass="even",TableKit.options.rowOddClass="odd",TableKit.options.descendingClass="desc",TableKit.options.ascendingClass="asc",TableKit.options.sortableSelector=["table."+e],TableKit.Sortable.addSortType(new TableKit.Sortable.Type("date-fr",{pattern:Webrsa.Regexps.datetime(),normal:function(e){return Webrsa.Date.fromText(e)}})),TableKit.Sortable.detectors=$A($w("date-fr date-iso date date-eu date-au time currency datasize number casesensitivetext text")),$$("table."+e+" thead th").each(function(e){$(e).hasClassName("actions")&&$(e).addClassName("nosort"),$(e).hasClassName("date")&&$(e).addClassName("date-au")})}function cleanSelectOptgroups(e){var t,n;try{n=$F(e),$(t=$(e).select("optgroup")).each(function(e){0===$(e).childElements().length&&$(e).remove()}),1===(t=$(e).select("optgroup")).length&&$(t[0]).replace(t[0].innerHTML),$(e).value=n}catch(e){console.log(e)}}function limitSelectOptionsByPrefix(e,t){try{var n,i=$(e).select("option"),r=$F(e),a=new RegExp("^("+t+"|"+r.replace(/_.*$/,"")+")_");$(i).each(function(e){""!=(n=$(e).value)&&null===n.match(a)&&$(e).remove()}),cleanSelectOptgroups(e)}catch(e){console.log(e)}}function cleanSelectOptgroups2(e){var t;try{$F(e),$($(e).select("optgroup")).each(function(e){t=0,$(e).select("option").each(function(e){t+=$(e).visible()?1:0}),0===t&&$(e).hide()})}catch(e){console.log(e)}}function onChangeDependantSelect(e,t){try{var n=$F(t).replace(/^.*_([^_]+)$/,"$1"),i=$F(e);if(!1===$(t).enabled())return;$(e).select("optgroup","option").each(function(e){$(e).enable(),$(e).show()}),""!=n?$(e).select("option").each(function(e){""!=$(e).value&&$(e).value.replace(/^([^_]+)_.*$/,"$1")!==n&&($(e).disable(),$(e).hide())}):$(e).select("option").each(function(e){""!=$(e).value&&($(e).disable(),$(e).hide())}),!1===selectOptionVisible(e,i)&&($(e).value=""),cleanSelectOptgroups2(e),$(e).simulate("change")}catch(e){console.log(e)}}function dependantSelect(e,t){try{null!==$(e)&&(onChangeDependantSelect(e,t),$(t).observe("change",function(){onChangeDependantSelect(e,t)}))}catch(e){console.log(e)}}function selectOptionVisible(e,t){try{return $(e).select('option[value="'+t+'"]')[0].visible()}catch(e){return!1}}function onChangeDependantSelectsCommunautesr(e,t,n,i){try{var r=$F(e),a=$F(t);if(!1===$(e).enabled())return;$(t).select("optgroup","option").each(function(e){$(e).show()}),""!=r?$(t).select("option").each(function(e){""!=$(e).value&&!1===in_array($(e).value.replace(/^.*_([^_]+)$/,"$1"),n[r],!0)&&$(e).hide()}):!0===i&&$(t).select("option").each(function(e){""!=$(e).value&&$(e).hide()}),!1===selectOptionVisible(t,a)&&($(t).value=""),cleanSelectOptgroups2(t),$(t).simulate("change")}catch(e){console.log(e)}}function dependantSelectsCommunautesr(e,t,n,i){try{null!==$(e)&&(onChangeDependantSelectsCommunautesr(e,t,n,i),$(e).observe("change",function(){onChangeDependantSelectsCommunautesr(e,t,n,i)}))}catch(e){console.log(e)}}function onChangeDependantSelectsCommunautesrReferent(e,t,n,i){try{var r=$F(e),a=$F(t);if(!1===$(e).enabled())return;$(t).select("optgroup","option").each(function(e){$(e).show()}),""!=r?$(t).select("option").each(function(e){""!=$(e).value&&!1===in_array($(e).value.replace(/^([^_]+)_.*$/,"$1"),n[r],!0)&&$(e).hide()}):!0===i&&$(t).select("option").each(function(e){""!=$(e).value&&$(e).hide()}),!1===selectOptionVisible(t,a)&&($(t).value=""),cleanSelectOptgroups2(t),$(t).simulate("change")}catch(e){console.log(e)}}function dependantSelectsCommunautesrReferent(e,t,n,i){try{null!==$(e)&&(onChangeDependantSelectsCommunautesrReferent(e,t,n,i),$(e).observe("change",function(){onChangeDependantSelectsCommunautesrReferent(e,t,n,i)}))}catch(e){console.log(e)}}var replaceUrlNamedParam=function(e,t,n){var i=/^([a-z]+:\/\/|\/)([^#]*)(#.*){0,1}$/gi.exec(e);return null!==i&&(void 0===i[3]&&(i[3]=""),i[2]=i[2].replace(new RegExp("/"+t+":[^/]+"),"/"),i[2]=i[2]+"/"+t+":"+n,e=i[1]+i[2].replace(/\/+/g,"/")+i[3]),e},regExpQuote=function(e){return(e+"").replace(/[.?*+^$[\]\\(){}\/|-]/g,"\\$&")},pad_left=function(e,t,n){var i;if(e=String(e),t=Number(t),1!==(n=String(n)).length)throw message="La longueur du paramtre pattern est diffrente de 1 ("+n.length+"): "+n,new Error(message);if(e.length<t)for(i=0;i<=t-e.length;i++)e=n+e;return e},CakeDateSelects={get:function(t){var n,i={};try{i={year:$F(t+"Year"),month:$F(t+"Month"),day:$F(t+"Day")}}catch(e){n="Impossible de trouver les suffixes Year, Month ou Day pour l'id de champ de date "+t,console.error(n),i={year:null,month:null,day:null}}return i},set:function(t,n){var e,i,r;try{e=$(t+"Year"),i=$(t+"Month"),r=$(t+"Day")}catch(e){return message="Impossible de trouver les suffixes Year, Month ou Day pour l'id de champ de date: "+t,void console.error(message)}try{$(e).value=parseInt(n.getFullYear(),10),$(i).value=pad_left(parseInt(n.getMonth(),10)+1,2,0),$(r).value=pad_left(parseInt(n.getDate(),10),2,0)}catch(e){message="Le paramtre target n'est pas une date correcte (type "+typeof n+"): "+n,console.error(message)}},empty:function(e){var t=this.get(e);return""===t.year&&""===t.month&&""===t.day}};function dependantSelectOld(r,a){console.log("vieux");var e=void 0!==$(a)&&"SELECT"==$(a).tagName.toUpperCase(),t=void 0!==$(r)&&"SELECT"==$(r).tagName.toUpperCase();if(e&&t){var o=new Array,s=$F(r);null==o[r]&&(o[r]=new Array,o[r].values=new Array,o[r].options=new Array),$$("#"+r+" option").each(function(e){o[r].values.push(e.value),o[r].options.push(e.innerHTML)});var l="^(.*_){0,1}([^_]+)$",n=new RegExp("^"+$F(a).replace(new RegExp(l,"gi"),"$2")+"_","gi");$$("#"+r+" option").each(function(e){""!=$(e).value&&""!=$(e).value&&null==$(e).value.match(n)&&$(e).remove()}),Event.observe(a,"change",function(e){$$("#"+r+" option").each(function(e){$(e).remove()});var t=$(a).value.replace(new RegExp(l,"gi"),"$2");if(""!==t)for(var n=new RegExp("^"+t+"_"),i=0;i<o[r].values.length;i++)(""==o[r].values[i]||o[r].values[i].match(n,"g"))&&$(r).insert(new Element("option",{value:o[r].values[i]}).update(o[r].options[i]));$($$("#"+r+" option")).each(function(e){$(e).value==s&&($(e).selected="selected")}),$(r).simulate("change")})}}!function(){var o={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|mouse(?:down|up|over|move|out))$/},s={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0};Event.simulate=function(e,t){var n,i=Object.extend(s,arguments[2]||{}),r=null;for(var a in e=$(e),o)if(o[a].test(t)){r=a;break}if(!r)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");return document.createEvent?(n=document.createEvent(r),"HTMLEvents"==r?n.initEvent(t,i.bubbles,i.cancelable):n.initMouseEvent(t,i.bubbles,i.cancelable,document.defaultView,i.button,i.pointerX,i.pointerY,i.pointerX,i.pointerY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,e),e.dispatchEvent(n)):(i.clientX=i.pointerX,i.clientY=i.pointerY,n=Object.extend(document.createEventObject(),i),e.fireEvent("on"+t,n)),e},Element.addMethods({simulate:Event.simulate})}(),function(){var w=Prototype.Browser.IE?"paste":"input",T=null!=window.orientation;if(void 0===Prototype)throw"MaskedInput requires Prototype to be loaded.";Element.addMethods({caret:function(e,t,n){if(0!=e.length){if("number"!=typeof t){if(e.setSelectionRange)t=e.selectionStart,n=e.selectionEnd;else if(document.selection&&document.selection.createRange){n=(t=0-(i=document.selection.createRange()).duplicate().moveStart("character",-1e5))+i.text.length}return{begin:t,end:n}}if(n="number"==typeof n?n:t,e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var i;(i=e.createTextRange()).collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i.select()}}}}),MaskedInput=Class.create({initialize:function(e,t,n){this.elements=$$(e),this.mask(t,n)},unmask:function(){return this.elements.each(function(e){e.fire("mask:unmask")}),this},mask:function(h,m){if(!h&&0<this.elements.length){var e=$(this.elements[0]),v=e.retrieve("tests");return $A(e.retrieve("buffer")).map(function(e,t){return v[t]?e:null}).join("")}m=Object.extend({placeholder:"_",completed:null},m||{});var b=MaskedInput.definitions,g=(v=[],h.length),y=null,E=h.length;return $A(h.split("")).each(function(e,t){"?"==e?(E--,g=t):b[e]?(v.push(new RegExp(b[e])),null==y&&(y=v.length-1)):v.push(null)}),this.elements.each(function(e){var o=$(e),s=$A(h.replace(/\?/,"").split("")).map(function(e,t){return b[e]?m.placeholder:e}),l=!1,i=o.getValue();function u(e){for(;++e<E&&!v[e];);return e}function t(e){var t=o.caret(),n=e.keyCode;l=n<16||16<n&&n<32||32<n&&n<41,t.begin-t.end==0||l&&8!=n&&46!=n||d(t.begin,t.end),8==n||46==n||T&&127==n?(!function(e){for(;!v[e]&&0<=--e;);for(var t=e;t<E;t++)if(v[t]){s[t]=m.placeholder;var n=u(t);if(!(n<E&&v[t].test(s[n])))break;s[t]=s[n]}p(),o.caret(Math.max(y,e))}(t.begin+(46==n?0:-1)),e.stop()):27==n&&(o.setValue(i),o.caret(0,f()),e.stop())}function n(e){if(l)return l=!1,8!=e.keyCode&&null;var t=(e=e||window.event).charCode||e.keyCode||e.which,n=o.caret();if(e.ctrlKey||e.altKey||e.metaKey)return!0;if(32<=t&&t<=125||186<t){var i=u(n.begin-1);if(i<E){var r=String.fromCharCode(t);if(v[i].test(r)){!function(e){for(var t=e,n=m.placeholder;t<E;t++)if(v[t]){var i=u(t),r=s[t];if(s[t]=n,!(i<E&&v[i].test(r)))break;n=r}}(i),s[i]=r,p();var a=u(i);o.caret(a),m.completed&&a==E&&m.completed.call(o)}}}e.stop()}function r(e){f(),o.getValue()!=i&&window.Event.simulate&&o.simulate("change")}function a(e){i=o.getValue();var t=f();p(),setTimeout(function(){t==h.length?o.caret(0,t):o.caret(t)},0)}function c(e){setTimeout(function(){o.caret(f(!0))},0)}function d(e,t){for(var n=e;n<t&&n<E;n++)v[n]&&(s[n]=m.placeholder)}function p(){return o.setValue(s.join("")).getValue()}function f(e){for(var t=o.getValue(),n=-1,i=0,r=0;i<E;i++)if(v[i]){for(s[i]=m.placeholder;r++<t.length;){var a=t.charAt(r-1);if(v[i].test(a)){s[i]=a,n=i;break}}if(r>t.length)break}else s[i]==t[r]&&i!=g&&(r++,n=i);return!e&&n+1<g?(o.setValue(""),d(0,E)):(e||g<=n+1)&&(p(),e||o.setValue(o.getValue().substring(0,n+1))),g?i:y}o.store("buffer",s).store("tests",v),o.readAttribute("readonly")||o.observe("mask:unmask",function(){o.store("buffer",void 0).store("tests",void 0).stopObserving("mask:unmask").stopObserving("focus",a).stopObserving("blur",r).stopObserving("keydown",t).stopObserving("keypress",n).stopObserving(w,c)}).observe("focus",a).observe("blur",r).observe("keydown",t).observe("keypress",n).observe(w,c),f()}),this}}),Object.extend(MaskedInput,{definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}})}();var Validation={alphaNumeric:function(e){"use strict";return null!=e&&(!Array.isArray(e.match(/[!:;,\/.?*%\^$=()-+<>@_-`\[\]\\{}#"'~& ]|\s/g))&&0<e.length)},alphanumeric:function(e){"use strict";return Validation.alphaNumeric(e)},numeric:function(e){"use strict";return null!=e&&null!==e.match(/^[0-9]+([.,][0-9]+){0,1}$/)},notEmpty:function(e){"use strict";return null!==e&&0<(e=e.replace(/\s/g,"").replace(/ /g,"")).length},notBlank:function(e){"use strict";return null!==e&&0<(e=e.replace(/\s/g,"").replace(/ /g,"")).length},between:function(e,t,n){"use strict";return e=String(e).length,t=parseInt(t,10),n=parseInt(n,10),t<=e&&e<=n},checkIfInList:function(e,t,n){"use strict";var i;if("string"==typeof toString(e)&&Array.isArray(t))for(i=0;i<t.length;i++)if(t[i]=null===t[i]?"":t[i],n&&e===t[i]||!n&&Validation.similarTo(e,t[i]))return!0;return!1},inList:function(e,t,n){"use strict";return n=!("f"===(n=giveDefaultValue(n,!0))||Validation.similarTo(n,0)||Validation.similarTo(n,-1)||Validation.similarTo(n,"false")||!1===n),Validation.checkIfInList(e,t,n)},inRange:function(e,t,n,i){"use strict";return t=parseFloat(giveDefaultValue(t,-1/0)),n=parseFloat(giveDefaultValue(n,1/0)),i=giveDefaultValue(i,!0),e=parseFloat(e),i?t<=e&&e<=n:t<e&&e<n},range:function(e,t,n){"use strict";return Validation.inRange(e,t,n,!1)},inclusiveRange:function(e,t,n){"use strict";return Validation.inRange(e,t,n)},ssn:function(e){"use strict";return e=String(e),Array.isArray(e.match(/^(1|2|7|8)[0-9]{2}(0[1-9]|10|11|12|[2-9][0-9])((0[1-9]|[1-8][0-9]|9[0-5]|2A|2B)(00[1-9]|0[1-9][0-9]|[1-8][0-9][0-9]|9[0-8][0-9]|990)|(9[7-8][0-9])(0[1-9]|0[1-9]|[1-8][0-9]|90)|99(00[1-9]|0[1-9][0-9]|[1-8][0-9][0-9]|9[0-8][0-9]|990))(00[1-9]|0[1-9][0-9]|[1-9][0-9][0-9]|)(0[1-9]|[1-8][0-9]|9[0-7])$/))},getEnglishDate:function(e,t){"use strict";return"dmy"===t.toLowerCase()&&(e=e.indexOf(" ",7)<10||e.indexOf("T")<10?e.substr(6,2)+e.substr(2,4)+e.substr(0,2)+e.substr(8,e.length-8):e.substr(6,4)+e.substr(2,4)+e.substr(0,2)+e.substr(10,e.length-10)),e},date:function(e,t){"use strict";t=giveDefaultValue(t,[""])[0],e=Validation.getEnglishDate(e,t),e=Validation.transformIntoDate(e);var n=new Date(e).toJSON();return null!==n&&(e=e.replace(/([^0-9]?)/g,""),(n=n.replace(/([^0-9]?)/g,"")).substr(0,14)===e.substr(0,14))},completeDateTime:function(e){"use strict";return e=0<(e=0<(e=0<(e=zeroFillDate(e.substr(0,8).replace(/\.| |\//g,"-"))+e.substr(8,e.length-8).replace(" ","T")).indexOf("-")?e:"01-01-20T"+e).indexOf("T")?e:e+"T00:00:00").indexOf("Z")?e:e+".000Z"},yyToyyyy:function(e){"use strict";var t=e.substr(0,e.indexOf("-"));return 2===t.length&&8===e.indexOf("T")&&(t=30<=t?"19"+t:"20"+t),t},transformIntoDate:function(e){"use strict";var t;return!Validation.similarTo(e,null)&&(t=(e=Validation.completeDateTime(e)).indexOf("-"),2===(e=Validation.yyToyyyy(e)+e.substr(t)).indexOf("-")&&(e=e.substr(6,4)+e.substr(2,4)+e.substr(0,2)+e.substr(10,e.length-10)),e)},dateTime:function(e){"use strict";return Validation.date(e)},phoneFr:function(e){"use strict";return e=(e=9===(e=String(e)).length?"0"+e:e).replace(/ /g,"").replace(/\./g,""),Array.isArray(e.match(/^(((0)[1-9](\s?\d{2}){4})|(1[0-9]{1,3})|(11[0-9]{4})|(3[0-9]{3}))$/))},email:function(e){"use strict";return Array.isArray(e.match(/^[a-z0-9!#$%&\'*+\/=?\^_`{|}~\-]+(?:\.[a-z0-9!#$%&\'*+\/=?\^_`{|}~\-]+)*@(?:[\-_a-z0-9][\-_a-z0-9]*\.)*(?:[a-z0-9][\-a-z0-9]{0,62})\.(?:(?:[a-z]{2}\.)?[a-z]{2,})$/i))},integer:function(e){"use strict";return!isNaN(e)&&e%1==0&&null!==e},boolean:function(e){"use strict";return Validation.inList(e,[0,1,"0","1","true","false",!0,!1])},allEmpty:function(e){"use strict";var t;if(!Array.isArray(e))return!1;for(t=0;t<e.length;t++)if(null!==e[t]&&0<e[t].length)return!1;return!0},notEmptyIf:function(e,t,n,i){"use strict";return!(Validation.similarTo(e,null)||Validation.similarTo(t,null)||Validation.similarTo(n,null)||Validation.similarTo(i,null)||!Array.isArray(i))&&(Validation.inList(t,i,!1)!==n||Validation.notEmpty(e))},compareDates:function(e,t,n){"use strict";switch(n){case"<":return e<t;case">":return t<e;case"<=":return e<=t;case">=":return t<=e;case"==":return Validation.similarTo(e.toJSON(),t.toJSON());case"!=":return!Validation.similarTo(e.toJSON(),t.toJSON());case"===":return e.toJSON()===t.toJSON();case"!==":return e.toJSON()!==t.toJSON();default:return!1}},notNullIf:function(e,t,n,i){"use strict";return Validation.notEmptyIf(e,t,n,i)},maxLength:function(e,t){"use strict";return(e=null==e?0:e).length<=t},similarTo:function(e,t){"use strict";return String(e)===String(t)}},FormValidator={globalVars:{rules:[],values:{},editableList:{},errorElements:"div.input.date, div.input.text, div.input.textarea, div.input.radio, div.input.select",debugMode:!1,verbose:!1,ultraVerbose:!1},initializeVars:function(e){"use strict";for(var t in e)e.hasOwnProperty(t)&&(FormValidator.globalVars[t]=e[t])},getRealName:function(e){"use strict";var t,n=/^.+?\[([^\]]+)\]\[([^\]]+)\](\[day\]|\[month\]|\[year\]|\[\]){0,1}$/.exec(e);return null===n||4!==n.length?"":(t="data["+n[1]+"]["+n[2]+"]",void 0!==n[3]&&(t+=n[3]),t)},getModelName:function(e){"use strict";var t,n;return t=(e=FormValidator.getRealName(e)).indexOf("["),n=e.indexOf("]"),-1===t||-1===n?null:e.substr(t+1,n-t-1)},getFieldName:function(e){"use strict";var t,n,i,r;return t=(e=FormValidator.getRealName(e)).indexOf("["),n=e.indexOf("]"),i=e.indexOf("[",t+1),r=e.indexOf("]",n+1),-1===t||-1===n||-1===i||-1===r?null:e.substr(i+1,r-i-1)},getThirdParam:function(e){"use strict";var t;return e=FormValidator.getRealName(e),null===(t=/^[^\[]*(\[[^\]]*\]){2}\[([^\]]*)\].*$/g.exec(e))||t.length<3?null:t[2]},debug:function(e,t,n,i){"use strict";(void 0===i||i)&&(t=giveDefaultValue(t,!1),n=giveDefaultValue(n,!1),FormValidator.globalVars.debugMode&&(t&&FormValidator.globalVars.verbose||!t)&&(n&&FormValidator.globalVars.ultraVerbose||!n)&&console.log(e))},getParams:function(e){"use strict";var t,n=[];for(t=1;t<e.length;t++)n.push(e[t]);return n},addRule:function(e){"use strict";var t,n,i=void 0!==e.allowEmpty&&e.allowEmpty,r=[];return t={name:n="string"==typeof e.rule?e.rule:(r=FormValidator.getParams(e.rule),e.rule[0]),allowEmpty:i,params:r,message:e.message||FormValidator.globalVars.traductions[n]||null},FormValidator.debug("addRule( contain ) - var rule :",!0,!0),FormValidator.debug(t,!0,!0),t},extractRules:function(e){"use strict";var t,n,i=[];for(t in e)e.hasOwnProperty(t)&&(n=e[t],FormValidator.debug("getRules( name ) - var contain :",!0,!0),FormValidator.debug(n,!0,!0),void 0!==n.rule?i.push(FormValidator.addRule(n)):(FormValidator.debug("pas de rule trouv"),FormValidator.debug(n,!0)));return FormValidator.debug("",!0,!0),i},checkIfFromTo:function(e){"use strict";var t,n;return null!==e&&(t=e.indexOf("_from"),n=e.indexOf("_to"),0<t?e.substr(0,t):0<n?e.substr(0,n):e)},getRules:function(e){"use strict";var t,n;return void 0!==FormValidator.globalVars.validationRules&&(t=FormValidator.getModelName(e),n=FormValidator.checkIfFromTo(FormValidator.getFieldName(e)),void 0===FormValidator.globalVars.validationRules[t]||void 0===FormValidator.globalVars.validationRules[t][n]?null:FormValidator.extractRules(FormValidator.globalVars.validationRules[t][n]))},extractDate:function(e){"use strict";var t,n,i={day:"",month:"",year:""};if(!e||3!==e.length)return!1;for(n=0;n<3;n++){switch(t=FormValidator.getThirdParam(e[n].editable.name)){case"day":case"month":case"year":i[t]=e[n].editable.value;break;default:return!1}if(""===i[t])return""}return i},getDateElementsByName:function(e,t){"use strict";var n=FormValidator.globalVars.editableList[t],i=[],r=/^(.+)\[(?:day|month|year)\]$/g.exec(e),a=0;if(null===r||2!==r.length)return!1;for(;a<n.length;a++){switch(n[a].editable.name){case r[1]+"[day]":case r[1]+"[month]":case r[1]+"[year]":i.push(n[a])}if(3===i.length)return i}return!1},getDate:function(e){"use strict";var t,n;return t=FormValidator.getModelName(e)+"."+FormValidator.getFieldName(e),void 0!==FormValidator.globalVars.editableList[t]&&FormValidator.globalVars.editableList[t].length%3==0&&"null.null"!==t&&(!!(n=FormValidator.extractDate(FormValidator.getDateElementsByName(e,t)))&&n.day+"-"+n.month+"-"+n.year)},suffix:function(e,t){"use strict";t=giveDefaultValue(t,"_");var n=e.indexOf(t)+t.length;return 0<n?e.substr(n,e.length):e},formatValue:function(e,t){"use strict";return FormValidator.getFieldName(e.name).match(/_id/)&&(t=FormValidator.suffix(t)),t.trim()},getRadioValue:function(e){"use strict";var t,n="";for(t=0;t<e.length;t++)!0===e[t].checked&&(n+=n.length?","+String(e[t].value):String(e[t].value));return n},getCheckboxValue:function(e){"use strict";var t,n="",i="";for(t=0;t<e.length;t++)"hidden"===e[t].type?i=e[t].value:!0===e[t].checked&&(n+=n.length?","+String(e[t].value):String(e[t].value));return 0<n.length?n:i},isTelephone:function(e){"use strict";for(var t in FormValidator.globalVars.rules[e.index].rules)if(FormValidator.globalVars.rules[e.index].rules.hasOwnProperty(t)&&"phoneFr"===FormValidator.globalVars.rules[e.index].rules[t].name)return!0;return!1},getValue:function(e){"use strict";var t,n,i;if(void 0===FormValidator.globalVars.rules[e.index])return null;switch(t=$$('[name="'+FormValidator.globalVars.rules[e.index].name+'"]'),(n=FormValidator.getDate(FormValidator.globalVars.rules[e.index].name))?"date":1===t.length?"normal":t[1].type){case"date":i=n;break;case"normal":i=FormValidator.isTelephone(e)?String(e.value).replace(/[\W]/g,""):String(e.value);break;case"radio":i=FormValidator.getRadioValue(t);break;case"checkbox":i=FormValidator.getCheckboxValue(t);break;default:return FormValidator.debug("/!\\ BUG /!\\ valeur non trouv dans "+e.name),null}return FormValidator.globalVars.values[FormValidator.globalVars.rules[e.index].name].value=i,FormValidator.debug("Valeur trouv : "+i,!0,!0),n||FormValidator.formatValue(e,i)},empty:function(e){return null==e||!1===e},removeError:function(e){"use strict";var t,n;if(void 0===e)return!1;t=e.up(FormValidator.globalVars.errorElements),!1===FormValidator.empty(t)&&(t.removeClassName("error"),n=t.select("div.error-message")),void 0!==n&&void 0!==n[0]&&n[0].remove()},insertMessageVar:function(e,t){"use strict";var n,i=FormValidator.getRules(e.name);for(n=0;n<i.length;n++)if(i[n].message===t){switch(i[n].params.length){case 1:t=sprintf(t,i[n].params[0]);break;case 2:t=sprintf(t,i[n].params[0],i[n].params[1]);break;case 3:t=sprintf(t,i[n].params[0],i[n].params[1],i[n].params[2])}break}return t},showError:function(e,t){"use strict";var n;if(void 0===e)return!1;setTimeout(function(){t=null==t?"Champ obligatoire":FormValidator.insertMessageVar(e,t),void 0!==(n=e.up(FormValidator.globalVars.errorElements))&&(n.addClassName("error"),0===n.getElementsByClassName("error-message").length&&n.insert('<div class="error-message">'+t+"</div>"))},20)},getRulesParams:function(e,t){"use strict";var n,i,r,a,o=FormValidator.globalVars.rules[e.index].rules[t].name;if(n=Object.create(FormValidator.globalVars.rules[e.index].rules[t].params),a=FormValidator.globalVars.rules[e.index].name,void 0===Validation[o])return FormValidator.debug("Validation manquante : "+o),void FormValidator.debug(n,!0);if("notEmptyIf"===o||"notNullIf"===o){if(void 0===(r=$$('[name="'+(i="data["+FormValidator.getModelName(a)+"]["+n[0]+"]")+'"]')[0]))return FormValidator.debug("Cible du notEmptyIf non trouv! "+i,!0),FormValidator.debug("index = "+e.index,!0),void FormValidator.debug(FormValidator.globalVars.rules[e.index],!0);n[0]=FormValidator.getValue(r),FormValidator.debug("Target.value = "+n[0]+"; condition = "+n[1],!0),FormValidator.debug(n[2],!0)}return n},isValid:function(e,t,n,i,r){"use strict";var a,o,s,l=FormValidator.globalVars.rules[e.index].rules[n].name,u=!1;if("checkbox"===e.type.toLowerCase()&&"date"===l||"hidden"===e.type.toLowerCase())return!0;if("checkbox"===e.type.toLowerCase()&&0<=t.indexOf(","))for(s=t.split(","),o=0;o<s.length;o++)return!1!==FormValidator.isValid(e,s[o],n,i,r);switch(i.length){case 0:u=Validation[l](t);break;case 1:u=Validation[l](t,i[0]);break;case 2:u=Validation[l](t,i[0],i[1]);break;case 3:u=Validation[l](t,i[0],i[1],i[2])}return!!(u||FormValidator.globalVars.rules[e.index].rules[n].allowEmpty&&0===t.length)||(FormValidator.debug(l+" = false"),FormValidator.globalVars.validationOnchange&&r&&(a=FormValidator.globalVars.rules[e.index].rules[n].message,FormValidator.debug([FormValidator.getModelName(e.name),FormValidator.getFieldName(e.name),FormValidator.globalVars.validationRules[FormValidator.getModelName(e.name)][FormValidator.getFieldName(e.name)],a],!0),FormValidator.showError(e,a)),!1)},doValidation:function(e,t){"use strict";var n,i,r,a;if(r=FormValidator.globalVars.rules[e.index].rules,a=FormValidator.getValue(e),FormValidator.debug("-------------------- validation "+e.name+" --------------------"),FormValidator.debug("Valeur = "+a,!0),null===r||r.length<=0||r.allowEmpty)return!0;for(n=0;n<r.length;n++)if(void 0!==(i=FormValidator.getRulesParams(e,n))&&!FormValidator.isValid(e,a,n,i,t))return!1;return FormValidator.debug(FormValidator.globalVars.rules[e.index].rules[0].name+" = true"),!0},validate:function(e,t){"use strict";return null==e||void 0===e.index||void 0===FormValidator.globalVars.rules[e.index]||(t=giveDefaultValue(t,!1),FormValidator.globalVars.validationOnchange&&t&&FormValidator.removeError(e),FormValidator.doValidation(e,t))},showHeaderError:function(){"use strict";$$("#pageContent>p.error, #incrustation_erreur>p.error").each(function(e){e.remove()}),$("incrustation_erreur").innerHTML='<p class="error"><img src="'+FormValidator.globalVars.baseUrl+'img/icons/exclamation.png" alt="Erreur">\tErreur lors de l\'enregistrement</p>'},checkAll:function(e){"use strict";if(void 0===FormValidator.globalVars.rules||$("noValidation").checked)return!0;var t=!0;return $$("#"+e.id+" input, #"+e.id+" select,"+e.id+" textarea").each(function(e){"hidden"===e.getAttribute("type")||e.disabled||FormValidator.validate($(e),!0)||(t&&($(e).scrollTo(),window.scrollTo(0,window.pageYOffset)),FormValidator.debug("Validation chou :"),FormValidator.debug(e),t=!1)}),t?(FormValidator.debug("Validation russie"),FormValidator.globalVars.debugMode&&$$("#"+e.id+' input[type="submit"], #'+e.id+" button").each(function(e){setTimeout(function(){e.removeAttribute("disabled")},100)}),!FormValidator.globalVars.debugMode):($$("#"+e.id+' input[type="submit"], #'+e.id+" button").each(function(e){setTimeout(function(){e.removeAttribute("disabled")},100)}),FormValidator.debug("/!\\ Le formulaire n'a pas t envoy car il y a un ou plusieurs champs pas/mal rempli."),FormValidator.showHeaderError(),!1)},validateWithTimeout:function(e,t){"use strict";setTimeout(FormValidator.validate,10,e,t)},addEvent:function(e,t){"use strict";"editable"===(t=void 0===t?"editable":t)?(Event.observe(e,"change",function(){FormValidator.getValue(this),FormValidator.globalVars.values[this.name].value!==FormValidator.globalVars.values[this.name].oldValue&&FormValidator.validateWithTimeout(this,!0),FormValidator.globalVars.values[this.name].oldValue=String(FormValidator.globalVars.values[this.name].value)}),Event.observe(e,"keypress",function(){FormValidator.globalVars.values[this.name].oldValue=null===FormValidator.globalVars.values[this.name].oldValue?String(FormValidator.globalVars.values[this.name].value):FormValidator.globalVars.values[this.name].oldValue,FormValidator.getValue(this),FormValidator.validateWithTimeout(this,!1)})):Event.observe(e,"submit",function(e){0===$$('input[type=hidden][name="data[Cancel]"]').length&&!1===FormValidator.checkAll(this)&&Event.stop(e)})},initEditables:function(e){"use strict";var t,n,i,r;for(t=0;t<e.length;t++)n=e[t].name,e[t].index=t,FormValidator.debug("window.onload - Element "+n,!0,!0),void 0!==n&&""!==n&&"Cancel"!==n&&null!==(r={name:n,id:e[t].id,rules:FormValidator.getRules(n)}).rules&&(FormValidator.globalVars.values[n]={value:null,oldValue:null},i=FormValidator.getModelName(n)+"."+FormValidator.getFieldName(n),FormValidator.debug("window.onload - Nom format "+i,!0,!0),FormValidator.globalVars.editableList[i]=giveDefaultValue(FormValidator.globalVars.editableList[i],[]),FormValidator.globalVars.editableList[i].push({editable:e[t],form:$(e[t]).up("form")}),FormValidator.debug("window.onload - var editableList[formatedName] :",!0,!0),FormValidator.debug(FormValidator.globalVars.editableList[i],!0,!0),FormValidator.debug("window.onload - var editable :",!0,!0),FormValidator.debug(r,!0,!0),FormValidator.globalVars.rules[t]=r,FormValidator.globalVars.values[n]={value:null},FormValidator.getValue(r),FormValidator.addEvent(e[t]),FormValidator.debug("--------Fin de l'attribution de regles pour cet element---------",!0,!0),FormValidator.debug("",!0,!0),FormValidator.debug("",!0,!0))},initForms:function(e){"use strict";var t;for(t in e)if(e.hasOwnProperty(t)){if(1!==FormValidator.globalVars.validationOnsubmit)break;FormValidator.addEvent(e[t],"form")}},init:function(){"use strict";var e,t;if(void 0===FormValidator.globalVars.validationJS||void 0===FormValidator.globalVars.validationRules||void 0===FormValidator.globalVars.validationOnsubmit||void 0===FormValidator.globalVars.traductions||void 0===Validation||void 0===FormValidator.globalVars.validationOnchange||void 0===giveDefaultValue)return FormValidator.debug("validationJS ou validationRules absent!"),!1;FormValidator.globalVars.baseUrl=void 0!==FormValidator.globalVars.baseUrl?FormValidator.globalVars.baseUrl:"/",e=$$("form input, form select, form textarea"),FormValidator.initEditables(e),FormValidator.debug("------------------------rules--------------------------",!0,!0),FormValidator.debug(FormValidator.globalVars.rules,!0,!0),FormValidator.debug("-------------------------end---------------------------",!0,!0),t=$$("form"),FormValidator.initForms(t),$("pageFooter")&&$("pageFooter").insert('<input type="checkbox" id="noValidation">')}};function uncheckable(e){"use strict";e.onclick=function(){$$('input[name="'+e.name+'"]').each(function(e){e.checked&&e.state?(e.state=!1,e.checked=!1,"function"==typeof e.simulate&&e.simulate("change")):e.checked?e.state=!0:e.state=!1})}}function removeEmptyOptgroup(e){"use strict";var t,n,i,r,a=e.select("optgroup");if(null===a||0===a.length)return!1;for(t=0;t<a.length;t++)if(null!==(i=a[t].select("option"))&&0!==i.length){for(r=!0,n=0;n<i.length;n++)if(i[n].visible()){r=!1;break}r?a[t].hide():a[t].show()}else a[t].hide();return!0}function addParentId(e,t){"use strict";return null!=e&&""===e.up().id&&(e.up().id=void 0===t?e.id+"Parent":t,!0)}function divideIntoColumns(e,t){"use strict";var n=e.up(),i=Element.getWidth(n),r={},a=[],o=0,s=[];if(void 0!==n.divided)return e.remove(),!0;for(n.divided=!0,e.siblings().each(function(e){"LABEL"===e.tagName.toUpperCase()&&(e.style.width="100%")}),n.select("div").each(function(e){var t;e.select("label").length&&(t=e.select("label").first().innerHTML.replace(/[^A-Za-z]+/g,""),r[t.toUpperCase()]=Element.clone(e,!0),a.push(t.toUpperCase()))}),a.sort();o<t;o++)s[o]=new Element("div",{style:"width:"+Math.floor(i/t-1)+"px;display:inline-block;vertical-align:top;"}),n.insert(s[o]);for(o=0;o<a.length;o++)s[Math.floor(o/Math.ceil(a.length/t))].insert(r[a[o]]);return e.remove(),!0}function textareaResizeEvents(e){"use strict";var t=e.select("textarea").first(),n=e.select("span").first();t.observe("keydown",function(e){1===e.key.length&&(n.innerHTML=t.getValue()+e.key)}),t.observe("keyup",function(){n.innerHTML=t.getValue()}),t.observe("change",function(){n.innerHTML=t.getValue()}),e.addClassName("active"),n.innerHTML=t.getValue()}function makeTextareaAutoExpandable(e){"use strict";var t,n,i,r,a;t=new Element("div",{class:"autoExpandTextareaContainer"}),n=new Element("pre"),i=new Element("span"),r=Element.clone(e,!0),n.insert(i),n.insert("<br/><br/><br/>"),t.insert(n),t.insert(r),(a=e.visible())||e.show(),("100%"===e.getStyle("width")||99<getWidthInPercent(e))&&t.setStyle({width:"100%"}),r.setStyle({height:"100%"}),a||e.hide(),e.up().insertBefore(t,e),e.remove(),textareaResizeEvents(t)}function getWidthInPercent(e){var t,n=e.clone();return n.setStyle({width:"100%"}),e.up().insertBefore(n,e),t=parseFloat(e.getWidth(),10)/parseFloat(n.getWidth(),10)*100,n.remove(),t}function giveDefaultValue(e,t){"use strict";return void 0===e?t:e}function zeroFillDate(e){"use strict";return e.replace(/^(\d)\-/,"0$1-").replace(/\-(\d)\-/,"-0$1-").replace(/\-(\d)$/,"-0$1")}function inArray(e,t){"use strict";var n;if(null===e||"string"!=typeof toString(e)||!Array.isArray(t))return!1;for(n in t)if(t.hasOwnProperty(n)&&t[n]===e)return!0;return!1}function castArray(e){"use strict";return"object"!=typeof e?[e]:e}function fieldId(e){"use strict";var t,n,i="",r=e.split(/[\._]/);for(t=0;t<r.length;t++)i+=(n=r[t]).charAt(0).toUpperCase()+n.substring(1);return i}function sprintf(){var n=arguments,e=n[0],i=1;return e.replace(/%((%)|s|d)/g,function(e){var t=null;if(e[2])t=e[2];else{switch(t=n[i],e){case"%d":t=parseFloat(t),isNaN(t)&&(t=0)}i++}return t})}function setDateCloture(e,t){"use strict";var n,i,r,a,o=parseFloat($F(e),10),s=new Date,l=s.getUTCDate(),u=s.getUTCMonth()+1,c=s.getUTCFullYear(),d=t.split("."),p=0,f="data";if(isNaN(2*o)||d.length<2)return!1;for(;p<d.length;p++)f+="["+d[p]+"]";if(i=$$('select[name="'+f+'[day]"]').first(),r=$$('select[name="'+f+'[month]"]').first(),a=$$('select[name="'+f+'[year]"]').first(),void 0===i||void 0===r||void 0===a)throw'select[name="'+f+'"] + ([day] | [month] | [year]) Not Found!';n=new Date(c,u+Math.floor(o)-1,(o%1*30+l-1).toFixed(1)),i.setValue(n.getDate()),r.setValue(n.getMonth()+1),a.setValue(n.getFullYear()),a.simulate("change")}function getElementByString(e){"use strict";if(null===e)throw"La valeur de l'element est NULL, vous avez probablement tent de selectionner un element qui n'existe pas";if("object"!=typeof e)return e.match(/[\w]+\.[\w]+(\.[\w]+)*/)?$(fieldId(e)):$(e);if(void 0!==e.tagName)return e;throw"getElementByString() do not accept object"}function disable(e){"function"==typeof e.disable?e.disable():e.style.pointerEvents="none"}function enable(e){"function"==typeof e.enable?e.enable():e.style.pointerEvents="auto"}function evalCompare(e,t,n){var i;switch(void 0===t?"=":t){case!0:case"=":case"==":case"===":i=e===n;break;case!1:case"!":case"!=":case"!==":i=e!==n;break;case"<":i=parseFloat(e,10)<parseFloat(n,10);break;case">":i=parseFloat(e,10)>parseFloat(n,10);break;case"<=":i=parseFloat(e,10)<=parseFloat(n,10);break;case">=":i=parseFloat(e,10)>=parseFloat(n,10);break;default:throw"operator must be in (true, =, ==, ===, false, !, !=, !==, <, >, <=, >=)"}return i}function observeDisableElementsOnValues(e,t,n,i,r){"use strict";var a;for(e=e.constructor!==Array?[e]:e,t=t.constructor!==Array?[t]:t,disableElementsOnValues(e,t,n=void 0!==n&&n,i=void 0===i||i,r),a=0;a<t.length;a++){if(void 0===t[a].element||void 0===t[a].value)throw"Values must have element and value keys";getElementByString(t[a].element).observe("change",function(){disableElementsOnValues(e,t,n,i,r)})}}function disableElementsOnValues(e,t,n,i,r){"use strict";var a,o,s,l,u,c,d,p=!0,f=["div.input","div.checkbox","td.action"];for(e=e.constructor!==Array?[e]:e,t=t.constructor!==Array?[t]:t,n=void 0!==n&&n,i=void 0===i||i,a=0;a<t.length;a++){if(void 0===t[a].element||void 0===t[a].value)throw"Values must have element and value keys";if(c=null!==(u=getElementByString(t[a].element)).id?u.id:"string"==typeof t[a].element?t[a].element:"<object id=null>",null===u)throw"Element "+c+" is not found!";void 0!==t[a].operateur&&(t[a].operator=t[a].operateur),t[a].operator=void 0===t[a].operator?"=":t[a].operator,l=evalCompare(u.getValue(),t[a].operator,t[a].value),p=i&&0<a?p||l:p&&l,r&&(console.log("----------DEBUG: disableElementsOnValues()----------"),console.log("Element: '"+c+"' targetValue: '"+t[a].operator+" "+t[a].value+"' value: '"+u.getValue()+"' condition: "+(p?"true":"false")))}for(a=0;a<e.length;a++){if(null===(s=getElementByString(e[a])))throw"Element "+e[a]+" is not found!";for(o=0;o<f.length;o++){if(p&&s.up(f[o])){d=!0,disable(s),s.up(f[o]).addClassName("disabled"),n&&s.up(f[o]).hide();break}if(s.up(f[o])){d=!0,enable(s),s.up(f[o]).removeClassName("disabled"),n&&s.up(f[o]).show();break}}d||(p?(disable(s),s.addClassName("disabled"),n&&s.hide()):(enable(s),s.removeClassName("disabled"),n&&s.show()))}}if(document.observe("dom:loaded",FormValidator.init),"function"!=typeof Object.create&&(Object.create=function(){"use strict";var n=function(){};return function(e){if(1<arguments.length)throw new Error("Cette prothse ne supporte pas le second argument");if("object"!=typeof e)throw new TypeError("L'argument doit tre un objet");n.prototype=e;var t=new n;return n.prototype=null,t}}()),void 0===config)var config={debug:1};else config.debug=1;function debug(e){var t=(new Error).stack.split("\n");config.debug&&(console.log("------------------------------------------------"),console.log("DEBUG "+t[1]),console.log("("+typeof e+")"),console.log(e),console.log("------------------------------------------------"))}document.observe("dom:loaded",function(){"use strict";$$('input[type="radio"].uncheckable').each(function(e){var t=e.up("fieldset"),n=void 0!==t?t.select('input[type="hidden"][name="'+e.name+'"]').first():void 0;void 0===t&&(t=e.up()),void 0===n&&t.insert({top:'<input type="hidden" name="'+e.name+'" value="" />'}),e.state=e.checked,uncheckable(e)}),$$("input.percent").each(function(e){e.insert({after:'<div class="input-group-addon">%</div>'})}),$$("input.euros").each(function(e){e.insert({after:'<div class="input-group-addon"></div>'})}),$$(".add-parent-id").each(function(e){addParentId(e)}),$$(".divideInto2Columns").each(function(e){divideIntoColumns(e,2)}),$$(".divideInto3Columns").each(function(e){divideIntoColumns(e,3)})});var qq=qq||{};qq.extend=function(e,t){for(var n in t)e[n]=t[n]},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var i=e.length;for(n<0&&(n+=i);n<i;n++)if(n in e&&e[n]===t)return n;return-1},qq.getUniqueId=function(){var e=0;return function(){return e++}}(),qq.attach=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},qq.detach=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n)},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.insertBefore=function(e,t){t.parentNode.insertBefore(e,t)},qq.remove=function(e){e.parentNode.removeChild(e)},qq.contains=function(e,t){return e==t||(e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e)))},qq.toElement=function(){var n=document.createElement("div");return function(e){n.innerHTML=e;var t=n.firstChild;return n.removeChild(t),t}}(),qq.css=function(e,t){null!=t.opacity&&"string"!=typeof e.style.opacity&&void 0!==e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t)},qq.hasClass=function(e,t){return new RegExp("(^| )"+t+"( |$)").test(e.className)},qq.addClass=function(e,t){qq.hasClass(e,t)||(e.className+=" "+t)},qq.removeClass=function(e,t){var n=new RegExp("(^| )"+t+"( |$)");e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,"")},qq.setText=function(e,t){e.innerText=t,e.textContent=t},qq.children=function(e){for(var t=[],n=e.firstChild;n;)1==n.nodeType&&t.push(n),n=n.nextSibling;return t},qq.getByClass=function(e,t){if(e.querySelectorAll)return e.querySelectorAll("."+t);for(var n=[],i=e.getElementsByTagName("*"),r=i.length,a=0;a<r;a++)qq.hasClass(i[a],t)&&n.push(i[a]);return n},qq.obj2url=function(e,i,t){var r=[],n="&",a=function(e,t){var n=i?/\[\]$/.test(i)?i:i+"["+t+"]":t;"undefined"!=n&&"undefined"!=t&&r.push("object"==typeof e?qq.obj2url(e,n,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(n)+"="+encodeURIComponent(e()):encodeURIComponent(n)+"="+encodeURIComponent(e))};if(!t&&i)n=/\?/.test(i)?/\?$/.test(i)?"":"&":"?",r.push(i),r.push(qq.obj2url(e));else if("[object Array]"===Object.prototype.toString.call(e)&&void 0!==e)for(var o=0,s=e.length;o<s;++o)a(e[o],o);else if(null!=e&&"object"==typeof e)for(var o in e)a(e[o],o);else r.push(encodeURIComponent(i)+"="+encodeURIComponent(e));return r.join(n).replace(/^&/,"").replace(/%20/g,"+")};var qq=qq||{};qq.FileUploaderBasic=function(e){this._options={debug:!1,action:"/server/upload",params:{},button:null,multiple:!0,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(e,t){},onProgress:function(e,t,n,i){},onComplete:function(e,t,n){},onCancel:function(e,t){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(e){alert(e)}},qq.extend(this._options,e),this._filesInProgress=0,this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},qq.FileUploaderBasic.prototype={setParams:function(e){this._options.params=e},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(e){var t=this;return new qq.UploadButton({element:e,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(e){t._onInputChange(e)}})},_createUploadHandler:function(){var e,r=this;return e=qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm",new qq[e]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(e,t,n,i){r._onProgress(e,t,n,i),r._options.onProgress(e,t,n,i)},onComplete:function(e,t,n){r._onComplete(e,t,n),r._options.onComplete(e,t,n)},onCancel:function(e,t){r._onCancel(e,t),r._options.onCancel(e,t)}})},_preventLeaveInProgress:function(){var t=this;qq.attach(window,"beforeunload",function(e){if(t._filesInProgress)return(e=e||window.event).returnValue=t._options.messages.onLeave,t._options.messages.onLeave})},_onSubmit:function(e,t){this._filesInProgress++},_onProgress:function(e,t,n,i){},_onComplete:function(e,t,n){this._filesInProgress--,n.error&&this._options.showMessage(n.error)},_onCancel:function(e,t){this._filesInProgress--},_onInputChange:function(e){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList(e.files):this._validateFile(e)&&this._uploadFile(e),this._button.reset()},_uploadFileList:function(e){for(var t=0;t<e.length;t++)if(!this._validateFile(e[t]))return;for(t=0;t<e.length;t++)this._uploadFile(e[t])},_uploadFile:function(e){var t=this._handler.add(e),n=this._handler.getName(t);!1!==this._options.onSubmit(t,n)&&(this._onSubmit(t,n),this._handler.upload(t,this._options.params))},_validateFile:function(e){var t,n;return e.value?t=e.value.replace(/.*(\/|\\)/,""):(t=null!=e.fileName?e.fileName:e.name,n=null!=e.fileSize?e.fileSize:e.size),this._isAllowedExtension(t)?0===n?(this._error("emptyError",t),!1):n&&this._options.sizeLimit&&n>this._options.sizeLimit?(this._error("sizeError",t),!1):!(n&&n<this._options.minSizeLimit)||(this._error("minSizeError",t),!1):(this._error("typeError",t),!1)},_error:function(e,t){var n=this._options.messages[e];function i(e,t){n=n.replace(e,t)}i("{file}",this._formatFileName(t)),i("{extensions}",this._options.allowedExtensions.join(", ")),i("{sizeLimit}",this._formatSize(this._options.sizeLimit)),i("{minSizeLimit}",this._formatSize(this._options.minSizeLimit)),this._options.showMessage(n)},_formatFileName:function(e){return 33<e.length&&(e=e.slice(0,19)+"..."+e.slice(-13)),e},_isAllowedExtension:function(e){var t=-1!==e.indexOf(".")?e.replace(/.*[.]/,"").toLowerCase():"",n=this._options.allowedExtensions;if(!n.length)return!0;for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==t)return!0;return!1},_formatSize:function(e){for(var t=-1;t++,99<(e/=1024););return Math.max(e,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][t]}},qq.FileUploader=function(e){qq.FileUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Upload a file</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}}),qq.extend(this._options,e),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button=this._createUploadButton(this._find(this._element,"button")),this._bindCancelEvent(),this._setupDragDrop()},qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype),qq.extend(qq.FileUploader.prototype,{_find:function(e,t){var n=qq.getByClass(e,this._options.classes[t])[0];if(!n)throw new Error("element not found "+t);return n},_setupDragDrop:function(){var t=this,n=this._find(this._element,"drop"),i=new qq.UploadDropZone({element:n,onEnter:function(e){qq.addClass(n,t._classes.dropActive),e.stopPropagation()},onLeave:function(e){e.stopPropagation()},onLeaveNotDescendants:function(e){qq.removeClass(n,t._classes.dropActive)},onDrop:function(e){n.style.display="none",qq.removeClass(n,t._classes.dropActive),t._uploadFileList(e.dataTransfer.files)}});n.style.display="none",qq.attach(document,"dragenter",function(e){i._isValidFileDrag(e)&&(n.style.display="block")}),qq.attach(document,"dragleave",function(e){if(i._isValidFileDrag(e)){var t=document.elementFromPoint(e.clientX,e.clientY);t&&"HTML"!=t.nodeName||(n.style.display="none")}})},_onSubmit:function(e,t){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onProgress:function(e,t,n,i){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var r,a=this._getItemByFileId(e),o=this._find(a,"size");o.style.display="inline",r=n!=i?Math.round(n/i*100)+"% from "+this._formatSize(i):this._formatSize(i),qq.setText(o,r)},_onComplete:function(e,t,n){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var i=this._getItemByFileId(e);qq.remove(this._find(i,"cancel")),qq.remove(this._find(i,"spinner")),n.success?qq.addClass(i,this._classes.success):qq.addClass(i,this._classes.fail)},_addToList:function(e,t){var n=qq.toElement(this._options.fileTemplate);n.qqFileId=e;var i=this._find(n,"file");qq.setText(i,this._formatFileName(t)),this._find(n,"size").style.display="none",this._listElement.appendChild(n)},_getItemByFileId:function(e){for(var t=this._listElement.firstChild;t;){if(t.qqFileId==e)return t;t=t.nextSibling}},_bindCancelEvent:function(){var i=this,e=this._listElement;qq.attach(e,"click",function(e){var t=(e=e||window.event).target||e.srcElement;if(qq.hasClass(t,i._classes.cancel)){qq.preventDefault(e);var n=t.parentNode;i._handler.cancel(n.qqFileId),qq.remove(n)}})}}),qq.UploadDropZone=function(e){this._options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},qq.extend(this._options,e),this._element=this._options.element,this._disableDropOutside(),this._attachEvents()},qq.UploadDropZone.prototype={_disableDropOutside:function(e){qq.UploadDropZone.dropOutsideDisabled||(qq.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var n=this;qq.attach(n._element,"dragover",function(e){if(n._isValidFileDrag(e)){var t=e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect="move"==t||"linkMove"==t?"move":"copy",e.stopPropagation(),e.preventDefault()}}),qq.attach(n._element,"dragenter",function(e){n._isValidFileDrag(e)&&n._options.onEnter(e)}),qq.attach(n._element,"dragleave",function(e){if(n._isValidFileDrag(e)){n._options.onLeave(e);var t=document.elementFromPoint(e.clientX,e.clientY);qq.contains(this,t)||n._options.onLeaveNotDescendants(e)}}),qq.attach(n._element,"drop",function(e){n._isValidFileDrag(e)&&(e.preventDefault(),n._options.onDrop(e))})},_isValidFileDrag:function(e){var t=e.dataTransfer,n=-1<navigator.userAgent.indexOf("AppleWebKit");return t&&"none"!=t.effectAllowed&&(t.files||!n&&t.types.contains&&t.types.contains("Files"))}},qq.UploadButton=function(e){this._options={element:null,multiple:!1,name:"file",onChange:function(e){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},qq.extend(this._options,e),this._element=this._options.element,qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq.remove(this._input),qq.removeClass(this._element,this._options.focusClass),this._input=this._createInput()},_createInput:function(){var e=document.createElement("input");this._options.multiple&&e.setAttribute("multiple","multiple"),e.setAttribute("type","file"),e.setAttribute("name",this._options.name),qq.css(e,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(e);var t=this;return qq.attach(e,"change",function(){t._options.onChange(e)}),qq.attach(e,"mouseover",function(){qq.addClass(t._element,t._options.hoverClass)}),qq.attach(e,"mouseout",function(){qq.removeClass(t._element,t._options.hoverClass)}),qq.attach(e,"focus",function(){qq.addClass(t._element,t._options.focusClass)}),qq.attach(e,"blur",function(){qq.removeClass(t._element,t._options.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}},qq.UploadHandlerAbstract=function(e){this._options={debug:!1,action:"/upload.php",maxConnections:999,onProgress:function(e,t,n,i){},onComplete:function(e,t,n){},onCancel:function(e,t){}},qq.extend(this._options,e),this._queue=[],this._params=[]},qq.UploadHandlerAbstract.prototype={log:function(e){this._options.debug&&window.console&&console.log("[uploader] "+e)},add:function(e){},upload:function(e,t){var n=this._queue.push(e),i={};qq.extend(i,t),this._params[e]=i,n<=this._options.maxConnections&&this._upload(e,this._params[e])},cancel:function(e){this._cancel(e),this._dequeue(e)},cancelAll:function(){for(var e=0;e<this._queue.length;e++)this._cancel(this._queue[e]);this._queue=[]},getName:function(e){},getSize:function(e){},getQueue:function(){return this._queue},_upload:function(e){},_cancel:function(e){},_dequeue:function(e){var t=qq.indexOf(this._queue,e);this._queue.splice(t,1);var n=this._options.maxConnections;if(this._queue.length>=n){var i=this._queue[n-1];this._upload(i,this._params[i])}}},qq.UploadHandlerForm=function(e){qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={}},qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerForm.prototype,{add:function(e){e.setAttribute("name","qqfile");var t="qq-upload-handler-iframe"+qq.getUniqueId();return(this._inputs[t]=e).parentNode&&qq.remove(e),t},getName:function(e){return this._inputs[e].value.replace(/.*(\/|\\)/,"")},_cancel:function(e){this._options.onCancel(e,this.getName(e)),delete this._inputs[e];var t=document.getElementById(e);t&&(t.setAttribute("src","javascript:false;"),qq.remove(t))},_upload:function(t,e){var n=this._inputs[t];if(!n)throw new Error("file with passed id was not added, or already uploaded or cancelled");var i=this.getName(t),r=this._createIframe(t),a=this._createForm(r,e);a.appendChild(n);var o=this;return this._attachLoadEvent(r,function(){o.log("iframe loaded");var e=o._getIframeContentJSON(r);o._options.onComplete(t,i,e),o._dequeue(t),delete o._inputs[t],setTimeout(function(){qq.remove(r)},1)}),a.submit(),qq.remove(a),t},_attachLoadEvent:function(e,t){qq.attach(e,"load",function(){e.parentNode&&(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML||t())})},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(e){response={}}return response},_createIframe:function(e){var t=qq.toElement('<iframe src="javascript:false;" name="'+e+'" />');return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t},_createForm:function(e,t){var n=qq.toElement('<form method="post" enctype="multipart/form-data"></form>'),i=qq.obj2url(t,this._options.action);return n.setAttribute("action",i),n.setAttribute("target",e.name),n.style.display="none",document.body.appendChild(n),n}}),qq.UploadHandlerXhr=function(e){qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},qq.UploadHandlerXhr.isSupported=function(){var e=document.createElement("input");return e.type="file","multiple"in e&&"undefined"!=typeof File&&void 0!==(new XMLHttpRequest).upload},qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerXhr.prototype,{add:function(e){if(!(e instanceof File))throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(e)-1},getName:function(e){var t=this._files[e];return null!=t.fileName?t.fileName:t.name},getSize:function(e){var t=this._files[e];return null!=t.fileSize?t.fileSize:t.size},getLoaded:function(e){return this._loaded[e]||0},_upload:function(t,e){var n=this._files[t],i=this.getName(t);this.getSize(t);this._loaded[t]=0;var r=this._xhrs[t]=new XMLHttpRequest,a=this;r.upload.onprogress=function(e){e.lengthComputable&&(a._loaded[t]=e.loaded,a._options.onProgress(t,i,e.loaded,e.total))},r.onreadystatechange=function(){4==r.readyState&&a._onComplete(t,r)},(e=e||{}).qqfile=i;var o=qq.obj2url(e,this._options.action);r.open("POST",o,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("X-File-Name",encodeURIComponent(i)),r.setRequestHeader("Content-Type","application/octet-stream"),r.send(n)},_onComplete:function(id,xhr){if(this._files[id]){var name=this.getName(id),size=this.getSize(id);if(this._options.onProgress(id,name,size,size),200==xhr.status){var response;this.log("xhr - server response received"),this.log("responseText = "+xhr.responseText);try{response=eval("("+xhr.responseText+")")}catch(e){response={}}this._options.onComplete(id,name,response)}else this._options.onComplete(id,name,{});this._files[id]=null,this._xhrs[id]=null,this._dequeue(id)}},_cancel:function(e){this._options.onCancel(e,this.getName(e)),this._files[e]=null,this._xhrs[e]&&(this._xhrs[e].abort(),this._xhrs[e]=null)}}),qq.WebrsaFileUploader=function(o){qq.FileUploader.apply(this,arguments),qq.extend(this._options,{template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Parcourir</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Annuler</a><span class="qq-upload-failed-text">Erreur</span></li>',onProgress:function(e,t,n,i){var r=$$(".qq-upload-size");$(r[$(r).length-1]).writeAttribute("style","");var a=$$(".qq-upload-file");$(a[$(a).length-1]).update(t)},setStatus:function(e,t){var n=$$(".qq-upload-failed-text"),i=n[$(n).length-1];$(i).update(t),$(i).addClassName("qq-upload-status-text"),e?$(i).addClassName("success"):$(i).addClassName("error")},onComplete:function(e,t,n){var i=!1,r="Erreur inattendue";if(void 0!==n.success&&!0===n.success){var a=$$(".qq-upload-file"),o=a[$(a).length-1];this.addAjaxUploadedFileLinks(o,t),r="Copi",i=!0}else void 0!==n.error&&(r=n.error);this.setStatus(i,r)},showMessage:function(e){this.setStatus(!1,e)},addAjaxUploadedFileLinks:function(elmt,fileName){void 0===fileName&&(fileName=$(elmt).innerHTML);var href=o.links.view+"/"+fileName,link=new Element("a",{href:href,class:"qq-upload-view"}).update("Voir");$(elmt).up("li").insert({bottom:link}),href=o.links.delete+"/"+fileName,link=new Element("a",{href:href,class:"qq-upload-delete"}).update("Supprimer"),Event.observe(link,"click",function(e){Event.stop(e),new Ajax.Request($(Event.element(e)).getAttribute("href"),{method:"post",onComplete:function(transport){try{response=eval("("+transport.responseText+")")}catch(e){response={}}response.success&&!0===response.success?$(elmt).up("li").remove():alert("Erreur!")}})}),$(elmt).up("li").insert({bottom:link})}}),qq.extend(this._options,o),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button=this._createUploadButton(this._find(this._element,"button")),this._bindCancelEvent(),this._setupDragDrop()},qq.extend(qq.WebrsaFileUploader.prototype,qq.FileUploader.prototype);var Cake=void 0!==Cake?Cake:{};Cake.Validation=void 0!==Cake.Validation?Cake.Validation:{},Cake.Search=void 0!==Cake.Search?Cake.Search:{},Cake.Form=void 0!==Cake.Form?Cake.Form:{},Cake.Validation.date=function(e){var n={year:null,month:null,day:null};e.select("select").each(function(t){["year","month","day"].each(function(e){!1===$(t).disabled&&new RegExp(e).test($(t).name)&&""!==$(t).value&&(n[e]=$(t).value)})});var t=null===n.year&&null===n.month&&null===n.day,i=null===n.year||null===n.month||null===n.day;return t||i||!1===isNaN(Date.parse(n.year+"-"+n.month+"-"+n.day))},Cake.Form.inputError=function(e,t){var n=e.getElementsBySelector(".error-message");0<n.length&&n.each(function(e){$(e).remove()}),e.removeClassName("error"),void 0!==t&&(e.addClassName("error"),e.insert('<div class="error-message">'+t+"</div>"))},Cake.Search.validate=function(e){var t=!0;return $$("#"+e.id+" div.input.date").each(function(e){!0===Cake.Validation.date(e)?Cake.Form.inputError(e):(Cake.Form.inputError(e,"Veuillez entrer une date valide."),t=!1)}),t},Cake.Search.onSubmit=function(e){var t=Event.element(e),n=Cake.Search.validate(t);return!1===n&&($$("#"+t.id+" *[type=submit]","#"+t.id+" *[type=reset]").each(function(t){try{t.enable()}catch(e){t.disabled=!1}}),Event.stop(e),Element.scrollTo(t.getElementsBySelector(".error-message")[0].up("div.input"))),n};var CakeTabbedPaginator={explicitPages:function(e){var t;try{$$(e+" a").each(function(e){t=$(e).readAttribute("rel"),"1"!==$(e).innerHTML&&"first"!==t&&"prev"!==t||($(e).href=replaceUrlNamedParam($(e).href,"page","1"))})}catch(e){console.error(e)}},initTab:function(e,i){for(var t,n={},r=/\/(sort|direction|page)\[([^\]]+)\]:([^\/#]*)/gi;null!==(t=r.exec(window.location.href.toString()));)n[t[1]+"["+t[2]+"]"]=t[3];$$(e).each(function(t){var n=$(t).readAttribute("id");["thead a",i+" a"].each(function(e){$(t).getElementsBySelector(e).each(function(e){$(e).href=$(e).href.replace(/\/(sort|direction|page):/g,"/$1["+n+"]:")})})}),[e+" thead a",e+" "+i+" a"].each(function(e){$$(e).each(function(e){for(var t in n)n.hasOwnProperty(t)&&null===(r=new RegExp(regExpQuote(t),"gi")).exec($(e).href)&&($(e).href=replaceUrlNamedParam($(e).href,t,n[t]))})})},init:function(n,e,t,i){t=void 0===t?"div.tab":t,i=void 0===i?".pagination":i,makeTabbed(n=void 0===n?"tabbedWrapper":n,e=void 0===e?2:e),$$(t).each(function(e){var t=$(e).readAttribute("id");$(e).getElementsBySelector("thead a",i+" a").each(function(e){$(e).writeAttribute("href",$(e).readAttribute("href")+"#"+n+","+t)})}),this.explicitPages(t+" "+i),this.initTab(t,i)}},Fabtabs=Class.create();Fabtabs.prototype={initialize:function(e){this.element=$(e);Object.extend({},arguments[1]||{});this.menu=$A(this.element.getElementsByTagName("a")),this.show(this.getInitialTab()),this.menu.each(this.setupTab.bind(this))},setupTab:function(e){Event.observe(e,"click",this.activate.bindAsEventListener(this),!1)},activate:function(e){var t=Event.findElement(e,"a");Event.stop(e),this.show(t),this.menu.without(t).each(this.hide.bind(this))},hide:function(e){$(e).removeClassName("active-tab"),$(this.tabID(e)).removeClassName("active-tab-body")},show:function(e){$(e).addClassName("active-tab"),$(this.tabID(e)).addClassName("active-tab-body")},tabID:function(e){return e.href.match(/#(\w.+)/)[1]},getInitialTab:function(){if(document.location.href.match(/#(\w.+)/)){var t=RegExp.$1;return this.menu.find(function(e){return e.href.match(/#(\w.+)/)[1]==t})||this.menu.first()}return this.menu.first()}};var TableKit=Class.create();if(TableKit.prototype={initialize:function(e,t){var n=$(e);if("TABLE"===n.tagName){TableKit.register(n,Object.extend(TableKit.options,t||{})),this.id=n.id;var i=TableKit.option("sortable resizable editable",this.id);i.sortable&&TableKit.Sortable.init(n),i.resizable&&TableKit.Resizable.init(n),i.editable&&TableKit.Editable.init(n)}},sort:function(e,t){TableKit.Sortable.sort(this.id,e,t)},resizeColumn:function(e,t){TableKit.Resizable.resize(this.id,e,t)},editCell:function(e,t){TableKit.Editable.editCell(this.id,e,t)}},Object.extend(TableKit,{getBodyRows:function(e){var t=(e=$(e)).id;return TableKit.tables[t].dom.rows||(TableKit.tables[t].dom.rows=e.tHead&&0<e.tHead.rows.length?$A(e.tBodies[0].rows):$A(e.rows).without(e.rows[0])),TableKit.tables[t].dom.rows},getHeaderCells:function(e,t){e||(e=$(t).up("table"));var n=e.id;return TableKit.tables[n].dom.head||(TableKit.tables[n].dom.head=$A(e.tHead&&0<e.tHead.rows.length?e.tHead.rows[e.tHead.rows.length-1].cells:e.rows[0].cells)),TableKit.tables[n].dom.head},getCellIndex:function(e){return $A(e.parentNode.cells).indexOf(e)},getRowIndex:function(e){return $A(e.parentNode.rows).indexOf(e)},getCellText:function(e,t){if(!e)return"";var n=TableKit.getCellData(e);return(t||n.refresh||!n.textContent)&&(n.textContent=e.textContent?e.textContent:e.innerText,n.refresh=!1),n.textContent},getCellData:function(e){var t=null;e.id||(t=$(e).up("table"),e.id=t.id+"-cell-"+TableKit._getc());var n=t?t.id:e.id.match(/(.*)-cell.*/)[1];return TableKit.tables[n].dom.cells[e.id]||(TableKit.tables[n].dom.cells[e.id]={textContent:"",htmlContent:"",active:!1}),TableKit.tables[n].dom.cells[e.id]},register:function(e,t){e.id||(e.id="tablekit-table-"+TableKit._getc());var n=e.id;TableKit.tables[n]=TableKit.tables[n]?Object.extend(TableKit.tables[n],t||{}):Object.extend({dom:{head:null,rows:null,cells:{}},sortable:!1,resizable:!1,editable:!1},t||{})},notify:function(e,t,n){TableKit.tables[t.id]&&TableKit.tables[t.id].observers&&TableKit.tables[t.id].observers[e]&&TableKit.tables[t.id].observers[e](t,n),TableKit.options.observers[e](t,n)()},isSortable:function(e){return!!TableKit.tables[e.id]&&TableKit.tables[e.id].sortable},isResizable:function(e){return!!TableKit.tables[e.id]&&TableKit.tables[e.id].resizable},isEditable:function(e){return!!TableKit.tables[e.id]&&TableKit.tables[e.id].editable},setup:function(e){Object.extend(TableKit.options,e||{})},option:function(e,t,n,i){n=n||TableKit.options,i=i||(t&&TableKit.tables[t]?TableKit.tables[t]:{});var r=t+e;return TableKit._opcache[r]||(TableKit._opcache[r]=$A($w(e)).inject([],function(e,t){return e.push(e[t]=i[t]||n[t]),e})),TableKit._opcache[r]},e:function(e){return e||window.event},tables:{},_opcache:{},options:{autoLoad:!0,stripe:!0,sortable:!0,resizable:!0,editable:!0,rowEvenClass:"roweven",rowOddClass:"rowodd",sortableSelector:["table.sortable"],columnClass:"sortcol",descendingClass:"sortdesc",ascendingClass:"sortasc",defaultSortDirection:1,noSortClass:"nosort",sortFirstAscendingClass:"sortfirstasc",sortFirstDecendingClass:"sortfirstdesc",resizableSelector:["table.resizable"],minWidth:10,showHandle:!0,resizeOnHandleClass:"resize-handle-active",editableSelector:["table.editable"],formClassName:"editable-cell-form",noEditClass:"noedit",editAjaxURI:"/",editAjaxOptions:{},observers:{onSortStart:function(){},onSort:function(){},onSortEnd:function(){},onResizeStart:function(){},onResize:function(){},onResizeEnd:function(){},onEditStart:function(){},onEdit:function(){},onEditEnd:function(){}}},_c:0,_getc:function(){return TableKit._c+=1},unloadTable:function(e){if(e=$(e),TableKit.tables[e.id]){var t=TableKit.getHeaderCells(e),n=TableKit.option("sortable resizable editable noSortClass descendingClass ascendingClass columnClass sortFirstAscendingClass sortFirstDecendingClass",e.id);if(t.each(function(e){e=$(e),n.sortable&&(e.hasClassName(n.noSortClass)||(Event.stopObserving(e,"mousedown",TableKit.Sortable._sort),e.removeClassName(n.columnClass),e.removeClassName(n.sortFirstAscendingClass),e.removeClassName(n.sortFirstDecendingClass),e.hasClassName(n.ascendingClass)?(e.removeClassName(n.ascendingClass),e.addClassName(n.sortFirstAscendingClass)):e.hasClassName(n.descendingClass)&&(e.removeClassName(n.descendingClass),e.addClassName(n.sortFirstDecendingClass)))),n.resizable&&(Event.stopObserving(e,"mouseover",TableKit.Resizable.initDetect),Event.stopObserving(e,"mouseout",TableKit.Resizable.killDetect))}),n.editable)for(var i in Event.stopObserving(e.tBodies[0],"click",TableKit.Editable._editCell),TableKit.tables[e.id].dom.cells)if(TableKit.tables[e.id].dom.cells[i].active){var r=$(i);TableKit.Editable.getCellEditor(r).cancel(r)}TableKit.tables[e.id].dom={head:null,rows:null,cells:{}}}},reloadTable:function(e){e=$(e),TableKit.unloadTable(e);var t=TableKit.option("sortable resizable editable",e.id);t.sortable&&TableKit.Sortable.init(e),t.resizable&&TableKit.Resizable.init(e),t.editable&&TableKit.Editable.init(e)},reload:function(){for(var e in TableKit.tables)TableKit.reloadTable(e)},load:function(){TableKit.options.autoLoad&&(TableKit.options.sortable&&$A(TableKit.options.sortableSelector).each(function(e){$$(e).each(function(e){TableKit.Sortable.init(e)})}),TableKit.options.resizable&&$A(TableKit.options.resizableSelector).each(function(e){$$(e).each(function(e){TableKit.Resizable.init(e)})}),TableKit.options.editable&&$A(TableKit.options.editableSelector).each(function(e){$$(e).each(function(e){TableKit.Editable.init(e)})}))}}),TableKit.Rows={stripe:function(n){TableKit.getBodyRows(n).each(function(e,t){TableKit.Rows.addStripeClass(n,e,t)})},addStripeClass:function(e,t,n){e=e||t.up("table");for(var i=TableKit.option("rowEvenClass rowOddClass",e.id),r=(n+1)%2==0?i[0]:i[1],a=t.className.split(/\s+/),o=[],s=0,l=a.length;s<l;s+=1)a[s]!==i[0]&&a[s]!==i[1]&&o.push(a[s]);o.push(r),t.className=o.join(" ")}},TableKit.Sortable={init:function(e,t){var n=$(e);if("TABLE"===n.tagName){var i;TableKit.register(n,Object.extend(t||{},{sortable:!0}));var r=TableKit.getHeaderCells(n),a=TableKit.option("noSortClass columnClass sortFirstAscendingClass sortFirstDecendingClass",n.id);r.each(function(e){(e=$(e)).hasClassName(a.noSortClass)||(Event.observe(e,"mousedown",TableKit.Sortable._sort),e.addClassName(a.columnClass),(e.hasClassName(a.sortFirstAscendingClass)||e.hasClassName(a.sortFirstDecendingClass))&&(i=e))}),i?i.hasClassName(a.sortFirstAscendingClass)?TableKit.Sortable.sort(n,i,1):TableKit.Sortable.sort(n,i,-1):TableKit.Rows.stripe(n)}},reload:function(e){e=$(e);var t=TableKit.getHeaderCells(e),n=TableKit.option("noSortClass columnClass",e.id);t.each(function(e){(e=$(e)).hasClassName(n.noSortClass)||(Event.stopObserving(e,"mousedown",TableKit.Sortable._sort),e.removeClassName(n.columnClass))}),TableKit.Sortable.init(e)},_sort:function(e){if(!TableKit.Resizable._onHandle){e=TableKit.e(e),Event.stop(e);for(var t=Event.element(e);!t.tagName||!t.tagName.match(/td|th/gi);)t=t.parentNode;TableKit.Sortable.sort(null,t)}},sort:function(n,i,r){var e;if("number"==typeof i){if(!n||n.tagName&&"TABLE"!==n.tagName)return;n=$(n),i=Math.min(n.rows[0].cells.length,i),i=Math.max(1,i),i-=1,e=n.tHead&&0<n.tHead.rows.length?$(n.tHead.rows[n.tHead.rows.length-1].cells[i]):$(n.rows[0].cells[i])}else e=$(i),n=n?$(n):e.up("table"),i=TableKit.getCellIndex(e);var a=TableKit.option("noSortClass descendingClass ascendingClass defaultSortDirection",n.id);if(!e.hasClassName(a.noSortClass)){r=r||a.defaultSortDirection;var t=TableKit.getBodyRows(n);if(e.hasClassName(a.ascendingClass)||e.hasClassName(a.descendingClass))t.reverse(),r=e.hasClassName(a.descendingClass)?1:-1;else{var o=TableKit.Sortable.getDataType(e,i,n),s=TableKit.Sortable.types;t.sort(function(e,t){return r*s[o].compare(TableKit.getCellText(e.cells[i]),TableKit.getCellText(t.cells[i]))})}var l=n.tBodies[0],u=TableKit.Rows;t.each(function(e,t){l.appendChild(e),u.addStripeClass(n,e,t)}),$A(TableKit.getHeaderCells(null,e)).each(function(e,t){(e=$(e)).removeClassName(a.ascendingClass),e.removeClassName(a.descendingClass),i===t&&(1===r?e.addClassName(a.ascendingClass):e.addClassName(a.descendingClass))})}},types:{},detectors:[],addSortType:function(){$A(arguments).each(function(e){TableKit.Sortable.types[e.name]=e})},getDataType:function(t,e,n){t=$(t),e=e||0===e?e:TableKit.getCellIndex(t);var i=TableKit.Sortable._coltypecache,r=i[n.id]?i[n.id]:i[n.id]={};if(!r[e]){var a=!1;if(t.id&&TableKit.Sortable.types[t.id]&&(a=t.id),a||(a=$w(t.className).detect(function(e){return!!TableKit.Sortable.types[e]})),!a){var o=TableKit.getBodyRows(n);t=o[0].cells[e],a=TableKit.Sortable.detectors.detect(function(e){return TableKit.Sortable.types[e].detect(TableKit.getCellText(t))})}r[e]=a}return r[e]},_coltypecache:{}},TableKit.Sortable.detectors=$A($w("date-iso date date-eu date-au time currency datasize number casesensitivetext text")),TableKit.Sortable.Type=Class.create(),TableKit.Sortable.Type.prototype={initialize:function(e,t){this.name=e,t=Object.extend({normal:function(e){return e},pattern:/.*/},t||{}),this.normal=t.normal,this.pattern=t.pattern,t.compare&&(this.compare=t.compare),t.detect&&(this.detect=t.detect)},compare:function(e,t){return TableKit.Sortable.Type.compare(this.normal(e),this.normal(t))},detect:function(e){return this.pattern.test(e)}},TableKit.Sortable.Type.compare=function(e,t){return e<t?-1:e===t?0:1},TableKit.Sortable.addSortType(new TableKit.Sortable.Type("number",{pattern:/^[-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?/,normal:function(e){return e=parseFloat(e.replace(/^.*?([-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?).*$/,"$1")),isNaN(e)?0:e}}),new TableKit.Sortable.Type("text",{normal:function(e){return e?e.toLowerCase():""}}),new TableKit.Sortable.Type("casesensitivetext",{pattern:/^[A-Z]+$/}),new TableKit.Sortable.Type("datasize",{pattern:/^[-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?\s?[k|m|g|t]b$/i,normal:function(e){var t=e.match(/^([-+]?[\d]*\.?[\d]+([eE][-+]?[\d]+)?)\s?([k|m|g|t]?b)?/i),n=t[1]?Number(t[1]).valueOf():0,i=n;switch(t[3]?t[3].substr(0,1).toLowerCase():""){case"k":i=1024*n;break;case"m":i=1024*n*1024;break;case"g":i=1024*n*1024*1024;break;case"t":i=1024*n*1024*1024*1024}return i}}),new TableKit.Sortable.Type("date-au",{pattern:/^\d{2}\/\d{2}\/\d{4}\s?(?:\d{1,2}\:\d{2}(?:\:\d{2})?\s?[a|p]?m?)?/i,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/^(\d{2})\/(\d{2})\/(\d{4})\s?(?:(\d{1,2})\:(\d{2})(?:\:(\d{2}))?\s?([a|p]?m?))?/i),n=t[3],i=parseInt(t[2],10)-1,r=t[1],a=t[4]?t[4]:0;if(t[7]){var o=parseInt(t[4],10);-1!==t[7].toLowerCase().indexOf("p")?a=o<12?o+12:o:-1!==t[7].toLowerCase().indexOf("a")&&(a=o<12?o:0)}var s=t[5]?t[5]:0,l=t[6]?t[6]:0;return new Date(n,i,r,a,s,l,0).valueOf()}}),new TableKit.Sortable.Type("date-us",{pattern:/^\d{2}\/\d{2}\/\d{4}\s?(?:\d{1,2}\:\d{2}(?:\:\d{2})?\s?[a|p]?m?)?/i,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/^(\d{2})\/(\d{2})\/(\d{4})\s?(?:(\d{1,2})\:(\d{2})(?:\:(\d{2}))?\s?([a|p]?m?))?/i),n=t[3],i=parseInt(t[1],10)-1,r=t[2],a=t[4]?t[4]:0;if(t[7]){var o=parseInt(t[4],10);-1!==t[7].toLowerCase().indexOf("p")?a=o<12?o+12:o:-1!==t[7].toLowerCase().indexOf("a")&&(a=o<12?o:0)}var s=t[5]?t[5]:0,l=t[6]?t[6]:0;return new Date(n,i,r,a,s,l,0).valueOf()}}),new TableKit.Sortable.Type("date-eu",{pattern:/^\d{2}-\d{2}-\d{4}/i,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/^(\d{2})-(\d{2})-(\d{4})/),n=t[3],i=parseInt(t[2],10)-1,r=t[1];return new Date(n,i,r).valueOf()}}),new TableKit.Sortable.Type("date-iso",{pattern:/[\d]{4}-[\d]{2}-[\d]{2}(?:T[\d]{2}\:[\d]{2}(?:\:[\d]{2}(?:\.[\d]+)?)?(Z|([-+][\d]{2}:[\d]{2})?)?)?/,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/([\d]{4})(-([\d]{2})(-([\d]{2})(T([\d]{2}):([\d]{2})(:([\d]{2})(\.([\d]+))?)?(Z|(([-+])([\d]{2}):([\d]{2})))?)?)?)?/),n=0,i=new Date(t[1],0,1);if(t[3]&&i.setMonth(t[3]-1),t[5]&&i.setDate(t[5]),t[7]&&i.setHours(t[7]),t[8]&&i.setMinutes(t[8]),t[10]&&i.setSeconds(t[10]),t[12]&&i.setMilliseconds(1e3*Number("0."+t[12])),t[14]&&(n=60*Number(t[16])+Number(t[17]),n*="-"===t[15]?1:-1),0!==(n-=i.getTimezoneOffset())){var r=Number(i)+60*n*1e3;i.setTime(Number(r))}return i.valueOf()}}),new TableKit.Sortable.Type("date",{pattern:/^(?:sun|mon|tue|wed|thu|fri|sat)\,\s\d{1,2}\s(?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\s\d{4}(?:\s\d{2}\:\d{2}(?:\:\d{2})?(?:\sGMT(?:[+-]\d{4})?)?)?/i,compare:function(e,t){return e&&t?TableKit.Sortable.Type.compare(new Date(e),new Date(t)):TableKit.Sortable.Type.compare(e?1:0,t?1:0)}}),new TableKit.Sortable.Type("time",{pattern:/^\d{1,2}\:\d{2}(?:\:\d{2})?(?:\s[a|p]m)?$/i,compare:function(e,t){var n=new Date,i=n.getMonth()+"/"+n.getDate()+"/"+n.getFullYear()+" ";return TableKit.Sortable.Type.compare(new Date(i+e),new Date(i+t))}}),new TableKit.Sortable.Type("currency",{pattern:/^[$]/,normal:function(e){return e?parseFloat(e.replace(/[^-\d\.]/g,"")):0}})),TableKit.Resizable={init:function(e,t){var n=$(e);"TABLE"===n.tagName&&(TableKit.register(n,Object.extend(t||{},{resizable:!0})),TableKit.getHeaderCells(n).each(function(e){e=$(e),Event.observe(e,"mouseover",TableKit.Resizable.initDetect),Event.observe(e,"mouseout",TableKit.Resizable.killDetect)}))},resize:function(e,t,n){var i;if("number"==typeof t){if(!e||e.tagName&&"TABLE"!==e.tagName)return;e=$(e),t=Math.min(e.rows[0].cells.length,t),t=Math.max(1,t),t-=1,i=e.tHead&&0<e.tHead.rows.length?$(e.tHead.rows[e.tHead.rows.length-1].cells[t]):$(e.rows[0].cells[t])}else i=$(t),e=e?$(e):i.up("table"),t=TableKit.getCellIndex(i);var r=parseInt(i.getStyle("paddingLeft"),10)+parseInt(i.getStyle("paddingRight"),10);n=Math.max(n-r,TableKit.option("minWidth",e.id)[0]),i.setStyle({width:n+"px"})},initDetect:function(e){e=TableKit.e(e);var t=Event.element(e);Event.observe(t,"mousemove",TableKit.Resizable.detectHandle),Event.observe(t,"mousedown",TableKit.Resizable.startResize)},detectHandle:function(e){e=TableKit.e(e);var t=Event.element(e);TableKit.Resizable.pointerPos(t,Event.pointerX(e),Event.pointerY(e))?(t.addClassName(TableKit.option("resizeOnHandleClass",t.up("table").id)[0]),TableKit.Resizable._onHandle=!0):(t.removeClassName(TableKit.option("resizeOnHandleClass",t.up("table").id)[0]),TableKit.Resizable._onHandle=!1)},killDetect:function(e){e=TableKit.e(e),TableKit.Resizable._onHandle=!1;var t=Event.element(e);Event.stopObserving(t,"mousemove",TableKit.Resizable.detectHandle),Event.stopObserving(t,"mousedown",TableKit.Resizable.startResize),t.removeClassName(TableKit.option("resizeOnHandleClass",t.up("table").id)[0])},startResize:function(e){if(e=TableKit.e(e),TableKit.Resizable._onHandle){var t=Event.element(e);Event.stopObserving(t,"mousemove",TableKit.Resizable.detectHandle),Event.stopObserving(t,"mousedown",TableKit.Resizable.startResize),Event.stopObserving(t,"mouseout",TableKit.Resizable.killDetect);var n=(TableKit.Resizable._cell=t).up("table");TableKit.Resizable._tbl=n,TableKit.option("showHandle",n.id)[0]&&(TableKit.Resizable._handle=$(document.createElement("div")).addClassName("resize-handle").setStyle({top:t.cumulativeOffset()[1]+"px",left:Event.pointerX(e)+"px",height:n.getDimensions().height+"px"}),document.body.appendChild(TableKit.Resizable._handle)),Event.observe(document,"mousemove",TableKit.Resizable.drag),Event.observe(document,"mouseup",TableKit.Resizable.endResize),Event.stop(e)}},endResize:function(e){e=TableKit.e(e);var t=TableKit.Resizable._cell;TableKit.Resizable.resize(null,t,Event.pointerX(e)-t.cumulativeOffset()[0]),Event.stopObserving(document,"mousemove",TableKit.Resizable.drag),Event.stopObserving(document,"mouseup",TableKit.Resizable.endResize),TableKit.option("showHandle",TableKit.Resizable._tbl.id)[0]&&$$("div.resize-handle").each(function(e){document.body.removeChild(e)}),Event.observe(t,"mouseout",TableKit.Resizable.killDetect),TableKit.Resizable._tbl=TableKit.Resizable._handle=TableKit.Resizable._cell=null,Event.stop(e)},drag:function(e){if(e=TableKit.e(e),null===TableKit.Resizable._handle)try{TableKit.Resizable.resize(TableKit.Resizable._tbl,TableKit.Resizable._cell,Event.pointerX(e)-TableKit.Resizable._cell.cumulativeOffset()[0])}catch(e){}else TableKit.Resizable._handle.setStyle({left:Event.pointerX(e)+"px"});return!1},pointerPos:function(e,t,n){var i=$(e).cumulativeOffset();return n>=i[1]&&n<i[1]+e.offsetHeight&&t>=i[0]+e.offsetWidth-5&&t<i[0]+e.offsetWidth},_onHandle:!1,_cell:null,_tbl:null,_handle:null},TableKit.Editable={init:function(e,t){var n=$(e);"TABLE"===n.tagName&&(TableKit.register(n,Object.extend(t||{},{editable:!0})),Event.observe(n.tBodies[0],"click",TableKit.Editable._editCell))},_editCell:function(e){e=TableKit.e(e);var t=Event.findElement(e,"td");if(!t)return!1;TableKit.Editable.editCell(null,t,null,e)},editCell:function(e,t,n,i){var r;if("number"==typeof t){if(!e||e.tagName&&"TABLE"!==e.tagName)return;e=$(e),t=Math.min(e.tBodies[0].rows.length,t),t=Math.max(1,t),t-=1,n=Math.min(e.rows[0].cells.length,n),n=Math.max(1,n),n-=1,r=$($(e.tBodies[0].rows[t]).cells[n])}else r=$(i?Event.findElement(i,"td"):t),e=e&&e.tagName&&"TABLE"!==e.tagName?$(e):r.up("table"),r.up("tr");var a=TableKit.option("noEditClass",e.id);if(!r.hasClassName(a.noEditClass)){var o=$(TableKit.getHeaderCells(e,r)[TableKit.getCellIndex(r)]);if(!o.hasClassName(a.noEditClass)){var s=TableKit.getCellData(r);if(!s.active)s.htmlContent=r.innerHTML,TableKit.Editable.getCellEditor(null,null,o).edit(r,i),s.active=!0}}},getCellEditor:function(e,t,n){n=n||$(TableKit.getHeaderCells(t,e)[TableKit.getCellIndex(e)]);var i=TableKit.Editable.types["text-input"];if(n.id&&TableKit.Editable.types[n.id])i=TableKit.Editable.types[n.id];else{var r=$w(n.className).detect(function(e){return!!TableKit.Editable.types[e]});i=r?TableKit.Editable.types[r]:i}return i},types:{},addCellEditor:function(e){e&&e.name&&(TableKit.Editable.types[e.name]=e)}},TableKit.Editable.CellEditor=Class.create(),TableKit.Editable.CellEditor.prototype={initialize:function(e,t){this.name=e,this.options=Object.extend({element:"input",attributes:{name:"value",type:"text"},selectOptions:[],showSubmit:!0,submitText:"OK",showCancel:!0,cancelText:"Cancel",ajaxURI:null,ajaxOptions:null},t||{})},edit:function(e){e=$(e);var t=this.options,n=e.up("table"),i=$(document.createElement("form"));i.id=e.id+"-form",i.addClassName(TableKit.option("formClassName",n.id)[0]),i.onsubmit=this._submit.bindAsEventListener(this);var r=document.createElement(t.element);switch($H(t.attributes).each(function(e){r[e.key]=e.value}),t.element){case"input":case"textarea":r.value=TableKit.getCellText(e);break;case"select":var a=TableKit.getCellText(e);$A(t.selectOptions).each(function(e){r.options[r.options.length]=new Option(e[0],e[1]),a===e[1]&&(r.options[r.options.length-1].selected="selected")})}if(i.appendChild(r),"textarea"===t.element&&i.appendChild(document.createElement("br")),t.showSubmit){var o=document.createElement("input");o.type="submit",o.value=t.submitText,o.className="editor_ok_button",i.appendChild(o)}if(t.showCancel){var s=document.createElement("a");s.href="#",s.appendChild(document.createTextNode(t.cancelText)),s.onclick=this._cancel.bindAsEventListener(this),s.className="editor_cancel",i.appendChild(s)}e.innerHTML="",e.appendChild(i)},_submit:function(e){var t=Event.findElement(e,"td"),n=Event.findElement(e,"form");Event.stop(e),this.submit(t,n)},submit:function(t,e){var n=this.options;e=e||t.down("form");var i=$(TableKit.getHeaderCells(null,t)[TableKit.getCellIndex(t)]),r=t.up("tr"),a=t.up("table"),o="&row="+(TableKit.getRowIndex(r)+1)+"&cell="+(TableKit.getCellIndex(t)+1)+"&id="+r.id+"&field="+i.id+"&"+Form.serialize(e);this.ajax=new Ajax.Updater(t,n.ajaxURI||TableKit.option("editAjaxURI",a.id)[0],Object.extend(n.ajaxOptions||TableKit.option("editAjaxOptions",a.id)[0],{postBody:o,onComplete:function(){var e=TableKit.getCellData(t);e.active=!1,e.refresh=!0}}))},_cancel:function(e){var t=Event.findElement(e,"td");Event.stop(e),this.cancel(t)},cancel:function(e){this.ajax=null;var t=TableKit.getCellData(e);e.innerHTML=t.htmlContent,t.htmlContent="",t.active=!1},ajax:null},TableKit.Editable.textInput=function(e,t){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(e,{element:"input",attributes:Object.extend({name:"value",type:"text"},t||{})}))},TableKit.Editable.textInput("text-input"),TableKit.Editable.multiLineInput=function(e,t){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(e,{element:"textarea",attributes:Object.extend({name:"value",rows:"5",cols:"20"},t||{})}))},TableKit.Editable.multiLineInput("multi-line-input"),TableKit.Editable.selectInput=function(e,t,n){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(e,{element:"select",attributes:Object.extend({name:"value"},t||{}),selectOptions:n}))},document.observe("dom:loaded",TableKit.load),void 0===ConfigurationParser)var ConfigurationParser={};for(var key in ConfigurationParser.defaultVars={buttonClass:"configuration-parser-btn",infoBlockClass:"configuration-parser-info-block",containerClass:"configuration-parser-container"},void 0===ConfigurationParser.vars&&(ConfigurationParser.vars={}),ConfigurationParser.defaultVars)ConfigurationParser.defaultVars.hasOwnProperty(key)&&void 0===ConfigurationParser.vars[key]&&(ConfigurationParser.vars[key]=ConfigurationParser.defaultVars[key]);ConfigurationParser._uniqid=function(e,t){return void 0===t&&(t=0),$(e)?$(e+"_"+(t+1))?ConfigurationParser._uniqid(e,t+1):e+"_"+(t+1):e},ConfigurationParser.incrustationInfo=function(e,u){$$(e).each(function(e){var t,n,i,r,a,o,s=e.innerHTML.trim(),l=[];if(void 0!==u[s])r=u[s].comment;else if(s.indexOf("."))for(a=s.split("."),o=0;o<a.length-1;o++)l.push(a[o]),void 0!==u[l.join(".")]&&(r=u[l.join(".")].comment);r&&(i=ConfigurationParser._uniqid("info-"+s.replace(/\./g,"-")),e.addClassName(ConfigurationParser.vars.containerClass),(t=new Element("div",{class:ConfigurationParser.vars.buttonClass,for:i})).observe("click",function(e){var t=$(e.target.getAttribute("for"));console.log($(t)),$(e.target.getAttribute("for")).toggle(),e.target.toggleClassName("active")}),(n=new Element("div",{class:ConfigurationParser.vars.infoBlockClass,id:i})).insert(r).hide(),e.innerHTML="",e.insert(t).insert(s).insert(n))})};