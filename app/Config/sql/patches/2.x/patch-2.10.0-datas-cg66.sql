SET client_encoding = 'UTF8';
SET standard_conforming_strings = off;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET escape_string_warning = off;
SET search_path = public, pg_catalog;
SET default_tablespace = '';
SET default_with_oids = false;

-- *****************************************************************************
BEGIN;
-- *****************************************************************************

INSERT INTO requestgroups (name, actif) VALUES ('Moteurs de recherche', 1);

-- REQUETES DE MOTEUR DE RECHERCHE --

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Dossier', 1, 1, 'Dossier', '{"fields":{"0":"Dossier.id","Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" || '' '' || COALESCE( \"Personne\".\"prenom2\", '''' ) || '' '' || COALESCE( \"Personne\".\"prenom3\", '''' ) ) AS  \"Personne__nom_complet_prenoms\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" || '' '' || COALESCE( \"Personne\".\"prenom2\", '''' ) || '' '' || COALESCE( \"Personne\".\"prenom3\", '''' ) ) AS  \"Personne__nom_complet_prenoms\"","Prestation.rolepers":"Prestation.rolepers","Adresse.numcom":"Adresse.numcom","COALESCE( \"Adresse\".\"numvoie\", '''' ) || '' '' || COALESCE( \"Adresse\".\"libtypevoie\", '''' ) || '' '' || COALESCE( \"Adresse\".\"nomvoie\", '''' ) || E''\\n'' || COALESCE( \"Adresse\".\"codepos\", '''' ) || '' '' || COALESCE( \"Adresse\".\"nomcom\", '''' ) AS  \"Adresse__complete\"":"COALESCE( \"Adresse\".\"numvoie\", '''' ) || '' '' || COALESCE( \"Adresse\".\"libtypevoie\", '''' ) || '' '' || COALESCE( \"Adresse\".\"nomvoie\", '''' ) || E''\\n'' || COALESCE( \"Adresse\".\"codepos\", '''' ) || '' '' || COALESCE( \"Adresse\".\"nomcom\", '''' ) AS  \"Adresse__complete\"","Dossier.numdemrsa":"Dossier.numdemrsa","Dossier.dtdemrsa":"Dossier.dtdemrsa","Dossier.matricule":"Dossier.matricule","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc"},"conditions":{"OR":{"Prestation.rolepers":["DEM","CJT"],"0":"Prestation.id IS NULL"},"0":"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )","1":[]},"joins":[{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"LEFT OUTER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"dsps\"","alias":"Dsp","type":"LEFT OUTER","conditions":"\"Dsp\".\"personne_id\" = \"Personne\".\"id\" AND \"Dsp\".\"id\" IN ( SELECT \"dsps\".\"id\" AS dsps__id FROM dsps AS dsps   WHERE \"dsps\".\"personne_id\" = \"Personne\".\"id\"   ORDER BY \"dsps\".\"id\" DESC  LIMIT 1 )"},{"table":"\"dsps_revs\"","alias":"DspRev","type":"LEFT OUTER","conditions":"\"DspRev\".\"personne_id\" = \"Personne\".\"id\" AND \"DspRev\".\"id\" IN ( SELECT \"tmp_dsps_revs\".\"id\" AS tmp_dsps_revs__id FROM dsps_revs AS tmp_dsps_revs   WHERE \"tmp_dsps_revs\".\"personne_id\" = \"Personne\".\"id\"   ORDER BY \"tmp_dsps_revs\".\"modified\" DESC  LIMIT 1 )"},{"table":"\"orientsstructs\"","alias":"Orientstruct","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"personne_id\" = \"Personne\".\"id\" AND \"Orientstruct\".\"statut_orient\" = ''Orienté'' AND \"Orientstruct\".\"id\" IN ( SELECT \"orientsstructs\".\"id\" AS orientsstructs__id FROM orientsstructs AS orientsstructs   WHERE \"orientsstructs\".\"personne_id\" = \"Personne\".\"id\" AND \"orientsstructs\".\"statut_orient\" = ''Orienté'' AND \"orientsstructs\".\"date_valid\" IS NOT NULL   ORDER BY \"orientsstructs\".\"date_valid\" DESC  LIMIT 1 )"},{"table":"\"structuresreferentes\"","alias":"Structurereferente","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"structurereferente_id\" = \"Structurereferente\".\"id\""},{"table":"\"typesorients\"","alias":"Typeorient","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"typeorient_id\" = \"Typeorient\".\"id\""}],"recursive":-1,"contain":false,"order":[["Personne.nom"]]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Orientation', 1, 1, 'Orientstruct', '{"fields":{"Personne.nomcomnai":"Personne.nomcomnai","Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Calculdroitrsa.toppersdrodevorsa":"Calculdroitrsa.toppersdrodevorsa","Prestation.rolepers":"Prestation.rolepers","Adresse.numcom":"Adresse.numcom","Adresse.nomcom":"Adresse.nomcom","Dossier.numdemrsa":"Dossier.numdemrsa","Dossier.dtdemrsa":"Dossier.dtdemrsa","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Orientstruct.date_valid":"Orientstruct.date_valid","Orientstruct.statut_orient":"Orientstruct.statut_orient","Typeorient.lib_type_orient":"Typeorient.lib_type_orient","Structurereferente.lib_struc":"Structurereferente.lib_struc","Historiqueetatpe.identifiantpe":"Historiqueetatpe.identifiantpe","Modecontact.numtel":"Modecontact.numtel","0":"Orientstruct.id","1":"Orientstruct.personne_id","2":"Orientstruct.date_propo"},"conditions":[{"OR":["Informationpe.id IS NULL","Informationpe.id IN ( SELECT \"derniereinformationspe\".\"i__id\" FROM ( SELECT \"i\".\"id\" AS \"i__id\", \"h\".\"date\" AS \"h__date\" FROM \"informationspe\" AS \"i\" INNER JOIN \"public\".\"historiqueetatspe\" AS \"h\" ON (\"h\".\"informationpe_id\" = \"i\".\"id\")  WHERE ((((\"i\".\"nir\" IS NOT NULL)  AND  (\"Personne\".\"nir\" IS NOT NULL)  AND  (TRIM( BOTH '' '' FROM \"i\".\"nir\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"Personne\".\"nir\" ) <> '''')  AND  (SUBSTRING( \"i\".\"nir\" FROM 1 FOR 13 ) = SUBSTRING( \"Personne\".\"nir\" FROM 1 FOR 13 ))  AND  (\"i\".\"dtnai\" = \"Personne\".\"dtnai\"))) OR (((\"i\".\"nom\" IS NOT NULL)  AND  (\"Personne\".\"nom\" IS NOT NULL)  AND  (\"i\".\"prenom\" IS NOT NULL)  AND  (\"Personne\".\"prenom\" IS NOT NULL)  AND  (TRIM( BOTH '' '' FROM \"i\".\"nom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"i\".\"prenom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"Personne\".\"nom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"Personne\".\"prenom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"i\".\"nom\" ) = \"Personne\".\"nom\")  AND  (TRIM( BOTH '' '' FROM \"i\".\"prenom\" ) = \"Personne\".\"prenom\")  AND  (\"i\".\"dtnai\" = \"Personne\".\"dtnai\")))) AND \"h\".\"id\" IN ( SELECT \"dernierhistoriqueetatspe\".\"id\" AS dernierhistoriqueetatspe__id FROM historiqueetatspe AS dernierhistoriqueetatspe   WHERE \"dernierhistoriqueetatspe\".\"informationpe_id\" = \"i\".\"id\"   ORDER BY \"dernierhistoriqueetatspe\".\"date\" DESC, \"dernierhistoriqueetatspe\".\"id\" DESC  LIMIT 1 )    ) AS \"derniereinformationspe\" ORDER BY \"derniereinformationspe\".\"h__date\" DESC LIMIT 1 )"]},[]],"joins":[{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Orientstruct\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"INNER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"LEFT OUTER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"typesorients\"","alias":"Typeorient","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"typeorient_id\" = \"Typeorient\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferente","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"structurereferente_id\" = \"Structurereferente\".\"id\""},{"table":"informationspe","alias":"Informationpe","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[["Informationpe.nir IS NOT NULL","SUBSTRING( Informationpe.nir FROM 1 FOR 13 ) = SUBSTRING( TRIM( BOTH '' '' FROM Personne.nir ) FROM 1 FOR 13 )","Informationpe.dtnai = Personne.dtnai"],{"0":"Personne.nom IS NOT NULL","1":"Personne.prenom IS NOT NULL","2":"Personne.dtnai IS NOT NULL","TRIM( BOTH '' '' FROM Personne.nom ) <>":"","TRIM( BOTH '' '' FROM Personne.prenom ) <>":"","3":"TRIM( BOTH '' '' FROM Informationpe.nom ) = TRIM( BOTH '' '' FROM Personne.nom )","4":"TRIM( BOTH '' '' FROM Informationpe.prenom ) = TRIM( BOTH '' '' FROM Personne.prenom )","5":"Informationpe.dtnai = Personne.dtnai"}]}},{"table":"historiqueetatspe","alias":"Historiqueetatpe","type":"LEFT OUTER","foreignKey":false,"conditions":["Historiqueetatpe.informationpe_id = Informationpe.id","Historiqueetatpe.id IN ( SELECT historiqueetatspe.id FROM historiqueetatspe WHERE historiqueetatspe.informationpe_id = Informationpe.id ORDER BY historiqueetatspe.date DESC,  historiqueetatspe.id DESC LIMIT 1 )"]},{"table":"\"modescontact\"","alias":"Modecontact","type":"LEFT OUTER","conditions":"\"Modecontact\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Modecontact\".\"id\" IN ( SELECT \"modescontact\".\"id\" AS modescontact__id FROM modescontact AS modescontact   WHERE \"modescontact\".\"foyer_id\" = \"Foyer\".\"id\"   ORDER BY \"modescontact\".\"id\" DESC  LIMIT 1 )"},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[""]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par APRE', 1, 1, 'Apre', '{"fields":{"Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Adresse.numcom":"Adresse.numcom","Adresse.nomcom":"Adresse.nomcom","Dossier.numdemrsa":"Dossier.numdemrsa","Dossier.matricule":"Dossier.matricule","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Apre.numeroapre":"Apre.numeroapre","Apre.activitebeneficiaire":"Apre.activitebeneficiaire","Apre.etatdossierapre":"Apre.etatdossierapre","Apre.isdecision":"Apre.isdecision","Structurereferente.lib_struc":"Structurereferente.lib_struc","( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"":"( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"","0":"Apre.id","1":"Apre.personne_id","2":"Apre.datedemandeapre","Aideapre66.datedemande":"Aideapre66.datedemande","Aideapre66.decisionapre":"Aideapre66.decisionapre"},"conditions":{"OR":{"Prestation.rolepers":["DEM","CJT"],"0":"Prestation.id IS NULL"},"0":"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )","1":[]},"joins":[{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Apre\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"INNER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"LEFT OUTER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferente","type":"LEFT OUTER","conditions":"\"Apre\".\"structurereferente_id\" = \"Structurereferente\".\"id\""},{"table":"\"referents\"","alias":"Referent","type":"LEFT OUTER","conditions":"\"Apre\".\"referent_id\" = \"Referent\".\"id\""},{"table":"\"aidesapres66\"","alias":"Aideapre66","type":"LEFT OUTER","conditions":"\"Aideapre66\".\"apre_id\" = \"Apre\".\"id\""},{"table":"\"themesapres66\"","alias":"Themeapre66","type":"LEFT OUTER","conditions":"\"Aideapre66\".\"themeapre66_id\" = \"Themeapre66\".\"id\""},{"table":"\"typesaidesapres66\"","alias":"Typeaideapre66","type":"LEFT OUTER","conditions":"\"Typeaideapre66\".\"themeapre66_id\" = \"Themeapre66\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[""]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par CER', 1, 1, 'Contratinsertion', '{"fields":{"Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Prestation.rolepers":"Prestation.rolepers","Adresse.numcom":"Adresse.numcom","Adresse.nomcom":"Adresse.nomcom","Dossier.matricule":"Dossier.matricule","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Contratinsertion.df_ci":"Contratinsertion.df_ci","Contratinsertion.rg_ci":"Contratinsertion.rg_ci","Contratinsertion.decision_ci":"Contratinsertion.decision_ci","Contratinsertion.datevalidation_ci":"Contratinsertion.datevalidation_ci","Contratinsertion.forme_ci":"Contratinsertion.forme_ci","Contratinsertion.positioncer":"Contratinsertion.positioncer","Contratinsertion.created":"Contratinsertion.created","( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"":"( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"","0":"Contratinsertion.id","1":"Contratinsertion.personne_id","2":"Contratinsertion.dd_ci"},"conditions":["Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )",[]],"joins":[{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Contratinsertion\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"LEFT OUTER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferente","type":"LEFT OUTER","conditions":"\"Contratinsertion\".\"structurereferente_id\" = \"Structurereferente\".\"id\""},{"table":"\"referents\"","alias":"Referent","type":"LEFT OUTER","conditions":"\"Contratinsertion\".\"referent_id\" = \"Referent\".\"id\""},{"table":"\"orientsstructs\"","alias":"Orientstruct","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"personne_id\" = \"Personne\".\"id\" AND \"Orientstruct\".\"id\" IN ( SELECT \"orientsstructs\".\"id\" AS orientsstructs__id FROM orientsstructs AS orientsstructs   WHERE \"orientsstructs\".\"personne_id\" = \"Personne\".\"id\" AND \"orientsstructs\".\"statut_orient\" = ''Orienté'' AND \"orientsstructs\".\"date_valid\" IS NOT NULL   ORDER BY \"orientsstructs\".\"date_valid\" DESC  LIMIT 1 )"},{"table":"\"typesorients\"","alias":"Typeorient","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"typeorient_id\" = \"Typeorient\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[["Contratinsertion.df_ci"]]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Contrat Unique d''Insertion', 1, 1, 'Cui', '{"fields":{"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Adresse.nomcom":"Adresse.nomcom","Dossier.matricule":"Dossier.matricule","Cui.effetpriseencharge":"Cui.effetpriseencharge","Cui.finpriseencharge":"Cui.finpriseencharge","Emailcui.textmailcui66_id":"Emailcui.textmailcui66_id","Emailcui.dateenvoi":"Emailcui.dateenvoi","Partenairecui.raisonsociale":"Partenairecui.raisonsociale","0":"Cui.id","1":"Cui.personne_id","2":"Cui.faitle","Cui66.etatdossiercui66":"Cui66.etatdossiercui66","Decisioncui66.decision":"Decisioncui66.decision","Decisioncui66.datedecision":"Decisioncui66.datedecision","Historiquepositioncui66.created":"Historiquepositioncui66.created"},"conditions":["Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )",[]],"joins":[{"table":"\"entreesromesv3\"","alias":"Entreeromev3","type":"LEFT OUTER","conditions":"\"Cui\".\"entreeromev3_id\" = \"Entreeromev3\".\"id\""},{"table":"\"partenairescuis\"","alias":"Partenairecui","type":"LEFT OUTER","conditions":"\"Cui\".\"partenairecui_id\" = \"Partenairecui\".\"id\""},{"table":"\"emailscuis\"","alias":"Emailcui","type":"LEFT OUTER","conditions":"\"Emailcui\".\"cui_id\" = \"Cui\".\"id\" AND \"Emailcui\".\"id\" IN ( SELECT \"emailscuis\".\"id\" AS emailscuis__id FROM emailscuis AS emailscuis   WHERE \"emailscuis\".\"cui_id\" = \"Cui\".\"id\" AND \"emailscuis\".\"dateenvoi\" IS NOT NULL   ORDER BY \"emailscuis\".\"dateenvoi\" DESC  LIMIT 1 )"},{"table":"\"adressescuis\"","alias":"Adressecui","type":"LEFT OUTER","conditions":"\"Partenairecui\".\"adressecui_id\" = \"Adressecui\".\"id\""},{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Cui\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"LEFT OUTER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"INNER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA'' AND \"Prestation\".\"rolepers\" IN (''DEM'', ''CJT'')"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"cuis66\"","alias":"Cui66","type":"INNER","conditions":"\"Cui66\".\"cui_id\" = \"Cui\".\"id\""},{"table":"\"accompagnementscuis66\"","alias":"Accompagnementcui66","type":"LEFT OUTER","conditions":"\"Accompagnementcui66\".\"cui66_id\" = \"Cui66\".\"id\" AND \"Accompagnementcui66\".\"id\" IN ( SELECT \"accompagnementscuis66\".\"id\" AS accompagnementscuis66__id FROM accompagnementscuis66 AS accompagnementscuis66   WHERE \"accompagnementscuis66\".\"cui66_id\" = \"Cui66\".\"id\"   ORDER BY \"accompagnementscuis66\".\"created\" DESC  LIMIT 1 )"},{"table":"\"decisionscuis66\"","alias":"Decisioncui66","type":"LEFT OUTER","conditions":"\"Decisioncui66\".\"cui66_id\" = \"Cui66\".\"id\" AND \"Decisioncui66\".\"id\" IN ( SELECT \"decisionscuis66\".\"id\" AS decisionscuis66__id FROM decisionscuis66 AS decisionscuis66   WHERE \"decisionscuis66\".\"cui66_id\" = \"Cui66\".\"id\"   ORDER BY \"decisionscuis66\".\"created\" DESC  LIMIT 1 )"},{"table":"\"propositionscuis66\"","alias":"Propositioncui66","type":"LEFT OUTER","conditions":"\"Propositioncui66\".\"cui66_id\" = \"Cui66\".\"id\" AND \"Propositioncui66\".\"id\" IN ( SELECT \"propositionscuis66\".\"id\" AS propositionscuis66__id FROM propositionscuis66 AS propositionscuis66   WHERE \"propositionscuis66\".\"cui66_id\" = \"Cui66\".\"id\"   ORDER BY \"propositionscuis66\".\"created\" DESC  LIMIT 1 )"},{"table":"\"rupturescuis66\"","alias":"Rupturecui66","type":"LEFT OUTER","conditions":"\"Rupturecui66\".\"cui66_id\" = \"Cui66\".\"id\" AND \"Rupturecui66\".\"id\" IN ( SELECT \"rupturescuis66\".\"id\" AS rupturescuis66__id FROM rupturescuis66 AS rupturescuis66   WHERE \"rupturescuis66\".\"cui66_id\" = \"Cui66\".\"id\"   ORDER BY \"rupturescuis66\".\"created\" DESC  LIMIT 1 )"},{"table":"\"suspensionscuis66\"","alias":"Suspensioncui66","type":"LEFT OUTER","conditions":"\"Suspensioncui66\".\"cui66_id\" = \"Cui66\".\"id\" AND \"Suspensioncui66\".\"id\" IN ( SELECT \"suspensionscuis66\".\"id\" AS suspensionscuis66__id FROM suspensionscuis66 AS suspensionscuis66   WHERE \"suspensionscuis66\".\"cui66_id\" = \"Cui66\".\"id\"   ORDER BY \"suspensionscuis66\".\"created\" DESC  LIMIT 1 )"},{"table":"\"historiquepositionscuis66\"","alias":"Historiquepositioncui66","type":"LEFT OUTER","conditions":"\"Historiquepositioncui66\".\"cui66_id\" = \"Cui66\".\"id\" AND \"Historiquepositioncui66\".\"id\" IN ( SELECT \"historiquepositionscuis66\".\"id\" AS historiquepositionscuis66__id FROM historiquepositionscuis66 AS historiquepositionscuis66   WHERE \"historiquepositionscuis66\".\"cui66_id\" = \"Cui66\".\"id\"   ORDER BY \"historiquepositionscuis66\".\"created\" DESC  LIMIT 1 )"},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[["Personne.nom","Personne.prenom","Cui.id"]]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Entretien', 1, 1, 'Entretien', '{"fields":{"0":"Dossier.id","1":"Entretien.id","2":"Personne.id","3":"Entretien.personne_id","Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Adresse.codepos":"Adresse.codepos","Adresse.numcom":"Adresse.numcom","Adresse.nomcom":"Adresse.nomcom","Dossier.matricule":"Dossier.matricule","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Entretien.dateentretien":"Entretien.dateentretien","Entretien.typeentretien":"Entretien.typeentretien","Entretien.arevoirle":"Entretien.arevoirle","Objetentretien.name":"Objetentretien.name","( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"":"( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"","Structurereferente.lib_struc":"Structurereferente.lib_struc"},"conditions":["Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )",[]],"joins":[{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Entretien\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"LEFT OUTER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"INNER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA'' AND \"Prestation\".\"rolepers\" IN (''DEM'', ''CJT'')"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"objetsentretien\"","alias":"Objetentretien","type":"INNER","conditions":"\"Entretien\".\"objetentretien_id\" = \"Objetentretien\".\"id\""},{"table":"\"referents\"","alias":"Referent","type":"INNER","conditions":"\"Entretien\".\"referent_id\" = \"Referent\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferente","type":"INNER","conditions":"\"Entretien\".\"structurereferente_id\" = \"Structurereferente\".\"id\""},{"table":"\"typesrdv\"","alias":"Typerdv","type":"LEFT OUTER","conditions":"\"Entretien\".\"typerdv_id\" = \"Typerdv\".\"id\""},{"table":"\"actionscandidats\"","alias":"Actioncandidat","type":"LEFT OUTER","conditions":"\"Entretien\".\"actioncandidat_id\" = \"Actioncandidat\".\"id\""}],"recursive":-1,"contain":false,"order":[""]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Fiches de candidature', 1, 1, 'ActioncandidatPersonne', '{"fields":{"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Adresse.numcom":"Adresse.numcom","Adresse.nomcom":"Adresse.nomcom","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","ActioncandidatPersonne.datesignature":"ActioncandidatPersonne.datesignature","ActioncandidatPersonne.positionfiche":"ActioncandidatPersonne.positionfiche","( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"":"( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"","Actioncandidat.name":"Actioncandidat.name","Partenaire.libstruc":"Partenaire.libstruc","0":"ActioncandidatPersonne.id","1":"ActioncandidatPersonne.personne_id","2":"ActioncandidatPersonne.datebilan"},"conditions":{"OR":{"Prestation.rolepers":["DEM","CJT"],"0":"Prestation.id IS NULL"},"0":"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )","1":[]},"joins":[{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"ActioncandidatPersonne\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"LEFT OUTER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"INNER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"INNER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"referents\"","alias":"Referent","type":"INNER","conditions":"\"ActioncandidatPersonne\".\"referent_id\" = \"Referent\".\"id\""},{"table":"\"actionscandidats\"","alias":"Actioncandidat","type":"INNER","conditions":"\"ActioncandidatPersonne\".\"actioncandidat_id\" = \"Actioncandidat\".\"id\""},{"table":"\"contactspartenaires\"","alias":"Contactpartenaire","type":"INNER","conditions":"\"Actioncandidat\".\"contactpartenaire_id\" = \"Contactpartenaire\".\"id\""},{"table":"\"partenaires\"","alias":"Partenaire","type":"LEFT OUTER","conditions":"\"Contactpartenaire\".\"partenaire_id\" = \"Partenaire\".\"id\""},{"table":"\"progsfichescandidatures66\"","alias":"Progfichecandidature66","type":"LEFT OUTER","conditions":"\"ActioncandidatPersonne\".\"progfichecandidature66_id\" = \"Progfichecandidature66\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[["ActioncandidatPersonne.datesignature"]]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Indus', 1, 1, 'Dossier', '{"fields":{"Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Prestation.rolepers":"Prestation.rolepers","Adresse.codepos":"Adresse.codepos","Adresse.numcom":"Adresse.numcom","Dossier.numdemrsa":"Dossier.numdemrsa","Dossier.matricule":"Dossier.matricule","Dossier.typeparte":"Dossier.typeparte","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","0":"Dossier.id","1":"Personne.nom","2":"Personne.prenom","Indu.moismoucompta":"COALESCE(\"IndusConstates\".\"moismoucompta\",\"IndusTransferesCG\".\"moismoucompta\",\"RemisesIndus\".\"moismoucompta\") AS \"Indu__moismoucompta\"","IndusConstates.mtmoucompta":"IndusConstates.mtmoucompta","IndusTransferesCG.mtmoucompta":"IndusTransferesCG.mtmoucompta","RemisesIndus.mtmoucompta":"RemisesIndus.mtmoucompta"},"conditions":["Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )",{"Prestation.rolepers":"DEM","0":{"OR":["IndusConstates.type_allocation IS NOT NULL","IndusTransferesCG.type_allocation IS NOT NULL","RemisesIndus.type_allocation IS NOT NULL"]},"1":{"OR":[{"OR":["IndusConstates.moismoucompta = IndusTransferesCG.moismoucompta","IndusConstates.moismoucompta IS NULL","IndusTransferesCG.moismoucompta IS NULL"]},{"OR":["IndusConstates.moismoucompta = RemisesIndus.moismoucompta","IndusConstates.moismoucompta IS NULL","RemisesIndus.moismoucompta IS NULL"]},{"OR":["IndusTransferesCG.moismoucompta = RemisesIndus.moismoucompta","IndusTransferesCG.moismoucompta IS NULL","RemisesIndus.moismoucompta IS NULL"]}]}},[]],"joins":[{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"INNER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"INNER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA'' AND \"Prestation\".\"rolepers\" IN (''DEM'', ''CJT'')"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"detailscalculsdroitsrsa\"","alias":"Detailcalculdroitrsa","type":"LEFT OUTER","conditions":"\"Detailcalculdroitrsa\".\"detaildroitrsa_id\" = \"Detaildroitrsa\".\"id\""},{"table":"\"infosfinancieres\"","alias":"IndusConstates","type":"LEFT OUTER","conditions":"\"IndusConstates\".\"dossier_id\" = \"Dossier\".\"id\" AND \"IndusConstates\".\"type_allocation\" = ''IndusConstates''"},{"table":"\"infosfinancieres\"","alias":"IndusTransferesCG","type":"LEFT OUTER","conditions":"\"IndusTransferesCG\".\"dossier_id\" = \"Dossier\".\"id\" AND \"IndusConstates\".\"type_allocation\" = ''IndusTransferesCG''"},{"table":"\"infosfinancieres\"","alias":"RemisesIndus","type":"LEFT OUTER","conditions":"\"RemisesIndus\".\"dossier_id\" = \"Dossier\".\"id\" AND \"IndusConstates\".\"type_allocation\" = ''RemisesIndus''"},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[""]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par DSPs', 1, 1, 'Personne', '{"fields":{"0":"Dsp.id","1":"DspRev.id","2":"Personne.id","3":"Dossier.numdemrsa","Personne.nom":"Personne.nom","Personne.prenom":"Personne.prenom","Personne.dtnai":"Personne.dtnai","Personne.numfixe":"Personne.numfixe","Personne.numport":"Personne.numport","Calculdroitrsa.toppersdrodevorsa":"Calculdroitrsa.toppersdrodevorsa","Foyer.sitfam":"Foyer.sitfam","Adresse.nomcom":"Adresse.nomcom","Dossier.matricule":"Dossier.matricule","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Donnees.nivetu":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Dsp\".\"nivetu\" ELSE \"DspRev\".\"nivetu\" END ) AS \"Donnees__nivetu\"","Donnees.nivdipmaxobt":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Dsp\".\"nivdipmaxobt\" ELSE \"DspRev\".\"nivdipmaxobt\" END ) AS \"Donnees__nivdipmaxobt\"","Donnees.libautrqualipro":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Dsp\".\"libautrqualipro\" ELSE \"DspRev\".\"libautrqualipro\" END ) AS \"Donnees__libautrqualipro\"","Donnees.topengdemarechemploi":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Dsp\".\"topengdemarechemploi\" ELSE \"DspRev\".\"topengdemarechemploi\" END ) AS \"Donnees__topengdemarechemploi\"","Donnees.topmoyloco":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Dsp\".\"topmoyloco\" ELSE \"DspRev\".\"topmoyloco\" END ) AS \"Donnees__topmoyloco\"","Donnees.toppermicondub":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Dsp\".\"toppermicondub\" ELSE \"DspRev\".\"toppermicondub\" END ) AS \"Donnees__toppermicondub\"","Foyer.nbenfants":"( SELECT COUNT(\"prestations\".\"id\") FROM \"prestations\" AS \"prestations\" INNER JOIN \"public\".\"personnes\" AS \"personnes\" ON (\"prestations\".\"personne_id\" = \"personnes\".\"id\")  WHERE \"personnes\".\"foyer_id\" = \"Foyer\".\"id\" AND \"prestations\".\"natprest\" = ''RSA'' AND \"prestations\".\"rolepers\" = ''ENF''    ) AS \"Foyer__nbenfants\"","Donnees.nb_fichiers_lies":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN ( SELECT COUNT(\"fichiermodule\".\"id\") FROM \"fichiersmodules\" AS \"fichiermodule\"   WHERE \"fichiermodule\".\"modele\" = ''Dsp'' AND \"fichiermodule\".\"fk_value\" = \"Dsp\".\"id\"    ) ELSE ( SELECT COUNT(\"fichiermodule\".\"id\") FROM \"fichiersmodules\" AS \"fichiermodule\"   WHERE \"fichiermodule\".\"modele\" = ''Dsp'' AND \"fichiermodule\".\"fk_value\" = \"DspRev\".\"id\"    ) END ) AS \"Donnees__nb_fichiers_lies\"","Libderact66Metier.name":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Libderact66Metier\".\"name\" ELSE \"Libderact66MetierRev\".\"name\" END ) AS \"Libderact66Metier__name\"","Libsecactrech66Secteur.name":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Libsecactrech66Secteur\".\"name\" ELSE \"Libsecactrech66SecteurRev\".\"name\" END ) AS \"Libsecactrech66Secteur__name\"","Libemploirech66Metier.name":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Libemploirech66Metier\".\"name\" ELSE \"Libemploirech66MetierRev\".\"name\" END ) AS \"Libemploirech66Metier__name\"","Deractromev3.appellationromev3":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Deractromev3__Appellationromev3\".\"name\" ELSE \"Deractromev3Rev__Appellationromev3\".\"name\" END ) AS \"Deractromev3__appellationromev3__name\"","Actrechromev3.familleromev3":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Actrechromev3__Familleromev3\".\"name\" ELSE \"Actrechromev3Rev__Familleromev3\".\"name\" END ) AS \"Actrechromev3__familleromev3__name\"","Actrechromev3.domaineromev3":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Actrechromev3__Domaineromev3\".\"name\" ELSE \"Actrechromev3Rev__Domaineromev3\".\"name\" END ) AS \"Actrechromev3__domaineromev3__name\"","Actrechromev3.metierromev3":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Actrechromev3__Metierromev3\".\"name\" ELSE \"Actrechromev3Rev__Metierromev3\".\"name\" END ) AS \"Actrechromev3__metierromev3__name\"","Actrechromev3.appellationromev3":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN \"Actrechromev3__Appellationromev3\".\"name\" ELSE \"Actrechromev3Rev__Appellationromev3\".\"name\" END ) AS \"Actrechromev3__appellationromev3__name\"","Donnees.difdisp":"( CASE WHEN \"Dsp\".\"id\" IS NOT NULL THEN TRIM( BOTH ''\n\r'' FROM TRIM( TRAILING '''' FROM ARRAY_TO_STRING( ARRAY( SELECT ''\\n\\r-'' || \"Detaildifdisp\".\"difdisp\" || '''' AS \"Detaildifdisp__difdisp\" FROM \"detailsdifdisps\" AS \"Detaildifdisp\"   WHERE \"Detaildifdisp\".\"dsp_id\" = \"Dsp\".\"id\"    ), '''' ) ) ) ELSE TRIM( BOTH ''\n\r'' FROM TRIM( TRAILING '''' FROM ARRAY_TO_STRING( ARRAY( SELECT ''\\n\\r-'' || \"DetaildifdispRev\".\"difdisp\" || '''' AS \"DetaildifdispRev__difdisp\" FROM \"detailsdifdisps_revs\" AS \"DetaildifdispRev\"   WHERE \"DetaildifdispRev\".\"dsp_rev_id\" = \"DspRev\".\"id\"    ), '''' ) ) ) END ) AS \"Donnees__difdisp\"","Canton.canton":"Canton.canton"},"conditions":[{"OR":["Dsp.id IS NOT NULL","DspRev.id IS NOT NULL"]},"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )",[]],"joins":[{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"LEFT OUTER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"INNER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA'' AND \"Prestation\".\"rolepers\" IN (''DEM'', ''CJT'')"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"dsps_revs","alias":"DspRev","type":"LEFT OUTER","foreignKey":false,"conditions":["DspRev.personne_id = Personne.id","DspRev.id IN ( SELECT \"tmp_dsps_revs\".\"id\" AS \"tmp_dsps_revs__id\" FROM \"dsps_revs\" AS \"tmp_dsps_revs\"   WHERE \"tmp_dsps_revs\".\"personne_id\" = \"Personne\".\"id\"   ORDER BY \"tmp_dsps_revs\".\"modified\" DESC  LIMIT 1 )"]},{"table":"dsps","alias":"Dsp","type":"LEFT OUTER","foreignKey":false,"conditions":["Dsp.personne_id = Personne.id","Dsp.personne_id NOT IN ( SELECT \"tmp_dsps_revs2\".\"personne_id\" AS \"tmp_dsps_revs2__personne_id\" FROM \"dsps_revs\" AS \"tmp_dsps_revs2\"   WHERE \"tmp_dsps_revs2\".\"personne_id\" = \"Dsp\".\"personne_id\"    )"]},{"table":"\"modescontact\"","alias":"Modecontact","type":"LEFT OUTER","conditions":"\"Modecontact\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Modecontact\".\"id\" IN ( SELECT \"modescontact\".\"id\" AS modescontact__id FROM modescontact AS modescontact   WHERE \"modescontact\".\"foyer_id\" = \"Foyer\".\"id\" AND \"modescontact\".\"autorutitel\" = ''A''   ORDER BY \"modescontact\".\"id\" DESC  LIMIT 1 )"},{"table":"\"codesromesecteursdsps66\"","alias":"Libsecactderact66Secteur","type":"LEFT OUTER","conditions":"\"Dsp\".\"libsecactderact66_secteur_id\" = \"Libsecactderact66Secteur\".\"id\""},{"table":"\"codesromesecteursdsps66\"","alias":"Libsecactderact66SecteurRev","type":"LEFT OUTER","conditions":"\"DspRev\".\"libsecactderact66_secteur_id\" = \"Libsecactderact66SecteurRev\".\"id\""},{"table":"\"codesromemetiersdsps66\"","alias":"Libderact66Metier","type":"LEFT OUTER","conditions":"\"Dsp\".\"libderact66_metier_id\" = \"Libderact66Metier\".\"id\""},{"table":"\"codesromemetiersdsps66\"","alias":"Libderact66MetierRev","type":"LEFT OUTER","conditions":"\"DspRev\".\"libderact66_metier_id\" = \"Libderact66MetierRev\".\"id\""},{"table":"\"codesromesecteursdsps66\"","alias":"Libsecactdomi66Secteur","type":"LEFT OUTER","conditions":"\"Dsp\".\"libsecactdomi66_secteur_id\" = \"Libsecactdomi66Secteur\".\"id\""},{"table":"\"codesromesecteursdsps66\"","alias":"Libsecactdomi66SecteurRev","type":"LEFT OUTER","conditions":"\"DspRev\".\"libsecactdomi66_secteur_id\" = \"Libsecactdomi66SecteurRev\".\"id\""},{"table":"\"codesromemetiersdsps66\"","alias":"Libactdomi66Metier","type":"LEFT OUTER","conditions":"\"Dsp\".\"libactdomi66_metier_id\" = \"Libactdomi66Metier\".\"id\""},{"table":"\"codesromemetiersdsps66\"","alias":"Libactdomi66MetierRev","type":"LEFT OUTER","conditions":"\"DspRev\".\"libactdomi66_metier_id\" = \"Libactdomi66MetierRev\".\"id\""},{"table":"\"codesromesecteursdsps66\"","alias":"Libsecactrech66Secteur","type":"LEFT OUTER","conditions":"\"Dsp\".\"libsecactrech66_secteur_id\" = \"Libsecactrech66Secteur\".\"id\""},{"table":"\"codesromesecteursdsps66\"","alias":"Libsecactrech66SecteurRev","type":"LEFT OUTER","conditions":"\"DspRev\".\"libsecactrech66_secteur_id\" = \"Libsecactrech66SecteurRev\".\"id\""},{"table":"\"codesromemetiersdsps66\"","alias":"Libemploirech66Metier","type":"LEFT OUTER","conditions":"\"Dsp\".\"libemploirech66_metier_id\" = \"Libemploirech66Metier\".\"id\""},{"table":"\"codesromemetiersdsps66\"","alias":"Libemploirech66MetierRev","type":"LEFT OUTER","conditions":"\"DspRev\".\"libemploirech66_metier_id\" = \"Libemploirech66MetierRev\".\"id\""},{"table":"\"entreesromesv3\"","alias":"Deractromev3","type":"LEFT OUTER","conditions":"\"Dsp\".\"deractromev3_id\" = \"Deractromev3\".\"id\""},{"table":"\"entreesromesv3\"","alias":"Deractromev3Rev","type":"LEFT OUTER","conditions":"\"DspRev\".\"deractromev3_id\" = \"Deractromev3Rev\".\"id\""},{"table":"\"famillesromesv3\"","alias":"Deractromev3__Familleromev3","type":"LEFT OUTER","conditions":"\"Deractromev3\".\"familleromev3_id\" = \"Deractromev3__Familleromev3\".\"id\""},{"table":"\"famillesromesv3\"","alias":"Deractromev3Rev__Familleromev3","type":"LEFT OUTER","conditions":"\"Deractromev3Rev\".\"familleromev3_id\" = \"Deractromev3Rev__Familleromev3\".\"id\""},{"table":"\"domainesromesv3\"","alias":"Deractromev3__Domaineromev3","type":"LEFT OUTER","conditions":"\"Deractromev3\".\"domaineromev3_id\" = \"Deractromev3__Domaineromev3\".\"id\""},{"table":"\"domainesromesv3\"","alias":"Deractromev3Rev__Domaineromev3","type":"LEFT OUTER","conditions":"\"Deractromev3Rev\".\"domaineromev3_id\" = \"Deractromev3Rev__Domaineromev3\".\"id\""},{"table":"\"metiersromesv3\"","alias":"Deractromev3__Metierromev3","type":"LEFT OUTER","conditions":"\"Deractromev3\".\"metierromev3_id\" = \"Deractromev3__Metierromev3\".\"id\""},{"table":"\"metiersromesv3\"","alias":"Deractromev3Rev__Metierromev3","type":"LEFT OUTER","conditions":"\"Deractromev3Rev\".\"metierromev3_id\" = \"Deractromev3Rev__Metierromev3\".\"id\""},{"table":"\"appellationsromesv3\"","alias":"Deractromev3__Appellationromev3","type":"LEFT OUTER","conditions":"\"Deractromev3\".\"appellationromev3_id\" = \"Deractromev3__Appellationromev3\".\"id\""},{"table":"\"appellationsromesv3\"","alias":"Deractromev3Rev__Appellationromev3","type":"LEFT OUTER","conditions":"\"Deractromev3Rev\".\"appellationromev3_id\" = \"Deractromev3Rev__Appellationromev3\".\"id\""},{"table":"\"entreesromesv3\"","alias":"Deractdomiromev3","type":"LEFT OUTER","conditions":"\"Dsp\".\"deractdomiromev3_id\" = \"Deractdomiromev3\".\"id\""},{"table":"\"entreesromesv3\"","alias":"Deractdomiromev3Rev","type":"LEFT OUTER","conditions":"\"DspRev\".\"deractdomiromev3_id\" = \"Deractdomiromev3Rev\".\"id\""},{"table":"\"famillesromesv3\"","alias":"Deractdomiromev3__Familleromev3","type":"LEFT OUTER","conditions":"\"Deractdomiromev3\".\"familleromev3_id\" = \"Deractdomiromev3__Familleromev3\".\"id\""},{"table":"\"famillesromesv3\"","alias":"Deractdomiromev3Rev__Familleromev3","type":"LEFT OUTER","conditions":"\"Deractdomiromev3Rev\".\"familleromev3_id\" = \"Deractdomiromev3Rev__Familleromev3\".\"id\""},{"table":"\"domainesromesv3\"","alias":"Deractdomiromev3__Domaineromev3","type":"LEFT OUTER","conditions":"\"Deractdomiromev3\".\"domaineromev3_id\" = \"Deractdomiromev3__Domaineromev3\".\"id\""},{"table":"\"domainesromesv3\"","alias":"Deractdomiromev3Rev__Domaineromev3","type":"LEFT OUTER","conditions":"\"Deractdomiromev3Rev\".\"domaineromev3_id\" = \"Deractdomiromev3Rev__Domaineromev3\".\"id\""},{"table":"\"metiersromesv3\"","alias":"Deractdomiromev3__Metierromev3","type":"LEFT OUTER","conditions":"\"Deractdomiromev3\".\"metierromev3_id\" = \"Deractdomiromev3__Metierromev3\".\"id\""},{"table":"\"metiersromesv3\"","alias":"Deractdomiromev3Rev__Metierromev3","type":"LEFT OUTER","conditions":"\"Deractdomiromev3Rev\".\"metierromev3_id\" = \"Deractdomiromev3Rev__Metierromev3\".\"id\""},{"table":"\"appellationsromesv3\"","alias":"Deractdomiromev3__Appellationromev3","type":"LEFT OUTER","conditions":"\"Deractdomiromev3\".\"appellationromev3_id\" = \"Deractdomiromev3__Appellationromev3\".\"id\""},{"table":"\"appellationsromesv3\"","alias":"Deractdomiromev3Rev__Appellationromev3","type":"LEFT OUTER","conditions":"\"Deractdomiromev3Rev\".\"appellationromev3_id\" = \"Deractdomiromev3Rev__Appellationromev3\".\"id\""},{"table":"\"entreesromesv3\"","alias":"Actrechromev3","type":"LEFT OUTER","conditions":"\"Dsp\".\"actrechromev3_id\" = \"Actrechromev3\".\"id\""},{"table":"\"entreesromesv3\"","alias":"Actrechromev3Rev","type":"LEFT OUTER","conditions":"\"DspRev\".\"actrechromev3_id\" = \"Actrechromev3Rev\".\"id\""},{"table":"\"famillesromesv3\"","alias":"Actrechromev3__Familleromev3","type":"LEFT OUTER","conditions":"\"Actrechromev3\".\"familleromev3_id\" = \"Actrechromev3__Familleromev3\".\"id\""},{"table":"\"famillesromesv3\"","alias":"Actrechromev3Rev__Familleromev3","type":"LEFT OUTER","conditions":"\"Actrechromev3Rev\".\"familleromev3_id\" = \"Actrechromev3Rev__Familleromev3\".\"id\""},{"table":"\"domainesromesv3\"","alias":"Actrechromev3__Domaineromev3","type":"LEFT OUTER","conditions":"\"Actrechromev3\".\"domaineromev3_id\" = \"Actrechromev3__Domaineromev3\".\"id\""},{"table":"\"domainesromesv3\"","alias":"Actrechromev3Rev__Domaineromev3","type":"LEFT OUTER","conditions":"\"Actrechromev3Rev\".\"domaineromev3_id\" = \"Actrechromev3Rev__Domaineromev3\".\"id\""},{"table":"\"metiersromesv3\"","alias":"Actrechromev3__Metierromev3","type":"LEFT OUTER","conditions":"\"Actrechromev3\".\"metierromev3_id\" = \"Actrechromev3__Metierromev3\".\"id\""},{"table":"\"metiersromesv3\"","alias":"Actrechromev3Rev__Metierromev3","type":"LEFT OUTER","conditions":"\"Actrechromev3Rev\".\"metierromev3_id\" = \"Actrechromev3Rev__Metierromev3\".\"id\""},{"table":"\"appellationsromesv3\"","alias":"Actrechromev3__Appellationromev3","type":"LEFT OUTER","conditions":"\"Actrechromev3\".\"appellationromev3_id\" = \"Actrechromev3__Appellationromev3\".\"id\""},{"table":"\"appellationsromesv3\"","alias":"Actrechromev3Rev__Appellationromev3","type":"LEFT OUTER","conditions":"\"Actrechromev3Rev\".\"appellationromev3_id\" = \"Actrechromev3Rev__Appellationromev3\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[""]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Rendez-vous', 1, 1, 'Rendezvous', '{"fields":{"0":"Rendezvous.id","1":"Rendezvous.personne_id","Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Prestation.rolepers":"Prestation.rolepers","Adresse.numcom":"Adresse.numcom","Adresse.nomcom":"Adresse.nomcom","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Rendezvous.daterdv":"Rendezvous.daterdv","Rendezvous.heurerdv":"Rendezvous.heurerdv","( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"":"( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"","Statutrdv.libelle":"Statutrdv.libelle","Structurereferente.lib_struc":"Structurereferente.lib_struc","Typerdv.libelle":"Typerdv.libelle","Canton.canton":"Canton.canton"},"conditions":["Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )",[]],"joins":[{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Rendezvous\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"LEFT OUTER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"INNER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA'' AND \"Prestation\".\"rolepers\" IN (''DEM'', ''CJT'')"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"referents\"","alias":"Referent","type":"LEFT OUTER","conditions":"\"Rendezvous\".\"referent_id\" = \"Referent\".\"id\""},{"table":"\"statutsrdvs\"","alias":"Statutrdv","type":"LEFT OUTER","conditions":"\"Rendezvous\".\"statutrdv_id\" = \"Statutrdv\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferente","type":"INNER","conditions":"\"Rendezvous\".\"structurereferente_id\" = \"Structurereferente\".\"id\""},{"table":"\"typesrdv\"","alias":"Typerdv","type":"LEFT OUTER","conditions":"\"Rendezvous\".\"typerdv_id\" = \"Typerdv\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[["Rendezvous.daterdv"]]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Dossiers PCGs', 1, 1, 'Dossierpcg66', '{"fields":{"Personne.nomcomnai":"Personne.nomcomnai","Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Adresse.numcom":"Adresse.numcom","Dossier.numdemrsa":"Dossier.numdemrsa","Dossier.matricule":"Dossier.matricule","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Dossierpcg66.typepdo_id":"Dossierpcg66.typepdo_id","Dossierpcg66.datereceptionpdo":"Dossierpcg66.datereceptionpdo","Dossierpcg66.etatdossierpcg":"Dossierpcg66.etatdossierpcg","Dossierpcg66.originepdo_id":"Dossierpcg66.originepdo_id","Dossierpcg66.nbpropositions":"Dossierpcg66.nbpropositions","( \"User\".\"nom\" || '' '' || \"User\".\"prenom\" ) AS  \"User__nom_complet\"":"( \"User\".\"nom\" || '' '' || \"User\".\"prenom\" ) AS  \"User__nom_complet\"","Poledossierpcg66.name":"Poledossierpcg66.name","Decisiondossierpcg66.datetransmissionop":"Decisiondossierpcg66.datetransmissionop","Traitementpcg66.datereception":"Traitementpcg66.datereception","Decisionpdo.libelle":"Decisionpdo.libelle","0":"Dossierpcg66.id","1":"Dossierpcg66.foyer_id","Decisiondossierpcg66.org_id":"(''<ul>'' || ARRAY_TO_STRING(ARRAY(SELECT ''<li>'' || \"Orgtransmisdossierpcg66\".\"name\" || ''<\/li>'' AS \"Orgtransmisdossierpcg66__name\" FROM \"decisionsdossierspcgs66\" AS \"Decisiondossierpcg66\" LEFT JOIN \"public\".\"decsdospcgs66_orgsdospcgs66\" AS \"Decdospcg66Orgdospcg66\" ON (\"Decdospcg66Orgdospcg66\".\"decisiondossierpcg66_id\" = \"Decisiondossierpcg66\".\"id\") LEFT JOIN \"public\".\"orgstransmisdossierspcgs66\" AS \"Orgtransmisdossierpcg66\" ON (\"Decdospcg66Orgdospcg66\".\"orgtransmisdossierpcg66_id\" = \"Orgtransmisdossierpcg66\".\"id\") WHERE \"Decisiondossierpcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\" ORDER BY \"Decisiondossierpcg66\".\"created\" DESC), '''') || ''<\/ul>'') AS \"Decisiondossierpcg66__org_id\"","Traitementpcg66.situationpdo_id":"(''<ul>'' || ARRAY_TO_STRING(ARRAY(SELECT ''<li>'' || \"Situationpdo\".\"libelle\" || ''<\/li>'' AS \"Situationpdo__libelle\" FROM \"personnespcgs66\" AS \"Personnepcg66\" LEFT OUTER JOIN \"public\".\"personnespcgs66_situationspdos\" AS \"Personnepcg66Situationpdo\" ON (\"Personnepcg66Situationpdo\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\") LEFT OUTER JOIN \"public\".\"situationspdos\" AS \"Situationpdo\" ON (\"Personnepcg66Situationpdo\".\"situationpdo_id\" = \"Situationpdo\".\"id\") WHERE \"Personnepcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\"), '''') || ''<\/ul>'') AS \"Traitementpcg66__situationpdo_id\"","Traitementpcg66.statutpdo_id":"(''<ul>'' || ARRAY_TO_STRING(ARRAY(SELECT ''<li>'' || \"Statutpdo\".\"libelle\" || ''<\/li>'' AS \"Statutpdo__libelle\" FROM \"personnespcgs66\" AS \"Personnepcg66\" LEFT OUTER JOIN \"public\".\"personnespcgs66_statutspdos\" AS \"Personnepcg66Statutpdo\" ON (\"Personnepcg66Statutpdo\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\") LEFT OUTER JOIN \"public\".\"statutspdos\" AS \"Statutpdo\" ON (\"Personnepcg66Statutpdo\".\"statutpdo_id\" = \"Statutpdo\".\"id\") WHERE \"Personnepcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\"), '''') || ''<\/ul>'') AS \"Traitementpcg66__statutpdo_id\"","Fichiermodule.nb_fichiers_lies":"(SELECT COUNT(\"fichiermodule\".\"id\") FROM \"fichiersmodules\" AS \"fichiermodule\" WHERE \"fichiermodule\".\"modele\" = ''Foyer'' AND \"fichiermodule\".\"fk_value\" = \"Foyer\".\"id\") AS \"Fichiermodule__nb_fichiers_lies\""},"conditions":{"OR":{"Prestation.rolepers":["DEM","CJT"],"0":"Prestation.id IS NULL"},"0":"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )","1":{"Prestation.rolepers":"DEM","0":{"OR":{"Detailcalculdroitrsa.id":"","0":"Detailcalculdroitrsa.id IN (SELECT \"detailscalculsdroitsrsa\".\"id\" AS detailscalculsdroitsrsa__id FROM detailscalculsdroitsrsa AS detailscalculsdroitsrsa WHERE \"detailscalculsdroitsrsa\".\"detaildroitrsa_id\" = \"Detaildroitrsa\".\"id\" ORDER BY \"detailscalculsdroitsrsa\".\"ddnatdro\" DESC LIMIT 1)"}},"1":{"OR":{"Decisiondossierpcg66.id":"","0":"Decisiondossierpcg66.id IN (SELECT \"decisionsdossierspcgs66\".\"id\" FROM decisionsdossierspcgs66 WHERE \"decisionsdossierspcgs66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\" ORDER BY \"decisionsdossierspcgs66\".\"created\" DESC LIMIT 1)"}},"2":{"OR":["Categorieromev3.familleromev3_id IS NULL","Familleromev3.id = Categorieromev3.familleromev3_id"]},"3":{"OR":["Categorieromev3.domaineromev3_id IS NULL","Domaineromev3.id = Categorieromev3.domaineromev3_id"]},"4":{"OR":["Categorieromev3.metierromev3_id IS NULL","Metierromev3.id = Categorieromev3.metierromev3_id"]},"5":{"OR":["Categorieromev3.appellationromev3_id IS NULL","Appellationromev3.id = Categorieromev3.appellationromev3_id"]},"6":{"OR":["Personnepcg66.categoriedetail IS NULL","Categoriemetierromev2.id = Personnepcg66.categoriedetail"]}},"2":[]},"joins":[{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Dossierpcg66\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes\"","alias":"Personne","type":"LEFT OUTER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"RIGHT","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"detailscalculsdroitsrsa\"","alias":"Detailcalculdroitrsa","type":"LEFT OUTER","conditions":"\"Detailcalculdroitrsa\".\"detaildroitrsa_id\" = \"Detaildroitrsa\".\"id\""},{"table":"\"decisionsdossierspcgs66\"","alias":"Decisiondossierpcg66","type":"LEFT OUTER","conditions":"\"Decisiondossierpcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\""},{"table":"\"users\"","alias":"User","type":"LEFT OUTER","conditions":"\"Dossierpcg66\".\"user_id\" = \"User\".\"id\""},{"table":"\"polesdossierspcgs66\"","alias":"Poledossierpcg66","type":"LEFT OUTER","conditions":"\"Dossierpcg66\".\"poledossierpcg66_id\" = \"Poledossierpcg66\".\"id\""},{"table":"\"personnespcgs66\"","alias":"Personnepcg66","type":"LEFT OUTER","conditions":"\"Personnepcg66\".\"personne_id\" = \"Personne\".\"id\" AND \"Personnepcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\""},{"table":"\"entreesromesv3\"","alias":"Categorieromev3","type":"LEFT OUTER","conditions":"\"Personnepcg66\".\"categorieromev3_id\" = \"Categorieromev3\".\"id\""},{"table":"\"famillesromesv3\"","alias":"Familleromev3","type":"LEFT OUTER","conditions":"\"Categorieromev3\".\"familleromev3_id\" = \"Familleromev3\".\"id\""},{"table":"\"domainesromesv3\"","alias":"Domaineromev3","type":"LEFT OUTER","conditions":"\"Domaineromev3\".\"familleromev3_id\" = \"Familleromev3\".\"id\""},{"table":"\"metiersromesv3\"","alias":"Metierromev3","type":"LEFT OUTER","conditions":"\"Metierromev3\".\"domaineromev3_id\" = \"Domaineromev3\".\"id\""},{"table":"\"appellationsromesv3\"","alias":"Appellationromev3","type":"LEFT OUTER","conditions":"\"Appellationromev3\".\"metierromev3_id\" = \"Metierromev3\".\"id\""},{"table":"\"codesromemetiersdsps66\"","alias":"Categoriemetierromev2","type":"LEFT OUTER","conditions":"\"Personnepcg66\".\"categoriedetail\" = \"Categoriemetierromev2\".\"id\""},{"table":"\"traitementspcgs66\"","alias":"Traitementpcg66","type":"LEFT OUTER","conditions":"\"Traitementpcg66\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\" AND ((\"Traitementpcg66\".\"id\" IS NULL) OR (((\"Traitementpcg66\".\"id\" IN (SELECT \"traitementspcgs66\".\"id\" AS traitementspcgs66__id FROM traitementspcgs66 AS traitementspcgs66 WHERE \"traitementspcgs66\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\" ORDER BY \"traitementspcgs66\".\"created\" DESC LIMIT 1))  AND  (\"Traitementpcg66\".\"typetraitement\" = ''documentarrive'')  AND  (\"Traitementpcg66\".\"datereception\" IS NOT NULL)  AND  (\"Dossierpcg66\".\"etatdossierpcg\" = ''attinstrdocarrive''))))"},{"table":"\"decisionspdos\"","alias":"Decisionpdo","type":"LEFT OUTER","conditions":"\"Decisiondossierpcg66\".\"decisionpdo_id\" = \"Decisionpdo\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[""]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Traitements PCGs', 1, 1, 'Traitementpcg66', '{"fields":{"Personne.nomcomnai":"Personne.nomcomnai","Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Adresse.numcom":"Adresse.numcom","Dossier.numdemrsa":"Dossier.numdemrsa","Dossier.matricule":"Dossier.matricule","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Traitementpcg66.descriptionpdo_id":"Traitementpcg66.descriptionpdo_id","Traitementpcg66.datereception":"Traitementpcg66.datereception","Traitementpcg66.dateecheance":"Traitementpcg66.dateecheance","Traitementpcg66.clos":"Traitementpcg66.clos","Traitementpcg66.annule":"Traitementpcg66.annule","Traitementpcg66.created":"Traitementpcg66.created","Traitementpcg66.typetraitement":"Traitementpcg66.typetraitement","Dossierpcg66.datereceptionpdo":"Dossierpcg66.datereceptionpdo","Dossierpcg66.user_id":"Dossierpcg66.user_id","Situationpdo.libelle":"Situationpdo.libelle","0":"Personnepcg66.id","1":"Personnepcg66.personne_id","2":"Dossierpcg66.id","Fichiermodule.nb_fichiers_lies":"(SELECT COUNT(\"fichiermodule\".\"id\") FROM \"fichiersmodules\" AS \"fichiermodule\" WHERE \"fichiermodule\".\"modele\" = ''Foyer'' AND \"fichiermodule\".\"fk_value\" = \"Foyer\".\"id\") AS \"Fichiermodule__nb_fichiers_lies\""},"conditions":["Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )",{"OR":["Detailcalculdroitrsa.id IS NULL","Detailcalculdroitrsa.id IN (SELECT \"detailscalculsdroitsrsa\".\"id\" AS detailscalculsdroitsrsa__id FROM detailscalculsdroitsrsa AS detailscalculsdroitsrsa WHERE \"detailscalculsdroitsrsa\".\"detaildroitrsa_id\" = \"Detaildroitrsa\".\"id\" ORDER BY \"detailscalculsdroitsrsa\".\"ddnatdro\" DESC LIMIT 1)"]},[]],"joins":[{"table":"\"personnespcgs66\"","alias":"Personnepcg66","type":"INNER","conditions":"\"Traitementpcg66\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\""},{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Personnepcg66\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"INNER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"INNER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA'' AND \"Prestation\".\"rolepers\" IN (''DEM'', ''CJT'')"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"dossierspcgs66\"","alias":"Dossierpcg66","type":"INNER","conditions":"\"Personnepcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\""},{"table":"\"personnespcgs66_situationspdos\"","alias":"Personnepcg66Situationpdo","type":"LEFT OUTER","conditions":"\"Traitementpcg66\".\"personnepcg66_situationpdo_id\" = \"Personnepcg66Situationpdo\".\"id\""},{"table":"\"situationspdos\"","alias":"Situationpdo","type":"LEFT OUTER","conditions":"\"Personnepcg66Situationpdo\".\"situationpdo_id\" = \"Situationpdo\".\"id\""},{"table":"\"detailscalculsdroitsrsa\"","alias":"Detailcalculdroitrsa","type":"LEFT OUTER","conditions":"\"Detailcalculdroitrsa\".\"detaildroitrsa_id\" = \"Detaildroitrsa\".\"id\""},{"table":"\"users\"","alias":"User","type":"LEFT OUTER","conditions":"\"Dossierpcg66\".\"user_id\" = \"User\".\"id\""},{"table":"\"descriptionspdos\"","alias":"Descriptionpdo","type":"LEFT OUTER","conditions":"\"Traitementpcg66\".\"descriptionpdo_id\" = \"Descriptionpdo\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[""]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Gestionnaire de dossiers PCG', 1, 1, 'Dossierpcg66', '{"fields":{"Personne.nomcomnai":"Personne.nomcomnai","Personne.dtnai":"Personne.dtnai","Personne.nir":"Personne.nir","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","Adresse.numcom":"Adresse.numcom","Dossier.numdemrsa":"Dossier.numdemrsa","Dossier.matricule":"Dossier.matricule","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Dossierpcg66.typepdo_id":"Dossierpcg66.typepdo_id","Dossierpcg66.etatdossierpcg":"Dossierpcg66.etatdossierpcg","Dossierpcg66.originepdo_id":"Dossierpcg66.originepdo_id","Dossierpcg66.user_id":"Dossierpcg66.user_id","Dossierpcg66.nbpropositions":"Dossierpcg66.nbpropositions","Decisiondossierpcg66.decisionpdo_id":"Decisiondossierpcg66.decisionpdo_id","Traitementpcg66.dateecheance":"Traitementpcg66.dateecheance","0":"Dossierpcg66.id","1":"Dossierpcg66.foyer_id","Traitementpcg66.situationpdo_id":"(''<ul>'' || ARRAY_TO_STRING(ARRAY(SELECT ''<li>'' || \"Situationpdo\".\"libelle\" || ''<\/li>'' AS \"Situationpdo__libelle\" FROM \"personnespcgs66\" AS \"Personnepcg66\" LEFT OUTER JOIN \"public\".\"personnespcgs66_situationspdos\" AS \"Personnepcg66Situationpdo\" ON (\"Personnepcg66Situationpdo\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\") LEFT OUTER JOIN \"public\".\"situationspdos\" AS \"Situationpdo\" ON (\"Personnepcg66Situationpdo\".\"situationpdo_id\" = \"Situationpdo\".\"id\") WHERE \"Personnepcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\"), '''') || ''<\/ul>'') AS \"Traitementpcg66__situationpdo_id\"","Traitementpcg66.statutpdo_id":"(''<ul>'' || ARRAY_TO_STRING(ARRAY(SELECT ''<li>'' || \"Statutpdo\".\"libelle\" || ''<\/li>'' AS \"Statutpdo__libelle\" FROM \"personnespcgs66\" AS \"Personnepcg66\" LEFT OUTER JOIN \"public\".\"personnespcgs66_statutspdos\" AS \"Personnepcg66Statutpdo\" ON (\"Personnepcg66Statutpdo\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\") LEFT OUTER JOIN \"public\".\"statutspdos\" AS \"Statutpdo\" ON (\"Personnepcg66Statutpdo\".\"statutpdo_id\" = \"Statutpdo\".\"id\") WHERE \"Personnepcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\"), '''') || ''<\/ul>'') AS \"Traitementpcg66__statutpdo_id\"","Dossierpcg66.listetraitements":"(''<ul>'' || ARRAY_TO_STRING(ARRAY(SELECT ''<li>'' || \"Traitementpcg66\".\"typetraitement\" || ''<\/li>'' AS \"Traitementpcg66__typetraitement\" FROM \"traitementspcgs66\" AS \"Traitementpcg66\" INNER JOIN \"public\".\"personnespcgs66\" AS \"Personnepcg66\" ON (\"Traitementpcg66\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\") WHERE \"Personnepcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\"), '''') || ''<\/ul>'') AS \"Dossierpcg66__listetraitements\"","Fichiermodule.nb_fichiers_lies":"(SELECT COUNT(\"fichiermodule\".\"id\") FROM \"fichiersmodules\" AS \"fichiermodule\" WHERE \"fichiermodule\".\"modele\" = ''Foyer'' AND \"fichiermodule\".\"fk_value\" = \"Foyer\".\"id\") AS \"Fichiermodule__nb_fichiers_lies\"","( SELECT COUNT(*) FROM traitementspcgs66 WHERE traitementspcgs66.personnepcg66_id = \"Personnepcg66\".\"id\" ) AS  \"Personnepcg66__nbtraitements\"":"(SELECT COUNT(*) FROM traitementspcgs66 WHERE traitementspcgs66.personnepcg66_id = \"Personnepcg66\".\"id\") AS \"Personnepcg66__nbtraitements\""},"conditions":{"OR":{"Prestation.rolepers":["DEM","CJT"],"0":"Prestation.id IS NULL"},"0":"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )","1":{"Prestation.rolepers":"DEM","0":{"OR":{"Detailcalculdroitrsa.id":"","0":"Detailcalculdroitrsa.id IN (SELECT \"detailscalculsdroitsrsa\".\"id\" AS detailscalculsdroitsrsa__id FROM detailscalculsdroitsrsa AS detailscalculsdroitsrsa WHERE \"detailscalculsdroitsrsa\".\"detaildroitrsa_id\" = \"Detaildroitrsa\".\"id\" ORDER BY \"detailscalculsdroitsrsa\".\"ddnatdro\" DESC LIMIT 1)"}},"1":{"OR":{"Decisiondossierpcg66.id":"","0":"Decisiondossierpcg66.id IN (SELECT \"decisionsdossierspcgs66\".\"id\" FROM decisionsdossierspcgs66 WHERE \"decisionsdossierspcgs66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\" ORDER BY \"decisionsdossierspcgs66\".\"created\" DESC LIMIT 1)"}},"2":{"OR":["Categorieromev3.familleromev3_id IS NULL","Familleromev3.id = Categorieromev3.familleromev3_id"]},"3":{"OR":["Categorieromev3.domaineromev3_id IS NULL","Domaineromev3.id = Categorieromev3.domaineromev3_id"]},"4":{"OR":["Categorieromev3.metierromev3_id IS NULL","Metierromev3.id = Categorieromev3.metierromev3_id"]},"5":{"OR":["Categorieromev3.appellationromev3_id IS NULL","Appellationromev3.id = Categorieromev3.appellationromev3_id"]},"6":{"OR":["Personnepcg66.categoriedetail IS NULL","Categoriemetierromev2.id = Personnepcg66.categoriedetail"]}},"2":[]},"joins":[{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Dossierpcg66\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes\"","alias":"Personne","type":"LEFT OUTER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"RIGHT","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"detailscalculsdroitsrsa\"","alias":"Detailcalculdroitrsa","type":"LEFT OUTER","conditions":"\"Detailcalculdroitrsa\".\"detaildroitrsa_id\" = \"Detaildroitrsa\".\"id\""},{"table":"\"decisionsdossierspcgs66\"","alias":"Decisiondossierpcg66","type":"LEFT OUTER","conditions":"\"Decisiondossierpcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\""},{"table":"\"users\"","alias":"User","type":"LEFT OUTER","conditions":"\"Dossierpcg66\".\"user_id\" = \"User\".\"id\""},{"table":"\"polesdossierspcgs66\"","alias":"Poledossierpcg66","type":"LEFT OUTER","conditions":"\"Dossierpcg66\".\"poledossierpcg66_id\" = \"Poledossierpcg66\".\"id\""},{"table":"\"personnespcgs66\"","alias":"Personnepcg66","type":"LEFT OUTER","conditions":"\"Personnepcg66\".\"personne_id\" = \"Personne\".\"id\" AND \"Personnepcg66\".\"dossierpcg66_id\" = \"Dossierpcg66\".\"id\""},{"table":"\"entreesromesv3\"","alias":"Categorieromev3","type":"LEFT OUTER","conditions":"\"Personnepcg66\".\"categorieromev3_id\" = \"Categorieromev3\".\"id\""},{"table":"\"famillesromesv3\"","alias":"Familleromev3","type":"LEFT OUTER","conditions":"\"Categorieromev3\".\"familleromev3_id\" = \"Familleromev3\".\"id\""},{"table":"\"domainesromesv3\"","alias":"Domaineromev3","type":"LEFT OUTER","conditions":"\"Domaineromev3\".\"familleromev3_id\" = \"Familleromev3\".\"id\""},{"table":"\"metiersromesv3\"","alias":"Metierromev3","type":"LEFT OUTER","conditions":"\"Metierromev3\".\"domaineromev3_id\" = \"Domaineromev3\".\"id\""},{"table":"\"appellationsromesv3\"","alias":"Appellationromev3","type":"LEFT OUTER","conditions":"\"Appellationromev3\".\"metierromev3_id\" = \"Metierromev3\".\"id\""},{"table":"\"codesromemetiersdsps66\"","alias":"Categoriemetierromev2","type":"LEFT OUTER","conditions":"\"Personnepcg66\".\"categoriedetail\" = \"Categoriemetierromev2\".\"id\""},{"table":"\"traitementspcgs66\"","alias":"Traitementpcg66","type":"LEFT OUTER","conditions":"\"Traitementpcg66\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\" AND ((\"Traitementpcg66\".\"id\" IS NULL) OR (((\"Traitementpcg66\".\"id\" IN (SELECT \"traitementspcgs66\".\"id\" AS traitementspcgs66__id FROM traitementspcgs66 AS traitementspcgs66 WHERE \"traitementspcgs66\".\"personnepcg66_id\" = \"Personnepcg66\".\"id\" ORDER BY \"traitementspcgs66\".\"created\" DESC LIMIT 1))  AND  (\"Traitementpcg66\".\"typetraitement\" = ''documentarrive'')  AND  (\"Traitementpcg66\".\"datereception\" IS NOT NULL)  AND  (\"Dossierpcg66\".\"etatdossierpcg\" = ''attinstrdocarrive''))))"},{"table":"\"decisionspdos\"","alias":"Decisionpdo","type":"LEFT OUTER","conditions":"\"Decisiondossierpcg66\".\"decisionpdo_id\" = \"Decisionpdo\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[""]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Bilans de parcours', 1, 1, 'Bilanparcours66', '{"fields":{"0":"Bilanparcours66.id","1":"Bilanparcours66.orientstruct_id","2":"Bilanparcours66.structurereferente_id","3":"Bilanparcours66.referent_id","4":"Bilanparcours66.datebilan","5":"Bilanparcours66.choixparcours","6":"Bilanparcours66.proposition","7":"Bilanparcours66.examenaudition","8":"Bilanparcours66.examenauditionpe","9":"Bilanparcours66.maintienorientation","10":"Bilanparcours66.saisineepparcours","11":"Bilanparcours66.positionbilan","12":"Personne.id","13":"( ( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) ) AS \"Personne__nom_complet\"","14":"( ( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) ) AS \"Referent__nom_complet\"","15":"Structurereferente.lib_struc","16":"Dossier.matricule","17":"Dossier.numdemrsa","18":"Dossierep.themeep","19":"Adresse.nomcom","20":"Adresse.codepos","21":"Adresse.numcom","PersonneReferent.referent_id":"PersonneReferent.referent_id","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc"},"conditions":[null,"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )",[]],"joins":[{"table":"personnes","alias":"Personne","type":"INNER","foreignKey":false,"conditions":["Personne.id = Bilanparcours66.personne_id"]},{"table":"foyers","alias":"Foyer","type":"INNER","foreignKey":false,"conditions":["Personne.foyer_id = Foyer.id"]},{"table":"dossiers","alias":"Dossier","type":"INNER","foreignKey":false,"conditions":["Foyer.dossier_id = Dossier.id"]},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"adressesfoyers","alias":"Adressefoyer","type":"INNER","foreignKey":false,"conditions":["Foyer.id = Adressefoyer.foyer_id","Adressefoyer.id IN ( SELECT \"adressesfoyers\".\"id\" AS \"adressesfoyers__id\" FROM \"adressesfoyers\" AS \"adressesfoyers\"   WHERE \"adressesfoyers\".\"foyer_id\" = \"Adressefoyer\".\"foyer_id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"]},{"table":"adresses","alias":"Adresse","type":"INNER","foreignKey":false,"conditions":["Adresse.id = Adressefoyer.adresse_id"]},{"table":"orientsstructs","alias":"Orientstruct","type":"LEFT OUTER","foreignKey":false,"conditions":["Orientstruct.id = Bilanparcours66.orientstruct_id"]},{"table":"referents","alias":"Referent","type":"INNER","foreignKey":false,"conditions":["Referent.id = Bilanparcours66.referent_id"]},{"table":"structuresreferentes","alias":"Structurereferente","type":"INNER","foreignKey":false,"conditions":["Structurereferente.id = Bilanparcours66.structurereferente_id"]},{"table":"defautsinsertionseps66","alias":"Defautinsertionep66","type":"LEFT OUTER","foreignKey":false,"conditions":["Bilanparcours66.id = Defautinsertionep66.bilanparcours66_id"]},{"table":"saisinesbilansparcourseps66","alias":"Saisinebilanparcoursep66","type":"LEFT OUTER","foreignKey":false,"conditions":["Bilanparcours66.id = Saisinebilanparcoursep66.bilanparcours66_id"]},{"table":"dossierseps","alias":"Dossierep","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":["Defautinsertionep66.dossierep_id = Dossierep.id","Saisinebilanparcoursep66.dossierep_id = Dossierep.id"]}},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""}],"recursive":-1,"contain":false,"order":[["\"Bilanparcours66\".\"datebilan\" ASC"]]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Allocataires non inscrits à Pôle Emploi', 1, 1, 'Personne', '{"fields":{"Personne.nom":"Personne.nom","Personne.prenom":"Personne.prenom","Personne.dtnai":"Personne.dtnai","( CASE WHEN NOT ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) = 1 AND ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) <= 1 ) THEN ( ''Ce foyer comporte '' || ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) || '' demandeur(s) et '' || ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) ) || '' conjoint(s).'' ) ELSE NULL END ) AS  \"Foyer__enerreur\"":"( CASE WHEN NOT ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) = 1 AND ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) <= 1 ) THEN ( ''Ce foyer comporte '' || ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) || '' demandeur(s) et '' || ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) ) || '' conjoint(s).'' ) ELSE NULL END ) AS  \"Foyer__enerreur\"","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Orientstruct.date_valid":"Orientstruct.date_valid","0":"Personne.id"},"conditions":{"OR":{"Prestation.rolepers":["DEM","CJT"],"0":"Prestation.id IS NULL"},"0":"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )","1":["Personne.id NOT IN (SELECT \"dossierseps1\".\"personne_id\" AS \"dossierseps1__personne_id\" FROM \"dossierseps\" AS \"dossierseps1\"   WHERE \"dossierseps1\".\"actif\" = 1 AND \"dossierseps1\".\"personne_id\" = \"Personne\".\"id\" AND \"dossierseps1\".\"themeep\" = ''defautsinsertionseps66'' AND \"dossierseps1\".\"id\" IN (SELECT \"passagescommissionseps1\".\"dossierep_id\" AS passagescommissionseps1__dossierep_id FROM passagescommissionseps AS passagescommissionseps1   WHERE \"passagescommissionseps1\".\"dossierep_id\" = \"dossierseps1\".\"id\" AND \"passagescommissionseps1\".\"etatdossierep\" IN (''associe'', ''decisionep'', ''decisioncg'', ''reporte'')   )   )","Personne.id NOT IN (SELECT \"dossierseps2\".\"personne_id\" AS \"dossierseps2__personne_id\" FROM \"dossierseps\" AS \"dossierseps2\"   WHERE \"dossierseps2\".\"personne_id\" = \"Personne\".\"id\" AND \"dossierseps2\".\"themeep\" = ''defautsinsertionseps66'' AND \"dossierseps2\".\"id\" IN (SELECT \"passagescommissionseps2\".\"dossierep_id\" AS passagescommissionseps2__dossierep_id FROM passagescommissionseps AS passagescommissionseps2 INNER JOIN \"public\".\"commissionseps\" AS commissionseps ON (\"commissionseps\".\"id\" = \"passagescommissionseps2\".\"commissionep_id\" AND \"commissionseps\".\"dateseance\" >= ''2015-09-28'')  WHERE \"passagescommissionseps2\".\"dossierep_id\" = \"dossierseps2\".\"id\" AND \"passagescommissionseps2\".\"etatdossierep\" IN (''traite'', ''annule'')   )   )","Personne.id NOT IN (SELECT \"dossierseps3\".\"personne_id\" AS \"dossierseps3__personne_id\" FROM \"dossierseps\" AS \"dossierseps3\"   WHERE \"dossierseps3\".\"actif\" = 1 AND \"dossierseps3\".\"personne_id\" = \"Personne\".\"id\" AND \"dossierseps3\".\"themeep\" = ''defautsinsertionseps66'' AND \"dossierseps3\".\"id\" NOT IN (SELECT \"passagescommissionseps3\".\"dossierep_id\" AS passagescommissionseps3__dossierep_id FROM passagescommissionseps AS passagescommissionseps3   WHERE \"passagescommissionseps3\".\"dossierep_id\" = \"dossierseps3\".\"id\"   )   )"],"2":["Orientstruct.date_valid + INTERVAL ''6 weeks'' < DATE_TRUNC( ''day'', NOW() )","Personne.id NOT IN ( SELECT personnes.id FROM informationspe INNER JOIN historiqueetatspe ON ( informationspe.id = historiqueetatspe.informationpe_id AND historiqueetatspe.id IN ( SELECT h.id FROM historiqueetatspe AS h WHERE h.informationpe_id = informationspe.id ORDER BY h.date DESC, h.id DESC LIMIT 1 ) ) INNER JOIN personnes ON ( ((((\"informationspe\".\"nir\" IS NOT NULL)  AND  (SUBSTRING( \"informationspe\".\"nir\" FROM 1 FOR 13 ) = SUBSTRING( TRIM( BOTH '' '' FROM \"personnes\".\"nir\" ) FROM 1 FOR 13 ))  AND  (\"informationspe\".\"dtnai\" = \"personnes\".\"dtnai\"))) OR (((\"personnes\".\"nom\" IS NOT NULL)  AND  (\"personnes\".\"prenom\" IS NOT NULL)  AND  (\"personnes\".\"dtnai\" IS NOT NULL)  AND  (TRIM( BOTH '' '' FROM \"personnes\".\"nom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"personnes\".\"prenom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"informationspe\".\"nom\" ) = TRIM( BOTH '' '' FROM \"personnes\".\"nom\" ))  AND  (TRIM( BOTH '' '' FROM \"informationspe\".\"prenom\" ) = TRIM( BOTH '' '' FROM \"personnes\".\"prenom\" ))  AND  (\"informationspe\".\"dtnai\" = \"personnes\".\"dtnai\")))) ) WHERE personnes.id = Personne.id AND historiqueetatspe.etat = ''inscription'' AND historiqueetatspe.date >= Orientstruct.date_valid )"],"3":[]},"joins":[{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"RIGHT","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"orientsstructs\"","alias":"Orientstruct","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"personne_id\" = \"Personne\".\"id\" AND \"Orientstruct\".\"id\" IN (SELECT \"o\".\"id\" FROM orientsstructs AS o WHERE \"o\".\"personne_id\" = \"Personne\".\"id\" AND \"o\".\"date_valid\" IS NOT NULL ORDER BY \"o\".\"date_valid\" DESC LIMIT 1) AND \"Orientstruct\".\"typeorient_id\" IN (SELECT \"t\".\"id\" FROM typesorients AS t WHERE \"t\".\"lib_type_orient\" LIKE ''Emploi %'')"},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[["Orientstruct.date_valid"]]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Allocataires radiés de Pôle Emploi', 1, 1, 'Personne', '{"fields":{"Personne.nom":"Personne.nom","Personne.prenom":"Personne.prenom","Personne.dtnai":"Personne.dtnai","( CASE WHEN NOT ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) = 1 AND ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) <= 1 ) THEN ( ''Ce foyer comporte '' || ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) || '' demandeur(s) et '' || ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) ) || '' conjoint(s).'' ) ELSE NULL END ) AS  \"Foyer__enerreur\"":"( CASE WHEN NOT ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) = 1 AND ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) <= 1 ) THEN ( ''Ce foyer comporte '' || ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) || '' demandeur(s) et '' || ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) ) || '' conjoint(s).'' ) ELSE NULL END ) AS  \"Foyer__enerreur\"","Situationdossierrsa.etatdosrsa":"Situationdossierrsa.etatdosrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Orientstruct.date_valid":"Orientstruct.date_valid","0":"Personne.id"},"conditions":{"OR":{"Prestation.rolepers":["DEM","CJT"],"0":"Prestation.id IS NULL"},"0":"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )","1":["Personne.id NOT IN (SELECT \"dossierseps1\".\"personne_id\" AS \"dossierseps1__personne_id\" FROM \"dossierseps\" AS \"dossierseps1\"   WHERE \"dossierseps1\".\"actif\" = 1 AND \"dossierseps1\".\"personne_id\" = \"Personne\".\"id\" AND \"dossierseps1\".\"themeep\" = ''defautsinsertionseps66'' AND \"dossierseps1\".\"id\" IN (SELECT \"passagescommissionseps1\".\"dossierep_id\" AS passagescommissionseps1__dossierep_id FROM passagescommissionseps AS passagescommissionseps1   WHERE \"passagescommissionseps1\".\"dossierep_id\" = \"dossierseps1\".\"id\" AND \"passagescommissionseps1\".\"etatdossierep\" IN (''associe'', ''decisionep'', ''decisioncg'', ''reporte'')   )   )","Personne.id NOT IN (SELECT \"dossierseps2\".\"personne_id\" AS \"dossierseps2__personne_id\" FROM \"dossierseps\" AS \"dossierseps2\"   WHERE \"dossierseps2\".\"personne_id\" = \"Personne\".\"id\" AND \"dossierseps2\".\"themeep\" = ''defautsinsertionseps66'' AND \"dossierseps2\".\"id\" IN (SELECT \"passagescommissionseps2\".\"dossierep_id\" AS passagescommissionseps2__dossierep_id FROM passagescommissionseps AS passagescommissionseps2 INNER JOIN \"public\".\"commissionseps\" AS commissionseps ON (\"commissionseps\".\"id\" = \"passagescommissionseps2\".\"commissionep_id\" AND \"commissionseps\".\"dateseance\" >= ''2015-09-28'')  WHERE \"passagescommissionseps2\".\"dossierep_id\" = \"dossierseps2\".\"id\" AND \"passagescommissionseps2\".\"etatdossierep\" IN (''traite'', ''annule'')   )   )","Personne.id NOT IN (SELECT \"dossierseps3\".\"personne_id\" AS \"dossierseps3__personne_id\" FROM \"dossierseps\" AS \"dossierseps3\"   WHERE \"dossierseps3\".\"actif\" = 1 AND \"dossierseps3\".\"personne_id\" = \"Personne\".\"id\" AND \"dossierseps3\".\"themeep\" = ''defautsinsertionseps66'' AND \"dossierseps3\".\"id\" NOT IN (SELECT \"passagescommissionseps3\".\"dossierep_id\" AS passagescommissionseps3__dossierep_id FROM passagescommissionseps AS passagescommissionseps3   WHERE \"passagescommissionseps3\".\"dossierep_id\" = \"dossierseps3\".\"id\"   )   )"],"2":{"Historiqueetatpe.etat":"radiation","0":"Informationpe.id IN ( SELECT \"derniereinformationspe\".\"i__id\" FROM ( SELECT \"i\".\"id\" AS \"i__id\", \"h\".\"date\" AS \"h__date\" FROM \"informationspe\" AS \"i\" INNER JOIN \"public\".\"historiqueetatspe\" AS \"h\" ON (\"h\".\"informationpe_id\" = \"i\".\"id\")  WHERE ((((\"i\".\"nir\" IS NOT NULL)  AND  (\"Personne\".\"nir\" IS NOT NULL)  AND  (TRIM( BOTH '' '' FROM \"i\".\"nir\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"Personne\".\"nir\" ) <> '''')  AND  (SUBSTRING( \"i\".\"nir\" FROM 1 FOR 13 ) = SUBSTRING( \"Personne\".\"nir\" FROM 1 FOR 13 ))  AND  (\"i\".\"dtnai\" = \"Personne\".\"dtnai\"))) OR (((\"i\".\"nom\" IS NOT NULL)  AND  (\"Personne\".\"nom\" IS NOT NULL)  AND  (\"i\".\"prenom\" IS NOT NULL)  AND  (\"Personne\".\"prenom\" IS NOT NULL)  AND  (TRIM( BOTH '' '' FROM \"i\".\"nom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"i\".\"prenom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"Personne\".\"nom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"Personne\".\"prenom\" ) <> '''')  AND  (TRIM( BOTH '' '' FROM \"i\".\"nom\" ) = \"Personne\".\"nom\")  AND  (TRIM( BOTH '' '' FROM \"i\".\"prenom\" ) = \"Personne\".\"prenom\")  AND  (\"i\".\"dtnai\" = \"Personne\".\"dtnai\")))) AND \"h\".\"id\" IN ( SELECT \"dernierhistoriqueetatspe\".\"id\" AS dernierhistoriqueetatspe__id FROM historiqueetatspe AS dernierhistoriqueetatspe   WHERE \"dernierhistoriqueetatspe\".\"informationpe_id\" = \"i\".\"id\"   ORDER BY \"dernierhistoriqueetatspe\".\"date\" DESC, \"dernierhistoriqueetatspe\".\"id\" DESC  LIMIT 1 )    ) AS \"derniereinformationspe\" ORDER BY \"derniereinformationspe\".\"h__date\" DESC LIMIT 1 )"},"3":[]},"joins":[{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"RIGHT","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"orientsstructs\"","alias":"Orientstruct","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"personne_id\" = \"Personne\".\"id\" AND \"Orientstruct\".\"id\" IN (SELECT \"o\".\"id\" FROM orientsstructs AS o WHERE \"o\".\"personne_id\" = \"Personne\".\"id\" AND \"o\".\"date_valid\" IS NOT NULL ORDER BY \"o\".\"date_valid\" DESC LIMIT 1) AND \"Orientstruct\".\"typeorient_id\" IN (SELECT \"t\".\"id\" FROM typesorients AS t WHERE \"t\".\"lib_type_orient\" LIKE ''Emploi %'')"},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}},{"table":"informationspe","alias":"Informationpe","type":"INNER","foreignKey":false,"conditions":{"OR":[["Informationpe.nir IS NOT NULL","SUBSTRING( Informationpe.nir FROM 1 FOR 13 ) = SUBSTRING( TRIM( BOTH '' '' FROM Personne.nir ) FROM 1 FOR 13 )","Informationpe.dtnai = Personne.dtnai"],{"0":"Personne.nom IS NOT NULL","1":"Personne.prenom IS NOT NULL","2":"Personne.dtnai IS NOT NULL","TRIM( BOTH '' '' FROM Personne.nom ) <>":"","TRIM( BOTH '' '' FROM Personne.prenom ) <>":"","3":"TRIM( BOTH '' '' FROM Informationpe.nom ) = TRIM( BOTH '' '' FROM Personne.nom )","4":"TRIM( BOTH '' '' FROM Informationpe.prenom ) = TRIM( BOTH '' '' FROM Personne.prenom )","5":"Informationpe.dtnai = Personne.dtnai"}]}},{"table":"historiqueetatspe","alias":"Historiqueetatpe","type":"INNER","foreignKey":false,"conditions":["Historiqueetatpe.informationpe_id = Informationpe.id","Historiqueetatpe.id IN ( SELECT h.id FROM historiqueetatspe AS h WHERE h.informationpe_id = Informationpe.id ORDER BY h.date DESC, h.id DESC LIMIT 1 )"]}],"recursive":-1,"contain":false,"order":[["Historiqueetatpe.date","Historiqueetatpe.id"]]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Demande de maintien dans le social', 1, 1, 'Orientstruct', '{"fields":{"Personne.dtnai":"Personne.dtnai","( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\"","( CASE WHEN NOT ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) = 1 AND ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) <= 1 ) THEN ( ''Ce foyer comporte '' || ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) || '' demandeur(s) et '' || ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) ) || '' conjoint(s).'' ) ELSE NULL END ) AS  \"Foyer__enerreur\"":"( CASE WHEN NOT ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) = 1 AND ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) <= 1 ) THEN ( ''Ce foyer comporte '' || ( ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''DEM'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) || '' demandeur(s) et '' || ( SELECT COUNT(personnes.id) FROM personnes INNER JOIN prestations ON ( prestations.personne_id = personnes.id AND prestations.natprest = ''RSA'' AND prestations.rolepers = ''CJT'' ) WHERE personnes.foyer_id = \"Foyer\".\"id\" ) ) || '' conjoint(s).'' ) ELSE NULL END ) AS  \"Foyer__enerreur\"","Adresse.codepos":"Adresse.codepos","Dossier.numdemrsa":"Dossier.numdemrsa","Referentparcours.nom_complet":"( ( \"Referentparcours\".\"qual\" || '' '' || \"Referentparcours\".\"nom\" || '' '' || \"Referentparcours\".\"prenom\" ) ) AS \"Referentparcours__nom_complet\"","Structurereferenteparcours.lib_struc":"Structurereferenteparcours.lib_struc","Orientstruct.date_valid":"Orientstruct.date_valid","( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"":"( \"Referent\".\"qual\" || '' '' || \"Referent\".\"nom\" || '' '' || \"Referent\".\"prenom\" ) AS  \"Referent__nom_complet\"","Structurereferente.lib_struc":"Structurereferente.lib_struc","Typeorient.lib_type_orient":"Typeorient.lib_type_orient","DATE_PART( ''day'', NOW() - \"Contratinsertion\".\"df_ci\" ) AS  \"Contratinsertion__nbjours\"":"DATE_PART( ''day'', NOW() - \"Contratinsertion\".\"df_ci\" ) AS  \"Contratinsertion__nbjours\"","0":"Personne.id","1":"( COALESCE( \"Personne\".\"qual\", '''' ) || '' '' || \"Personne\".\"nom\" || '' '' || \"Personne\".\"prenom\" ) AS  \"Personne__nom_complet\""},"conditions":["Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )",["EXISTS( SELECT * FROM orientsstructs INNER JOIN typesorients ON ( typesorients.id = orientsstructs.typeorient_id ) WHERE orientsstructs.personne_id = Personne.id AND orientsstructs.statut_orient = ''Orienté'' AND ( NOT EXISTS( SELECT * FROM orientsstructs AS osvt INNER JOIN typesorients AS tosvt ON ( tosvt.id = osvt.typeorient_id ) WHERE osvt.personne_id = orientsstructs.personne_id AND osvt.statut_orient = ''Orienté'' AND osvt.date_valid > orientsstructs.date_valid AND tosvt.parentid IN ( 1 ) ) ) AND typesorients.parentid IN ( 4,6 ) AND orientsstructs.date_valid <= ''2013-10-12'' )"],{"1":["Contratinsertion.id NOT IN ( SELECT contratsinsertion.id FROM contratsinsertion INNER JOIN bilansparcours66 ON ( bilansparcours66.contratinsertion_id = contratsinsertion.id ) WHERE bilansparcours66.contratinsertion_id = Contratinsertion.id )"]},{"2":"Orientstruct.id IN ( SELECT \"orientsstructs\".\"id\" AS \"orientsstructs__id\" FROM \"orientsstructs\" AS \"orientsstructs\"   WHERE \"orientsstructs\".\"personne_id\" = \"Personne\".\"id\" AND \"orientsstructs\".\"statut_orient\" = ''Orienté'' AND \"orientsstructs\".\"date_valid\" IS NOT NULL   ORDER BY \"orientsstructs\".\"date_valid\" DESC  LIMIT 1 )"},{"Prestation.rolepers":["DEM","CJT"]},{"Calculdroitrsa.toppersdrodevorsa":"1"},{"Situationdossierrsa.etatdosrsa":["Z","2","3","4"]},{"3":"Adressefoyer.id IN ( SELECT \"adressesfoyers\".\"id\" AS \"adressesfoyers__id\" FROM \"adressesfoyers\" AS \"adressesfoyers\"   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"4":""},{"5":"Contratinsertion.id IN ( SELECT \"contratsinsertion\".\"id\" AS \"contratsinsertion__id\" FROM \"contratsinsertion\" AS \"contratsinsertion\"   WHERE \"contratsinsertion\".\"personne_id\" = \"Personne\".\"id\"   ORDER BY \"contratsinsertion\".\"dd_ci\" DESC  LIMIT 1 )"},{"6":"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )"},{"7":"Orientstruct.id NOT IN ( SELECT \"nonorientationsproseps66\".\"orientstruct_id\" FROM \"nonorientationsproseps66\" INNER JOIN \"dossierseps\" ON ( \"dossierseps\".\"id\" = \"nonorientationsproseps66\".\"dossierep_id\" ) WHERE \"dossierseps\".\"id\" NOT IN ( SELECT \"passagescommissionseps\".\"dossierep_id\" FROM passagescommissionseps WHERE \"passagescommissionseps\".\"etatdossierep\" = ''traite'' ) AND \"dossierseps\".\"themeep\" = ''nonorientationsproseps66'' AND \"nonorientationsproseps66\".\"orientstruct_id\" = \"Orientstruct\".\"id\" )"},{"8":"Orientstruct.id NOT IN ( SELECT nonorientationsproseps66.orientstruct_id FROM nonorientationsproseps66 INNER JOIN dossierseps ON ( nonorientationsproseps66.dossierep_id = dossierseps.id ) WHERE nonorientationsproseps66.orientstruct_id = Orientstruct.id AND dossierseps.id IN ( SELECT \"passagescommissionseps\".\"dossierep_id\" FROM passagescommissionseps WHERE \"passagescommissionseps\".\"etatdossierep\" = ''traite'' ) AND ( DATE( NOW() ) - ( SELECT CAST( decisionsnonorientationsproseps66.modified AS DATE ) FROM decisionsnonorientationsproseps66 INNER JOIN passagescommissionseps ON ( decisionsnonorientationsproseps66.passagecommissionep_id = passagescommissionseps.id ) INNER JOIN dossierseps ON ( passagescommissionseps.dossierep_id = dossierseps.id ) ORDER BY modified DESC LIMIT 1 ) ) <= 60 )"},[]],"joins":[{"table":"\"structuresreferentes\"","alias":"Structurereferente","type":"INNER","conditions":"\"Orientstruct\".\"structurereferente_id\" = \"Structurereferente\".\"id\""},{"table":"\"typesorients\"","alias":"Typeorient","type":"INNER","conditions":"\"Orientstruct\".\"typeorient_id\" = \"Typeorient\".\"id\""},{"table":"\"referents\"","alias":"Referent","type":"LEFT OUTER","conditions":"\"Orientstruct\".\"referent_id\" = \"Referent\".\"id\""},{"table":"\"personnes\"","alias":"Personne","type":"INNER","conditions":"\"Orientstruct\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"INNER","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"INNER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA'' AND \"Prestation\".\"rolepers\" IN (''DEM'', ''CJT'')"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"INNER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"INNER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"contratsinsertion\"","alias":"Contratinsertion","type":"INNER","conditions":"\"Contratinsertion\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[""]}');

INSERT INTO requestsmanager (name, requestgroup_id, actif, model, json) VALUES ('Moteur de recherche par Allocataires sortants', 1, 1, 'Personne', '{"fields":{"Personne.nom_complet":"Personne.nom_complet","Adressefoyer.dtemm":"Adressefoyer.dtemm","( COALESCE( \"Adresse\".\"codepos\", '''' ) || '' '' || COALESCE( \"Adresse\".\"nomcom\", '''' ) ) AS  \"Adresse__localite\"":"( COALESCE( \"Adresse\".\"codepos\", '''' ) || '' '' || COALESCE( \"Adresse\".\"nomcom\", '''' ) ) AS  \"Adresse__localite\"","Dossier.matricule":"Dossier.matricule","0":"Dossier.id","Adressefoyer2.dtemm":"Adressefoyer2.dtemm","Adresse2.localite":"( ( ( COALESCE( \"Adresse2\".\"codepos\", '''' ) || '' '' || COALESCE( \"Adresse2\".\"nomcom\", '''' ) ) ) ) AS \"Adresse2__localite\"","Adressefoyer3.dtemm":"Adressefoyer3.dtemm","Adresse3.localite":"( ( ( COALESCE( \"Adresse3\".\"codepos\", '''' ) || '' '' || COALESCE( \"Adresse3\".\"nomcom\", '''' ) ) ) ) AS \"Adresse3__localite\""},"conditions":{"Adresse.numcom NOT LIKE":"66%","0":{"OR":{"Adresse2.numcom LIKE":"66%","Adresse3.numcom LIKE":"66%"}},"OR":{"Prestation.rolepers":["DEM","CJT"],"0":"Prestation.id IS NULL"},"1":"( Situationdossierrsa.etatdosrsa IN ( ''2'', ''3'', ''4'' ) )","2":"Dossier.id IN ( SELECT derniersdossiersallocataires.dossier_id FROM derniersdossiersallocataires WHERE derniersdossiersallocataires.personne_id = Personne.id )","3":[]},"joins":[{"table":"\"foyers\"","alias":"Foyer","type":"INNER","conditions":"\"Personne\".\"foyer_id\" = \"Foyer\".\"id\""},{"table":"\"dossiers\"","alias":"Dossier","type":"INNER","conditions":"\"Foyer\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"calculsdroitsrsa\"","alias":"Calculdroitrsa","type":"RIGHT","conditions":"\"Calculdroitrsa\".\"personne_id\" = \"Personne\".\"id\""},{"table":"\"prestations\"","alias":"Prestation","type":"LEFT OUTER","conditions":"\"Prestation\".\"personne_id\" = \"Personne\".\"id\" AND \"Prestation\".\"natprest\" = ''RSA''"},{"table":"\"adressesfoyers\"","alias":"Adressefoyer","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer\".\"id\" IN( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''01''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse","type":"LEFT OUTER","conditions":"\"Adressefoyer\".\"adresse_id\" = \"Adresse\".\"id\""},{"table":"\"situationsdossiersrsa\"","alias":"Situationdossierrsa","type":"INNER","conditions":"\"Situationdossierrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"detailsdroitsrsa\"","alias":"Detaildroitrsa","type":"LEFT OUTER","conditions":"\"Detaildroitrsa\".\"dossier_id\" = \"Dossier\".\"id\""},{"table":"\"personnes_referents\"","alias":"PersonneReferent","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"personne_id\" = \"Personne\".\"id\" AND ((\"PersonneReferent\".\"id\" IS NULL) OR (\"PersonneReferent\".\"id\" IN ( SELECT \"personnes_referents\".\"id\" FROM personnes_referents WHERE \"personnes_referents\".\"personne_id\" = \"Personne\".\"id\" AND \"personnes_referents\".\"dfdesignation\" IS NULL ORDER BY \"personnes_referents\".\"dddesignation\" DESC LIMIT 1 )))"},{"table":"\"referents\"","alias":"Referentparcours","type":"LEFT OUTER","conditions":"\"PersonneReferent\".\"referent_id\" = \"Referentparcours\".\"id\""},{"table":"\"structuresreferentes\"","alias":"Structurereferenteparcours","type":"LEFT OUTER","conditions":"\"Referentparcours\".\"structurereferente_id\" = \"Structurereferenteparcours\".\"id\""},{"table":"\"adressesfoyers\"","alias":"Adressefoyer2","type":"LEFT OUTER","conditions":"\"Adressefoyer2\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer2\".\"id\" IN ( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''02''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse2","type":"LEFT OUTER","conditions":"\"Adressefoyer2\".\"adresse_id\" = \"Adresse2\".\"id\""},{"table":"\"adressesfoyers\"","alias":"Adressefoyer3","type":"LEFT OUTER","conditions":"\"Adressefoyer3\".\"foyer_id\" = \"Foyer\".\"id\" AND \"Adressefoyer3\".\"id\" IN ( SELECT \"adressesfoyers\".\"id\" AS adressesfoyers__id FROM adressesfoyers AS adressesfoyers   WHERE \"adressesfoyers\".\"foyer_id\" = \"Foyer\".\"id\" AND \"adressesfoyers\".\"rgadr\" = ''03''   ORDER BY \"adressesfoyers\".\"dtemm\" DESC  LIMIT 1 )"},{"table":"\"adresses\"","alias":"Adresse3","type":"LEFT OUTER","conditions":"\"Adressefoyer3\".\"adresse_id\" = \"Adresse3\".\"id\""},{"table":"\"cantons\"","alias":"Canton","type":"LEFT OUTER","foreignKey":false,"conditions":{"OR":[{"OR":{"OR":["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''","Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"0":["Canton.numcom = Adresse.numcom","Canton.codepos = Adresse.codepos"]}},[{"OR":[["Canton.numcom IS NULL","TRIM( BOTH '' '' FROM Canton.numcom ) = ''''"],"Canton.numcom = Adresse.numcom"]},{"OR":[["Canton.codepos IS NULL","TRIM( BOTH '' '' FROM Canton.codepos ) = ''''"],"Canton.codepos = Adresse.codepos"]}]],"0":{"OR":{"OR":["Canton.nomcom IS NULL","TRIM( BOTH '' '' FROM Canton.nomcom ) = ''''"],"0":"Adresse.nomcom ILIKE Canton.nomcom"}},"1":{"OR":{"OR":["Canton.libtypevoie IS NULL","TRIM( BOTH '' '' FROM Canton.libtypevoie ) = ''''"],"0":"Adresse.libtypevoie ILIKE Canton.libtypevoie"}},"2":{"OR":{"OR":["Canton.nomvoie IS NULL","TRIM( BOTH '' '' FROM Canton.nomvoie ) = ''''"],"0":"Adresse.nomvoie ILIKE Canton.nomvoie"}},"3":"Canton.id IN ( SELECT \"cantons\".\"id\" AS \"cantons__id\" FROM \"cantons\" AS \"cantons\"   WHERE ((((((\"cantons\".\"numcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = '''') OR (\"cantons\".\"codepos\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (((\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")  AND  (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\"))))) OR (((((((\"cantons\".\"numcom\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"numcom\" ) = ''''))) OR (\"cantons\".\"numcom\" = \"Adresse\".\"numcom\")))  AND  (((((\"cantons\".\"codepos\" IS NULL)  AND  (TRIM( BOTH '' '' FROM \"cantons\".\"codepos\" ) = ''''))) OR (\"cantons\".\"codepos\" = \"Adresse\".\"codepos\")))))) AND ((((\"cantons\".\"nomcom\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomcom\" ) = ''''))) OR (\"Adresse\".\"nomcom\" ILIKE \"cantons\".\"nomcom\")) AND ((((\"cantons\".\"libtypevoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"libtypevoie\" ) = ''''))) OR (\"Adresse\".\"libtypevoie\" ILIKE \"cantons\".\"libtypevoie\")) AND ((((\"cantons\".\"nomvoie\" IS NULL) OR (TRIM( BOTH '' '' FROM \"cantons\".\"nomvoie\" ) = ''''))) OR (\"Adresse\".\"nomvoie\" ILIKE \"cantons\".\"nomvoie\"))   ORDER BY \"cantons\".\"nomvoie\" DESC, \"cantons\".\"libtypevoie\" DESC  LIMIT 1 )"}}],"recursive":-1,"contain":false,"order":[""]}');

-- *****************************************************************************
COMMIT;
-- *****************************************************************************
